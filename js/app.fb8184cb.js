(function(){"use strict";var e={8019:function(e,t,i){var r=i(3751),n=i(641);const s={id:"app"};function a(e,t,i,r,a,o){const l=(0,n.g2)("router-view");return(0,n.uX)(),(0,n.CE)("div",s,[(0,n.bF)(l)])}var o={name:"App"},l=i(6262);const u=(0,l.A)(o,[["render",a]]);var c=u,d=(i(8111),i(3579),i(5220)),p=(i(4114),i(953)),m=i(4335);const h=m.A.create({baseURL:"https://api.u252116.nyat.app:44058/api",timeout:1e4,headers:{"Content-Type":"application/json"}});h.interceptors.request.use((e=>{const t=localStorage.getItem("token");return t&&(e.headers["Authorization"]=`Bearer ${t}`),e}),(e=>Promise.reject(e))),h.interceptors.response.use((e=>e),(e=>{if(e.response)switch(e.response.status){case 401:localStorage.removeItem("token"),localStorage.removeItem("user"),location.reload();break;case 403:console.error("没有权限访问该资源");break;case 404:console.error("请求的资源不存在");break;case 500:console.error("服务器错误");break;default:console.error("未知错误")}return Promise.reject(e)}));const g={auth:{register:e=>h.post("/auth/register",e),login:e=>h.post("/auth/login",e)},user:{getCurrentUser:()=>h.get("/users/me"),updateUser:e=>h.put("/users/me",e),getAllUsers:()=>h.get("/admin/users")},requirements:{getAll:()=>h.get("/requirements"),getById:e=>h.get(`/requirements/${e}`),create:e=>h.post("/requirements",e),update:(e,t)=>h.put(`/requirements/${e}`,t),updateAgreement:(e,t)=>h.put(`/requirements/${e}/agreement`,{agreement:t}),delete:e=>h.delete(`/requirements/${e}`),getMyRequirementsWithApplications:()=>h.get("/requirements/my-requirements"),getMyApplications:()=>h.get("/requirements/my-applications"),getApplicationsByRequirement:e=>h.get(`/requirements/${e}/applications`),acceptRequirement:e=>h.post(`/requirements/${e}/accept`),approveApplication:(e,t)=>h.post(`/requirements/${e}/applications/${t}/approve`),rejectApplication:(e,t)=>h.post(`/requirements/${e}/applications/${t}/reject`)},results:{getAll:()=>h.get("/results"),getById:e=>h.get(`/results/${e}`),getByUser:e=>h.get(`/results/user/${e}`),getByRequirement:e=>h.get(`/results/requirement/${e}`),create:e=>h.post("/results",e),update:(e,t)=>h.put(`/results/${e}`,t),delete:e=>h.delete(`/results/${e}`)}};var v=g;const f=()=>{const e=localStorage.getItem("user");return e?JSON.parse(e):null},k=()=>localStorage.getItem("token"),y=(0,p.Kh)({user:f(),token:k(),isAuthenticated:!!k(),error:null,loading:!1}),b={isPlatformSupported(){return"undefined"!==typeof window&&window.Capacitor&&window.Capacitor.isNativePlatform()},async register(e){y.loading=!0,y.error=null;try{console.log("开始注册用户...");const t=await v.auth.register(e);return console.log("注册响应:",t?"成功":"失败"),t.data}catch(t){throw console.error("注册失败详细错误:",t),y.error=t.response?.data?.error||"注册失败，请重试",t}finally{y.loading=!1}},async login(e){y.loading=!0,y.error=null;try{console.log("开始登录...");const r=await v.auth.login(e);if(console.log("登录响应:",r?"成功":"失败"),!r||!r.data)throw new Error("登录响应无效");const{user:n,token:s}=r.data;if(localStorage.setItem("user",JSON.stringify(n)),localStorage.setItem("token",s),y.user=n,y.token=s,y.isAuthenticated=!0,this.isPlatformSupported())try{console.log("尝试保存生物识别凭据...");const{NativeBiometric:t}=await i.e(926).then(i.bind(i,4926));await t.setCredentials({username:e.email,password:e.password,server:"lifetree-app"}),console.log("生物识别凭据保存成功")}catch(t){console.error("保存生物识别凭据失败:",t)}return n}catch(t){throw console.error("登录失败详细错误:",t),t.response&&console.error("错误响应:",t.response.data),y.error=t.response?.data?.error||"登录失败，请检查您的凭据",t}finally{y.loading=!1}},async biometricLogin(){y.loading=!0,y.error=null;try{if(!this.isPlatformSupported())throw new Error("非原生环境，无法使用生物识别");console.log("开始生物识别登录...");const{NativeBiometric:e}=await i.e(926).then(i.bind(i,4926)),t=await e.isAvailable();if(console.log("生物识别可用性检查:",t),!t.isAvailable)throw new Error("设备不支持生物识别");console.log("开始生物识别验证..."),await e.verifyIdentity({reason:"登录到生命树应用",title:"生物识别验证",subtitle:"请使用Face ID或Touch ID进行验证",description:"这将允许您快速安全地登录"}),console.log("生物识别验证成功"),console.log("尝试获取存储的凭据...");const r=await e.getCredentials({server:"lifetree-app"});if(console.log("获取到凭据:",r?"成功":"失败"),!r||!r.username||!r.password)throw new Error("没有找到存储的生物识别凭据");console.log("使用凭据尝试登录...");const n=await v.auth.login({email:r.username,password:r.password});if(console.log("登录响应:",n?"成功":"失败"),!n||!n.data)throw new Error("登录响应无效");const{user:s,token:a}=n.data;return localStorage.setItem("user",JSON.stringify(s)),localStorage.setItem("token",a),y.user=s,y.token=a,y.isAuthenticated=!0,s}catch(e){throw console.error("生物识别登录详细错误:",e),y.error="生物识别登录失败: "+(e.message||"未知错误"),e}finally{y.loading=!1}},async logout(){console.log("执行注销..."),localStorage.removeItem("user"),localStorage.removeItem("token"),y.user=null,y.token=null,y.isAuthenticated=!1,console.log("注销完成"),Qi.push("/login")},async getCurrentUser(){if(!y.token)return console.log("无访问令牌，无法获取用户信息"),null;y.loading=!0;try{console.log("开始获取当前用户信息...");const e=await v.user.getCurrentUser();console.log("获取用户信息响应:",e?"成功":"失败");const t=e.data;return localStorage.setItem("user",JSON.stringify(t)),y.user=t,t}catch(e){return console.error("获取用户信息失败:",e),e.response&&401===e.response.status&&(console.log("令牌已过期，执行注销"),await this.logout()),null}finally{y.loading=!1}},async updateUser(e){if(!y.isAuthenticated)return console.log("用户未认证，无法更新用户信息"),null;y.loading=!0;try{console.log("开始更新用户信息...");const t=await v.user.updateUser(e);console.log("更新用户信息响应:",t?"成功":"失败");const i=t.data;return localStorage.setItem("user",JSON.stringify(i)),y.user=i,i}catch(t){throw console.error("更新用户信息失败:",t),y.error=t.response?.data?.error||"更新用户信息失败",t}finally{y.loading=!1}},async isBiometricAvailable(){try{if(!this.isPlatformSupported())return console.log("非原生环境，生物识别不可用"),!1;console.log("检查生物识别可用性...");const{NativeBiometric:t}=await i.e(926).then(i.bind(i,4926)),r=await t.isAvailable();if(console.log("生物识别可用性检查结果:",r),r.isAvailable)try{console.log("检查存储的凭据...");const e=await t.getCredentials({server:"lifetree-app"});return console.log("存储的凭据检查结果:",e?"有凭据":"无凭据"),Boolean(e&&e.username&&e.password)}catch(e){return console.error("获取生物识别凭据失败:",e),!1}return!1}catch(e){return console.error("检查生物识别可用性失败:",e),!1}},async deleteBiometricCredentials(){try{if(!this.isPlatformSupported())return console.log("非原生环境，无法删除生物识别凭据"),!1;console.log("开始删除生物识别凭据...");const{NativeBiometric:e}=await i.e(926).then(i.bind(i,4926));return await e.deleteCredentials({server:"lifetree-app"}),console.log("删除生物识别凭据成功"),!0}catch(e){return console.error("删除生物识别凭据失败:",e),!1}}};var q={state:y,...b};const w={class:"page"};function E(e,t,i,r,s,a){const o=(0,n.g2)("header-bar"),l=(0,n.g2)("nav-bar");return(0,n.uX)(),(0,n.CE)("div",w,[(0,n.bF)(o,{title:"首页","show-back":!1}),t[0]||(t[0]=(0,n.Lk)("div",{class:"page-content home-content"},[(0,n.Lk)("div",{class:"welcome-section"},[(0,n.Lk)("h2",{class:"small-seal-font"},"生命树")])],-1)),(0,n.bF)(l)])}var A=i(33);const R={class:"header-bar"},C={class:"header-title"};function L(e,t,i,r,s,a){const o=(0,n.g2)("van-nav-bar");return(0,n.uX)(),(0,n.CE)("div",R,[(0,n.bF)(o,{"left-text":i.showBack?"返回":"","left-arrow":i.showBack,onClickLeft:a.onClickLeft,"right-text":i.rightText,onClickRight:a.onClickRight},{title:(0,n.k6)((()=>[(0,n.Lk)("span",C,(0,A.v_)(i.title),1)])),_:1},8,["left-text","left-arrow","onClickLeft","right-text","onClickRight"])])}var T={name:"HeaderBar",props:{title:{type:String,default:""},showBack:{type:Boolean,default:!0},rightText:{type:String,default:""}},methods:{onClickLeft(){this.showBack&&this.$router.back()},onClickRight(){this.$emit("right-click")}}};const I=(0,l.A)(T,[["render",L],["__scopeId","data-v-348dafc9"]]);var F=I;const S={class:"nav-bar"},_={class:"custom-icon"},P={class:"icon-circle"};function D(e,t,i,r,s,a){const o=(0,n.g2)("van-tabbar-item"),l=(0,n.g2)("van-icon"),u=(0,n.g2)("van-tabbar");return(0,n.uX)(),(0,n.CE)("div",S,[(0,n.bF)(u,{modelValue:s.active,"onUpdate:modelValue":t[10]||(t[10]=e=>s.active=e),route:""},{default:(0,n.k6)((()=>[(0,n.bF)(o,{to:"/results"},{icon:(0,n.k6)((()=>[(0,n.Lk)("div",{class:"custom-icon",onTouchstart:t[0]||(t[0]=e=>a.handleTouchStart("results")),onTouchend:t[1]||(t[1]=(...e)=>a.handleTouchEnd&&a.handleTouchEnd(...e)),onMousedown:t[2]||(t[2]=e=>a.handleMouseDown("results")),onMouseup:t[3]||(t[3]=(...e)=>a.handleMouseUp&&a.handleMouseUp(...e)),onMouseleave:t[4]||(t[4]=(...e)=>a.handleMouseUp&&a.handleMouseUp(...e))},t[11]||(t[11]=[(0,n.Lk)("div",{class:"icon-circle"},[(0,n.Lk)("img",{src:"https://b.yzcdn.cn/vant/light-theme.svg",alt:"太阳",class:"theme-icon"})],-1)]),32)])),_:1}),(0,n.bF)(o,{to:"/profile"},{icon:(0,n.k6)((()=>[(0,n.Lk)("div",_,[(0,n.Lk)("div",P,[(0,n.bF)(l,{name:"contact",size:"24"})])])])),_:1}),(0,n.bF)(o,{to:"/requirements"},{icon:(0,n.k6)((()=>[(0,n.Lk)("div",{class:"custom-icon",onTouchstart:t[5]||(t[5]=e=>a.handleTouchStart("requirements")),onTouchend:t[6]||(t[6]=(...e)=>a.handleTouchEnd&&a.handleTouchEnd(...e)),onMousedown:t[7]||(t[7]=e=>a.handleMouseDown("requirements")),onMouseup:t[8]||(t[8]=(...e)=>a.handleMouseUp&&a.handleMouseUp(...e)),onMouseleave:t[9]||(t[9]=(...e)=>a.handleMouseUp&&a.handleMouseUp(...e))},t[12]||(t[12]=[(0,n.Lk)("div",{class:"icon-circle"},[(0,n.Lk)("img",{src:"https://b.yzcdn.cn/vant/dark-theme.svg",alt:"月亮",class:"theme-icon"})],-1)]),32)])),_:1})])),_:1},8,["modelValue"])])}var x=i(3326),W={name:"NavBar",data(){return{active:0,longPressTimer:null,longPressDelay:800,currentIcon:null}},watch:{$route(e){"/requirements"===e.path?this.active=0:"/profile"===e.path?this.active=1:"/results"===e.path&&(this.active=2)}},created(){const e=this.$route.path;"/requirements"===e?this.active=0:"/profile"===e?this.active=1:"/results"===e?this.active=2:"/"===e&&(this.active=0)},methods:{handleTouchStart(e){this.currentIcon=e,this.longPressTimer&&clearTimeout(this.longPressTimer),this.longPressTimer=setTimeout((()=>{this.onLongPress(e)}),this.longPressDelay)},handleTouchEnd(){this.longPressTimer&&(clearTimeout(this.longPressTimer),this.longPressTimer=null),this.currentIcon=null},handleMouseDown(e){this.currentIcon=e,this.longPressTimer&&clearTimeout(this.longPressTimer),this.longPressTimer=setTimeout((()=>{this.onLongPress(e)}),this.longPressDelay)},handleMouseUp(){this.longPressTimer&&(clearTimeout(this.longPressTimer),this.longPressTimer=null),this.currentIcon=null},onLongPress(e){"requirements"===e?this.$router.push("/requirement/new"):"results"===e&&this.$router.push("/result/new"),(0,x.P0)({message:`正在前往${"requirements"===e?"新建需求":"新建结果"}页面...`,type:"success"})}}};const $=(0,l.A)(W,[["render",D],["__scopeId","data-v-779e60c8"]]);var X=$,B={name:"HomePage",components:{HeaderBar:F,NavBar:X}};const N=(0,l.A)(B,[["render",E],["__scopeId","data-v-158472a2"]]);var M=N;const O={class:"page"},V={class:"page-content"};function U(e,t,i,r,s,a){const o=(0,n.g2)("header-bar"),l=(0,n.g2)("van-empty"),u=(0,n.g2)("van-cell"),c=(0,n.g2)("van-cell-group"),d=(0,n.g2)("van-loading"),p=(0,n.g2)("nav-bar");return(0,n.uX)(),(0,n.CE)("div",O,[(0,n.bF)(o,{title:"需求列表","show-back":!1}),(0,n.Lk)("div",V,[s.loading||0!==s.requirementsList.length?((0,n.uX)(),(0,n.Wv)(c,{key:1,class:"list-container"},{default:(0,n.k6)((()=>[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(a.limitedRequirementsList,(e=>((0,n.uX)(),(0,n.Wv)(u,{key:e.id,title:e.title,"is-link":"",onClick:t=>a.goToDetail(e.id),class:"list-item"},null,8,["title","onClick"])))),128))])),_:1})):((0,n.uX)(),(0,n.Wv)(l,{key:0,description:"暂无需求数据"}))]),s.initialLoading?((0,n.uX)(),(0,n.Wv)(d,{key:0,vertical:"",class:"loading-overlay"},{default:(0,n.k6)((()=>t[0]||(t[0]=[(0,n.eW)("加载中...")]))),_:1})):(0,n.Q3)("",!0),(0,n.bF)(p)])}i(2489);var j={name:"Requirements",components:{HeaderBar:F,NavBar:X},data(){return{requirementsList:[],loading:!1,initialLoading:!0}},computed:{limitedRequirementsList(){const e=this.requirementsList.filter((e=>"CREATED"===e.status||"CONFIRMING"===e.status)),t=[...e].sort(((e,t)=>e.updatedAt&&t.updatedAt?new Date(t.updatedAt)-new Date(e.updatedAt):e.createdAt&&t.createdAt?new Date(t.createdAt)-new Date(e.createdAt):0));return t.slice(0,3)}},created(){this.fetchRequirements()},mounted(){window.addEventListener("focus",this.refreshOnFocus)},beforeUnmount(){window.removeEventListener("focus",this.refreshOnFocus)},methods:{async fetchRequirements(){try{this.initialLoading=!0;const e=await v.requirements.getAll();console.log(e),this.requirementsList=JSON.parse(JSON.stringify(e.data)),console.log("获取到的需求数据:",this.requirementsList)}catch(e){console.error("Error fetching requirements:",e),(0,x.xr)("获取需求列表失败")}finally{this.initialLoading=!1}},refreshOnFocus(){"/requirements"===this.$route.path&&this.fetchRequirements()},goToDetail(e){this.$router.push(`/requirement/${e}`)}}};const z=(0,l.A)(j,[["render",U],["__scopeId","data-v-53956121"]]);var H=z;const G={class:"page"},K={class:"page-content"};function J(e,t,i,r,s,a){const o=(0,n.g2)("header-bar"),l=(0,n.g2)("van-empty"),u=(0,n.g2)("van-cell"),c=(0,n.g2)("van-cell-group"),d=(0,n.g2)("van-loading"),p=(0,n.g2)("nav-bar");return(0,n.uX)(),(0,n.CE)("div",G,[(0,n.bF)(o,{title:"结果列表","show-back":!1}),(0,n.Lk)("div",K,[s.loading||0!==s.resultsList.length?((0,n.uX)(),(0,n.Wv)(c,{key:1,class:"list-container"},{default:(0,n.k6)((()=>[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(a.limitedResultsList,(e=>((0,n.uX)(),(0,n.Wv)(u,{key:e.id,title:e.title,"is-link":"",onClick:t=>a.goToDetail(e.id),class:"list-item"},null,8,["title","onClick"])))),128))])),_:1})):((0,n.uX)(),(0,n.Wv)(l,{key:0,description:"暂无结果数据"}))]),s.initialLoading?((0,n.uX)(),(0,n.Wv)(d,{key:0,vertical:"",class:"loading-overlay"},{default:(0,n.k6)((()=>t[0]||(t[0]=[(0,n.eW)("加载中...")]))),_:1})):(0,n.Q3)("",!0),(0,n.bF)(p)])}var Q={name:"Results",components:{HeaderBar:F,NavBar:X},data(){return{resultsList:[],loading:!1,initialLoading:!0}},computed:{limitedResultsList(){return this.resultsList.slice(0,3)}},created(){this.fetchResults()},methods:{async fetchResults(){try{const e=await v.results.getAll();this.resultsList=e.data.sort(((e,t)=>new Date(t.createdAt)-new Date(e.createdAt))),this.initialLoading=!1}catch(e){console.error("Error fetching results:",e),(0,x.xr)("获取结果列表失败"),this.initialLoading=!1}},goToDetail(e){this.$router.push(`/result/${e}`)},getStatusText(e){const t={DRAFT:"草稿",COMPLETED:"已完成",ARCHIVED:"已归档",REJECTED:"已拒绝"};return t[e]||"未知状态"},getStatusType(e){const t={DRAFT:"primary",COMPLETED:"success",ARCHIVED:"warning",REJECTED:"danger"};return t[e]||"default"}}};const Z=(0,l.A)(Q,[["render",J],["__scopeId","data-v-05c8b3ad"]]);var Y=Z;const ee={class:"page"},te={class:"page-content"},ie={class:"profile-avatar"},re={class:"action-buttons logout-button"},ne={class:"popup-header"},se={class:"applications-list"},ae={class:"application-actions"};function oe(e,t,i,s,a,o){const l=(0,n.g2)("header-bar"),u=(0,n.g2)("van-icon"),c=(0,n.g2)("van-cell"),d=(0,n.g2)("van-cell-group"),p=(0,n.g2)("van-button"),m=(0,n.g2)("van-list"),h=(0,n.g2)("van-tab"),g=(0,n.g2)("van-tag"),v=(0,n.g2)("van-tabs"),f=(0,n.g2)("van-loading"),k=(0,n.g2)("van-empty"),y=(0,n.g2)("van-popup"),b=(0,n.g2)("nav-bar");return(0,n.uX)(),(0,n.CE)("div",ee,[(0,n.bF)(l,{title:"个人信息","show-back":!1}),(0,n.Lk)("div",te,[(0,n.Lk)("div",ie,[(0,n.bF)(u,{name:"contact",size:"64"})]),(0,n.bF)(d,{inset:""},{default:(0,n.k6)((()=>[(0,n.bF)(c,{title:"用户名",value:a.user.name},null,8,["value"]),(0,n.bF)(c,{title:"邮箱",value:a.user.email},null,8,["value"])])),_:1}),(0,n.Lk)("div",re,[(0,n.bF)(p,{type:"default",block:"",onClick:o.logout},{default:(0,n.k6)((()=>t[5]||(t[5]=[(0,n.eW)("退出登录")]))),_:1},8,["onClick"])]),(0,n.bF)(v,{active:a.activeTab,"onUpdate:active":t[2]||(t[2]=e=>a.activeTab=e),sticky:""},{default:(0,n.k6)((()=>[(0,n.bF)(h,{title:"我的需求"},{default:(0,n.k6)((()=>[t[6]||(t[6]=(0,n.Lk)("div",{class:"section-header my-requirements-header"},[(0,n.Lk)("div",{class:"section-title"},"我创建的需求")],-1)),(0,n.bF)(m,{loading:a.myRequirementsLoading,"onUpdate:loading":t[0]||(t[0]=e=>a.myRequirementsLoading=e),finished:a.myRequirementsFinished,"finished-text":"没有更多了",onLoad:o.loadMyRequirements},{default:(0,n.k6)((()=>[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(a.myRequirements,(e=>((0,n.uX)(),(0,n.Wv)(c,{key:e.id,title:e.title,label:o.getPendingApplicantsInfo(e),"is-link":"",onClick:t=>o.goToRequirementDetail(e.id)},(0,n.eX)({_:2},[e.pendingApplicationsCount>0?{name:"right-icon",fn:(0,n.k6)((()=>[(0,n.bF)(p,{size:"small",type:"primary",onClick:(0,r.D$)((t=>o.viewApplications(e.id)),["stop"])},{default:(0,n.k6)((()=>[(0,n.eW)(" 查看申请("+(0,A.v_)(e.pendingApplicationsCount)+") ",1)])),_:2},1032,["onClick"])])),key:"0"}:void 0]),1032,["title","label","onClick"])))),128))])),_:1},8,["loading","finished","onLoad"])])),_:1}),(0,n.bF)(h,{title:"我的申请"},{default:(0,n.k6)((()=>[t[7]||(t[7]=(0,n.Lk)("div",{class:"section-header my-applications-header"},[(0,n.Lk)("div",{class:"section-title"},"我申请的需求")],-1)),(0,n.bF)(m,{loading:a.pendingRequirementsLoading,"onUpdate:loading":t[1]||(t[1]=e=>a.pendingRequirementsLoading=e),finished:a.pendingRequirementsFinished,"finished-text":"没有更多了",onLoad:o.loadPendingRequirements},{default:(0,n.k6)((()=>[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(a.pendingRequirements,(e=>((0,n.uX)(),(0,n.Wv)(c,{key:e.id,title:e.title,"is-link":"",onClick:t=>o.goToRequirementDetail(e.id)},{"right-icon":(0,n.k6)((()=>[(0,n.bF)(g,{type:o.getApplicationStatusType(e.applicationStatus),class:"custom-tag",round:""},{default:(0,n.k6)((()=>[(0,n.eW)((0,A.v_)(o.getApplicationStatusText(e.applicationStatus)),1)])),_:2},1032,["type"])])),_:2},1032,["title","onClick"])))),128))])),_:1},8,["loading","finished","onLoad"])])),_:1})])),_:1},8,["active"])]),(0,n.bF)(y,{show:a.showApplicationsPopup,"onUpdate:show":t[4]||(t[4]=e=>a.showApplicationsPopup=e),position:"bottom",style:{height:"60%"},round:""},{default:(0,n.k6)((()=>[(0,n.Lk)("div",ne,[t[8]||(t[8]=(0,n.Lk)("div",{class:"popup-title"},"申请列表",-1)),(0,n.bF)(u,{name:"cross",onClick:t[3]||(t[3]=e=>a.showApplicationsPopup=!1)})]),(0,n.Lk)("div",se,[a.applicationsLoading?((0,n.uX)(),(0,n.Wv)(f,{key:0,vertical:""},{default:(0,n.k6)((()=>t[9]||(t[9]=[(0,n.eW)("加载中...")]))),_:1})):((0,n.uX)(),(0,n.CE)(n.FK,{key:1},[0===a.applications.length?((0,n.uX)(),(0,n.Wv)(k,{key:0,description:"暂无申请"})):((0,n.uX)(),(0,n.Wv)(d,{key:1},{default:(0,n.k6)((()=>[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(a.applications,(e=>((0,n.uX)(),(0,n.Wv)(c,{key:e.id,title:e.applicantName,label:o.formatDate(e.createdAt),value:o.getApplicationStatusText(e.status),"value-class":o.getApplicationStatusClass(e.status)},(0,n.eX)({_:2},["PENDING"===e.status?{name:"right-icon",fn:(0,n.k6)((()=>[(0,n.Lk)("div",ae,[(0,n.bF)(p,{size:"small",type:"success",onClick:t=>o.approveApplication(e.requirementId,e.id),loading:a.approvingId===e.id},{default:(0,n.k6)((()=>t[10]||(t[10]=[(0,n.eW)(" 同意 ")]))),_:2},1032,["onClick","loading"]),(0,n.bF)(p,{size:"small",type:"danger",onClick:t=>o.rejectApplication(e.requirementId,e.id),loading:a.rejectingId===e.id},{default:(0,n.k6)((()=>t[11]||(t[11]=[(0,n.eW)(" 拒绝 ")]))),_:2},1032,["onClick","loading"])])])),key:"0"}:void 0]),1032,["title","label","value","value-class"])))),128))])),_:1}))],64))])])),_:1},8,["show"]),(0,n.bF)(b)])}var le={name:"ProfilePage",components:{HeaderBar:F,NavBar:X},data(){return{user:{id:"",name:"",email:""},activeTab:0,myRequirements:[],myRequirementsLoading:!1,myRequirementsFinished:!1,pendingRequirements:[],pendingRequirementsLoading:!1,pendingRequirementsFinished:!1,showApplicationsPopup:!1,applications:[],applicationsLoading:!1,currentRequirementId:null,approvingId:null,rejectingId:null}},created(){this.fetchUserData()},methods:{fetchUserData(){this.user=q.state.user||{name:"未知用户",email:"未知邮箱"}},async loadMyRequirements(){try{const e=await v.requirements.getMyRequirementsWithApplications();this.myRequirements=e.data,this.myRequirementsFinished=!0,this.myRequirementsLoading=!1}catch(e){console.error("Error loading my requirements:",e),(0,x.xr)("加载需求失败"),this.myRequirementsLoading=!1}},async loadPendingRequirements(){try{const e=await v.requirements.getMyApplications();this.pendingRequirements=e.data,this.pendingRequirementsFinished=!0,this.pendingRequirementsLoading=!1}catch(e){console.error("Error loading pending requirements:",e),(0,x.xr)("加载申请失败"),this.pendingRequirementsLoading=!1}},async loadApplications(e){this.applicationsLoading=!0,this.currentRequirementId=e;try{const t=await v.requirements.getApplicationsByRequirement(e);this.applications=t.data}catch(t){console.error("Error loading applications:",t),(0,x.xr)("加载申请列表失败")}finally{this.applicationsLoading=!1}},viewApplications(e){this.loadApplications(e),this.showApplicationsPopup=!0},async approveApplication(e,t){this.approvingId=t;try{await v.requirements.approveApplication(e,t),(0,x.GF)("已同意申请"),this.loadApplications(e),this.loadMyRequirements()}catch(i){console.error("Error approving application:",i),(0,x.xr)("操作失败")}finally{this.approvingId=null}},async rejectApplication(e,t){this.rejectingId=t;try{await v.requirements.rejectApplication(e,t),(0,x.GF)("已拒绝申请"),this.loadApplications(e),this.loadMyRequirements()}catch(i){console.error("Error rejecting application:",i),(0,x.xr)("操作失败")}finally{this.rejectingId=null}},getPendingApplicantsInfo(e){return e.pendingApplicationsCount>0?`${e.pendingApplicationsCount}人申请 | 状态: ${this.getStatusText(e.status)}`:`状态: ${this.getStatusText(e.status)}`},getStatusText(e){const t={CREATED:"已创建",CONFIRMING:"确认中",IN_PROGRESS:"进行中",COMPLETED:"已完成",CANCELLED:"已取消"};return t[e]||"未知状态"},getApplicationStatusText(e){const t={PENDING:"等待确认",APPROVED:"已同意",REJECTED:"已拒绝"};return t[e]||"未知状态"},getApplicationStatusType(e){const t={PENDING:"warning",APPROVED:"success",REJECTED:"danger"};return t[e]||"default"},getApplicationStatusClass(e){const t={PENDING:"status-pending",APPROVED:"status-approved",REJECTED:"status-rejected"};return t[e]||""},formatDate(e){if(!e)return"";const t=new Date(e);return t.toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})},goToRequirementDetail(e){this.$router.push(`/requirement/${e}`)},logout(){q.logout(),this.$router.push("/login")}}};const ue=(0,l.A)(le,[["render",oe],["__scopeId","data-v-e013082a"]]);var ce=ue;const de={class:"page"},pe={class:"page-content"},me={class:"detail-header"},he={class:"detail-meta"},ge={class:"status-row"},ve={key:0,class:"application-count"},fe={class:"detail-content"},ke=["innerHTML"],ye={class:"agreement-section"},be={key:0,class:"agreement-preview"},qe=["innerHTML"],we={key:0,class:"agreement-actions"},Ee={key:1,class:"no-agreement"},Ae={class:"application-actions"},Re={class:"agreement-popup"},Ce={class:"popup-header"},Le={class:"popup-content"},Te={class:"bottom-action-bar"},Ie={class:"icon-circle"};function Fe(e,t,i,r,s,a){const o=(0,n.g2)("header-bar"),l=(0,n.g2)("van-loading"),u=(0,n.g2)("van-tag"),c=(0,n.g2)("van-cell-group"),d=(0,n.g2)("van-button"),p=(0,n.g2)("van-icon"),m=(0,n.g2)("van-cell"),h=(0,n.g2)("van-action-sheet"),g=(0,n.g2)("agreement-display"),v=(0,n.g2)("van-popup");return(0,n.uX)(),(0,n.CE)("div",de,[(0,n.bF)(o,{title:"需求详情"}),(0,n.Lk)("div",pe,[s.loading?((0,n.uX)(),(0,n.Wv)(l,{key:0,vertical:"",class:"loading-overlay"},{default:(0,n.k6)((()=>t[6]||(t[6]=[(0,n.eW)("加载中...")]))),_:1})):((0,n.uX)(),(0,n.CE)(n.FK,{key:1},[(0,n.Lk)("div",me,[(0,n.Lk)("h2",null,(0,A.v_)(s.requirement.title),1),(0,n.Lk)("div",he,[(0,n.Lk)("div",ge,[(0,n.bF)(u,{type:a.getStatusType(s.requirement.status),class:"custom-tag",round:""},{default:(0,n.k6)((()=>[(0,n.eW)((0,A.v_)(a.getStatusText(s.requirement.status)),1)])),_:1},8,["type"]),s.pendingApplicationsCount>0?((0,n.uX)(),(0,n.CE)("span",ve,(0,A.v_)(s.pendingApplicationsCount)+"人申请 ",1)):(0,n.Q3)("",!0)]),(0,n.Lk)("span",null,"发布时间: "+(0,A.v_)(a.formatDate(s.requirement.createdAt)),1)])]),(0,n.bF)(c,{inset:"",title:"需求描述"},{default:(0,n.k6)((()=>[(0,n.Lk)("div",fe,[(0,n.Lk)("p",{innerHTML:s.requirement.description},null,8,ke)])])),_:1}),(0,n.bF)(c,{inset:"",title:"协议内容",style:{"margin-top":"16px"}},{default:(0,n.k6)((()=>[(0,n.Lk)("div",ye,[s.requirement.agreement?((0,n.uX)(),(0,n.CE)("div",be,[(0,n.Lk)("div",{innerHTML:a.previewAgreement,class:"agreement-content"},null,8,qe),a.hasPermission?((0,n.uX)(),(0,n.CE)("div",we,[(0,n.bF)(d,{type:"primary",size:"small",onClick:a.goToEditAgreement},{default:(0,n.k6)((()=>t[7]||(t[7]=[(0,n.eW)(" 编辑协议 ")]))),_:1},8,["onClick"])])):(0,n.Q3)("",!0),s.previewMode?(0,n.Q3)("",!0):((0,n.uX)(),(0,n.CE)("div",{key:1,class:"agreement-view-more",onClick:t[0]||(t[0]=(...e)=>a.showFullAgreement&&a.showFullAgreement(...e))},[t[8]||(t[8]=(0,n.Lk)("span",null,"查看完整协议",-1)),(0,n.bF)(p,{name:"arrow-down"})]))])):((0,n.uX)(),(0,n.CE)("div",Ee,[t[10]||(t[10]=(0,n.Lk)("p",null,"此需求暂无协议内容",-1)),a.hasPermission?((0,n.uX)(),(0,n.Wv)(d,{key:0,type:"primary",size:"small",onClick:a.goToEditAgreement},{default:(0,n.k6)((()=>t[9]||(t[9]=[(0,n.eW)(" 添加协议 ")]))),_:1},8,["onClick"])):(0,n.Q3)("",!0)]))])])),_:1}),a.hasPermission&&s.pendingApplicationsCount>0?((0,n.uX)(),(0,n.Wv)(c,{key:0,inset:"",title:"申请人列表",style:{"margin-top":"16px"}},{default:(0,n.k6)((()=>[s.applicationsLoading?((0,n.uX)(),(0,n.Wv)(l,{key:0,size:"24px"},{default:(0,n.k6)((()=>t[11]||(t[11]=[(0,n.eW)("加载中...")]))),_:1})):((0,n.uX)(!0),(0,n.CE)(n.FK,{key:1},(0,n.pI)(s.pendingApplications,(e=>((0,n.uX)(),(0,n.Wv)(m,{key:e.id,title:e.applicantName,label:a.formatDate(e.createdAt)},{"right-icon":(0,n.k6)((()=>[(0,n.Lk)("div",Ae,[(0,n.bF)(d,{size:"small",type:"success",onClick:t=>a.approveApplication(e.id),loading:s.approvingId===e.id},{default:(0,n.k6)((()=>t[12]||(t[12]=[(0,n.eW)(" 同意 ")]))),_:2},1032,["onClick","loading"]),(0,n.bF)(d,{size:"small",type:"danger",onClick:t=>a.rejectApplication(e.id),loading:s.rejectingId===e.id},{default:(0,n.k6)((()=>t[13]||(t[13]=[(0,n.eW)(" 拒绝 ")]))),_:2},1032,["onClick","loading"])])])),_:2},1032,["title","label"])))),128))])),_:1})):(0,n.Q3)("",!0),a.hasPermission?((0,n.uX)(),(0,n.Wv)(c,{key:1,inset:"",title:"操作",style:{"margin-top":"16px"}},{default:(0,n.k6)((()=>[(0,n.bF)(m,{title:"查看相关结果","is-link":"",onClick:a.goToResults},null,8,["onClick"]),(0,n.bF)(m,{title:"更改状态","is-link":"",onClick:t[1]||(t[1]=e=>s.showStatusActionSheet=!0)}),(0,n.bF)(m,{title:"删除需求","is-link":"",onClick:a.confirmDelete},null,8,["onClick"])])),_:1})):((0,n.uX)(),(0,n.Wv)(c,{key:2,inset:"",title:"操作",style:{"margin-top":"16px"}},{default:(0,n.k6)((()=>[(0,n.bF)(m,{title:"查看相关结果","is-link":"",onClick:a.goToResults},null,8,["onClick"])])),_:1}))],64))]),(0,n.bF)(h,{show:s.showStatusActionSheet,"onUpdate:show":t[2]||(t[2]=e=>s.showStatusActionSheet=e),actions:s.statusActions,"cancel-text":"取消",onSelect:a.onSelectStatus},null,8,["show","actions","onSelect"]),(0,n.bF)(v,{show:s.showAgreementPopup,"onUpdate:show":t[4]||(t[4]=e=>s.showAgreementPopup=e),position:"bottom",style:{height:"80%"},round:""},{default:(0,n.k6)((()=>[(0,n.Lk)("div",Re,[(0,n.Lk)("div",Ce,[t[14]||(t[14]=(0,n.Lk)("div",{class:"popup-title"},"协议详情",-1)),(0,n.bF)(p,{name:"cross",onClick:t[3]||(t[3]=e=>s.showAgreementPopup=!1)})]),(0,n.Lk)("div",Le,[(0,n.bF)(g,{content:s.requirement.agreement,title:"需求协议 - "+s.requirement.title,showActions:!1},null,8,["content","title"])])])])),_:1},8,["show"]),(0,n.Lk)("div",Te,[(0,n.Lk)("div",{onClick:t[5]||(t[5]=(...e)=>a.goToAgreement&&a.goToAgreement(...e))},[(0,n.Lk)("div",Ie,[(0,n.bF)(p,{name:"friends-o",size:"24"})])])])])}const Se={class:"agreement-display"},_e={class:"display-header"},Pe={class:"display-content"},De=["innerHTML"],xe={key:1,class:"no-agreement"},We={key:0,class:"display-actions"};function $e(e,t,i,r,s,a){const o=(0,n.g2)("van-button");return(0,n.uX)(),(0,n.CE)("div",Se,[(0,n.Lk)("div",_e,[(0,n.Lk)("h3",null,(0,A.v_)(i.title),1)]),(0,n.Lk)("div",Pe,[i.content?((0,n.uX)(),(0,n.CE)("div",{key:0,innerHTML:i.content,class:"agreement-content"},null,8,De)):((0,n.uX)(),(0,n.CE)("div",xe,"暂无协议内容"))]),i.showActions?((0,n.uX)(),(0,n.CE)("div",We,[(0,n.bF)(o,{type:"primary",block:"",onClick:a.agree,loading:i.loading,disabled:i.loading},{default:(0,n.k6)((()=>t[0]||(t[0]=[(0,n.eW)(" 我已阅读并同意此协议 ")]))),_:1},8,["onClick","loading","disabled"]),(0,n.bF)(o,{type:"default",block:"",onClick:a.goBack,class:"back-button"},{default:(0,n.k6)((()=>t[1]||(t[1]=[(0,n.eW)(" 返回 ")]))),_:1},8,["onClick"])])):(0,n.Q3)("",!0)])}var Xe={name:"AgreementDisplay",props:{content:{type:String,default:""},title:{type:String,default:"协议内容"},showActions:{type:Boolean,default:!0},loading:{type:Boolean,default:!1}},methods:{agree(){this.$emit("agree")},goBack(){this.$emit("back")}}};const Be=(0,l.A)(Xe,[["render",$e],["__scopeId","data-v-65191c0c"]]);var Ne=Be,Me=i(5749),Oe={name:"RequirementDetailPage",components:{HeaderBar:F,AgreementDisplay:Ne},props:{id:{type:[String,Number],required:!0}},data(){return{requirement:{id:"",title:"",description:"",status:"",agreement:"",createdBy:"",createdAt:"",updatedAt:""},loading:!0,pendingApplicationsCount:0,pendingApplications:[],applicationsLoading:!1,showStatusActionSheet:!1,showAgreementPopup:!1,previewMode:!1,statusActions:[{name:"已创建",value:"CREATED"},{name:"进行中",value:"IN_PROGRESS"},{name:"已完成",value:"COMPLETED"},{name:"已取消",value:"CANCELLED"}],approvingId:null,rejectingId:null}},computed:{hasPermission(){const e=q.state.user;return!!e&&("ADMIN"===e.role||e.id===this.requirement.createdBy)},previewAgreement(){if(!this.requirement.agreement)return"";if(!this.previewMode)return this.requirement.agreement;const e=document.createElement("div");e.innerHTML=this.requirement.agreement;const t=e.textContent||e.innerText;return t.length<=300?this.requirement.agreement:this.requirement.agreement.substring(0,300)+"..."}},created(){this.fetchRequirementDetail(),this.previewMode=!0},methods:{async fetchRequirementDetail(){this.loading=!0;try{const e=await v.requirements.getById(this.id);this.requirement=e.data,this.hasPermission&&this.fetchApplications()}catch(e){console.error("Error fetching requirement detail:",e),(0,x.xr)("获取需求详情失败")}finally{this.loading=!1}},async fetchApplications(){this.applicationsLoading=!0;try{const e=await v.requirements.getApplicationsByRequirement(this.id);this.pendingApplications=e.data.filter((e=>"PENDING"===e.status)),this.pendingApplicationsCount=this.pendingApplications.length}catch(e){console.error("Error fetching applications:",e)}finally{this.applicationsLoading=!1}},async approveApplication(e){this.approvingId=e;try{await v.requirements.approveApplication(this.id,e),(0,x.GF)("已同意申请"),this.fetchRequirementDetail()}catch(t){console.error("Error approving application:",t),(0,x.xr)("操作失败: "+(t.response?.data?.message||"未知错误"))}finally{this.approvingId=null}},async rejectApplication(e){this.rejectingId=e;try{await v.requirements.rejectApplication(this.id,e),(0,x.GF)("已拒绝申请"),this.fetchRequirementDetail()}catch(t){console.error("Error rejecting application:",t),(0,x.xr)("操作失败: "+(t.response?.data?.message||"未知错误"))}finally{this.rejectingId=null}},formatDate(e){if(!e)return"未知";const t=new Date(e);return t.toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})},getStatusText(e){const t={CREATED:"已创建",CONFIRMING:"确认中",IN_PROGRESS:"进行中",COMPLETED:"已完成",CANCELLED:"已取消"};return t[e]||"未知状态"},getStatusType(e){const t={CREATED:"primary",CONFIRMING:"warning",IN_PROGRESS:"success",COMPLETED:"success",CANCELLED:"danger"};return t[e]||"default"},async onSelectStatus(e){if(this.hasPermission)try{await v.requirements.update(this.id,{status:e.value}),this.requirement.status=e.value,(0,x.GF)("状态更新成功")}catch(t){console.error("Error updating status:",t),(0,x.xr)("状态更新失败")}else(0,x.xr)("您没有权限执行此操作")},confirmDelete(){this.hasPermission?(0,Me.M5)({title:"确认删除",message:"确定要删除这个需求吗？此操作不可撤销！"}).then((async()=>{try{await v.requirements.delete(this.id),(0,x.GF)("需求已删除"),this.$router.push("/requirements")}catch(e){console.error("Error deleting requirement:",e),(0,x.xr)("删除需求失败")}})).catch((()=>{})):(0,x.xr)("您没有权限执行此操作")},goToEditAgreement(){this.$router.push(`/requirement/${this.id}/agreement/edit`)},showFullAgreement(){this.showAgreementPopup=!0},goToAgreement(){this.$router.push({path:"/agreement",query:{requirementId:this.id,status:this.requirement.status}})},goToResults(){this.$router.push(`/results/requirement/${this.id}`)}}};const Ve=(0,l.A)(Oe,[["render",Fe],["__scopeId","data-v-28fd91d8"]]);var Ue=Ve;const je={class:"page"},ze={class:"page-content"},He={class:"detail-header"},Ge={class:"detail-meta"},Ke={class:"status-row"},Je={class:"detail-content"},Qe=["innerHTML"];function Ze(e,t,i,r,s,a){const o=(0,n.g2)("header-bar"),l=(0,n.g2)("van-loading"),u=(0,n.g2)("van-tag"),c=(0,n.g2)("van-cell-group"),d=(0,n.g2)("van-cell"),p=(0,n.g2)("van-action-sheet");return(0,n.uX)(),(0,n.CE)("div",je,[a.hasPermission?((0,n.uX)(),(0,n.Wv)(o,{key:0,title:s.result.title||"结果详情","right-text":"编辑",onRightClick:a.goToEdit},null,8,["title","onRightClick"])):((0,n.uX)(),(0,n.Wv)(o,{key:1,title:s.result.title||"结果详情"},null,8,["title"])),(0,n.Lk)("div",ze,[s.loading?((0,n.uX)(),(0,n.Wv)(l,{key:0,vertical:"",class:"loading-overlay"},{default:(0,n.k6)((()=>t[2]||(t[2]=[(0,n.eW)("加载中...")]))),_:1})):((0,n.uX)(),(0,n.CE)(n.FK,{key:1},[(0,n.Lk)("div",He,[(0,n.Lk)("h2",null,(0,A.v_)(s.result.title),1),(0,n.Lk)("div",Ge,[(0,n.Lk)("div",Ke,[(0,n.bF)(u,{type:a.getStatusType(s.result.status),class:"custom-tag",round:""},{default:(0,n.k6)((()=>[(0,n.eW)((0,A.v_)(a.getStatusText(s.result.status)),1)])),_:1},8,["type"])]),(0,n.Lk)("span",null,"创建时间: "+(0,A.v_)(a.formatDate(s.result.createdAt)),1),(0,n.Lk)("span",null,"更新时间: "+(0,A.v_)(a.formatDate(s.result.updatedAt)),1)])]),(0,n.bF)(c,{inset:"",title:"结果描述"},{default:(0,n.k6)((()=>[(0,n.Lk)("div",Je,[(0,n.Lk)("p",{innerHTML:s.result.description},null,8,Qe)])])),_:1}),s.result.relatedRequirementId?((0,n.uX)(),(0,n.Wv)(c,{key:0,inset:"",title:"关联需求"},{default:(0,n.k6)((()=>[(0,n.bF)(d,{title:s.relatedRequirementTitle||"查看关联需求","is-link":"",onClick:a.goToRelatedRequirement},null,8,["title","onClick"])])),_:1})):(0,n.Q3)("",!0),a.hasPermission?((0,n.uX)(),(0,n.Wv)(c,{key:1,inset:"",title:"操作",style:{"margin-top":"16px"}},{default:(0,n.k6)((()=>[(0,n.bF)(d,{title:"更改状态","is-link":"",onClick:t[0]||(t[0]=e=>s.showStatusActionSheet=!0)}),(0,n.bF)(d,{title:"删除结果","is-link":"",onClick:a.confirmDelete},null,8,["onClick"])])),_:1})):(0,n.Q3)("",!0)],64))]),(0,n.bF)(p,{show:s.showStatusActionSheet,"onUpdate:show":t[1]||(t[1]=e=>s.showStatusActionSheet=e),actions:s.statusActions,"cancel-text":"取消",onSelect:a.onSelectStatus},null,8,["show","actions","onSelect"])])}var Ye={name:"ResultDetailPage",components:{HeaderBar:F},props:{id:{type:String,required:!0}},data(){return{result:{id:"",title:"",description:"",status:"",relatedRequirementId:null,createdBy:"",createdAt:"",updatedAt:""},relatedRequirementTitle:"",loading:!0,showStatusActionSheet:!1,statusActions:[{name:"草稿",value:"DRAFT"},{name:"已完成",value:"COMPLETED"},{name:"已归档",value:"ARCHIVED"},{name:"已拒绝",value:"REJECTED"}]}},computed:{hasPermission(){const e=q.state.user;return!!e&&("ADMIN"===e.role||e.id===this.result.createdBy)}},created(){this.fetchResultDetail()},methods:{async fetchResultDetail(){this.loading=!0;try{const e=await v.results.getById(this.id);this.result=e.data,this.result.relatedRequirementId&&this.fetchRelatedRequirement(this.result.relatedRequirementId)}catch(e){console.error("Error fetching result detail:",e),(0,x.xr)("获取结果详情失败")}finally{this.loading=!1}},async fetchRelatedRequirement(e){try{const t=await v.requirements.getById(e);this.relatedRequirementTitle=t.data.title}catch(t){console.error("Error fetching related requirement:",t),this.relatedRequirementTitle="未能获取需求标题"}},formatDate(e){if(!e)return"未知";const t=new Date(e);return t.toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})},getStatusText(e){const t={DRAFT:"草稿",COMPLETED:"已完成",ARCHIVED:"已归档",REJECTED:"已拒绝"};return t[e]||"未知状态"},getStatusType(e){const t={DRAFT:"primary",COMPLETED:"success",ARCHIVED:"warning",REJECTED:"danger"};return t[e]||"default"},async onSelectStatus(e){if(this.hasPermission)try{await v.results.update(this.id,{status:e.value}),this.result.status=e.value,(0,x.GF)("状态更新成功")}catch(t){console.error("Error updating status:",t),(0,x.xr)("状态更新失败")}else(0,x.xr)("您没有权限执行此操作")},confirmDelete(){this.hasPermission?(0,Me.M5)({title:"确认删除",message:"确定要删除这个结果吗？此操作不可撤销！"}).then((async()=>{try{await v.results.delete(this.id),(0,x.GF)("结果已删除"),this.$router.push("/results")}catch(e){console.error("Error deleting result:",e),(0,x.xr)("删除结果失败")}})).catch((()=>{})):(0,x.xr)("您没有权限执行此操作")},goToEdit(){this.hasPermission?this.$router.push(`/result/edit/${this.id}`):(0,x.xr)("您没有权限执行此操作")},goToRelatedRequirement(){this.result.relatedRequirementId&&this.$router.push(`/requirement/${this.result.relatedRequirementId}`)}}};const et=(0,l.A)(Ye,[["render",Ze],["__scopeId","data-v-be9cfd0c"]]);var tt=et;const it={class:"page"},rt={class:"page-content"},nt={class:"applied-popup"};function st(e,t,i,r,s,a){const o=(0,n.g2)("header-bar"),l=(0,n.g2)("van-loading"),u=(0,n.g2)("agreement-display"),c=(0,n.g2)("van-icon"),d=(0,n.g2)("van-button"),p=(0,n.g2)("van-popup");return(0,n.uX)(),(0,n.CE)("div",it,[(0,n.bF)(o,{title:"协议"}),(0,n.Lk)("div",rt,[s.loading?((0,n.uX)(),(0,n.Wv)(l,{key:0,vertical:"",class:"loading-overlay"},{default:(0,n.k6)((()=>t[1]||(t[1]=[(0,n.eW)("加载中...")]))),_:1})):((0,n.uX)(),(0,n.CE)(n.FK,{key:1},[(0,n.bF)(u,{content:s.requirement.agreement,title:"需求协议 - "+s.requirement.title,showActions:!0,loading:s.applying,onAgree:a.acceptRequirement,onBack:a.goBack},null,8,["content","title","loading","onAgree","onBack"]),(0,n.bF)(p,{show:s.showAlreadyAppliedPopup,"onUpdate:show":t[0]||(t[0]=e=>s.showAlreadyAppliedPopup=e),round:"",position:"bottom",style:{height:"30%"}},{default:(0,n.k6)((()=>[(0,n.Lk)("div",nt,[(0,n.bF)(c,{name:"info-o",size:"40",class:"applied-icon"}),t[3]||(t[3]=(0,n.Lk)("h3",null,"您已申请过此需求",-1)),t[4]||(t[4]=(0,n.Lk)("p",null,"请等待需求创建者审核您的申请。",-1)),(0,n.bF)(d,{type:"primary",block:"",onClick:a.goBack},{default:(0,n.k6)((()=>t[2]||(t[2]=[(0,n.eW)("返回")]))),_:1},8,["onClick"])])])),_:1},8,["show"])],64))])])}var at={name:"AgreementPage",components:{HeaderBar:F,AgreementDisplay:Ne},data(){return{requirementId:null,requirement:{id:"",title:"",agreement:"",status:""},loading:!0,applying:!1,alreadyApplied:!1,showAlreadyAppliedPopup:!1}},computed:{isCreator(){const e=q.state.user?.id;return this.requirement.createdBy===e}},created(){this.requirementId=this.$route.query.requirementId,this.requirementId?this.fetchRequirementDetails():this.$router.back()},methods:{async fetchRequirementDetails(){this.loading=!0;try{const e=await v.requirements.getById(this.requirementId);this.requirement=e.data,await this.checkUserApplication()}catch(e){console.error("Error fetching requirement details:",e),(0,x.xr)("获取需求详情失败"),this.$router.back()}finally{this.loading=!1}},async checkUserApplication(){try{const e=await v.requirements.getMyApplications(),t=e.data.some((e=>e.id===this.requirementId&&("PENDING"===e.applicationStatus||"APPROVED"===e.applicationStatus)));this.alreadyApplied=t,this.alreadyApplied&&(this.showAlreadyAppliedPopup=!0)}catch(e){console.error("Error checking user applications:",e)}},goBack(){this.$router.back()},async acceptRequirement(){if(this.isCreator)(0,x.xr)("不能申请自己的需求");else if("CREATED"===this.requirement.status||"IN_PROGRESS"===this.requirement.status)if(this.alreadyApplied)this.showAlreadyAppliedPopup=!0;else{this.applying=!0;try{await v.requirements.acceptRequirement(this.requirementId),(0,x.GF)("申请已提交，等待确认"),setTimeout((()=>{this.$router.push(`/requirement/${this.requirementId}`)}),1e3)}catch(e){console.error("Error accepting requirement:",e),(0,x.xr)("接受需求失败: "+(e.response?.data?.message||"未知错误"))}finally{this.applying=!1}}else(0,x.xr)("此需求当前状态不可接受")}}};const ot=(0,l.A)(at,[["render",st],["__scopeId","data-v-1af42fd1"]]);var lt=ot;const ut={class:"page"},ct={class:"page-content"},dt={class:"rich-text-wrapper"},pt={ref:"editor",class:"rich-text-editor"},mt={key:0,class:"error-message"},ht={class:"agreement-section"},gt={class:"field-label"},vt={class:"label-with-tip"},ft={key:0},kt={key:1,class:"agreement-preview"},yt=["innerHTML"],bt={class:"agreement-actions"},qt={key:2,class:"agreement-add"},wt={style:{margin:"16px"}};function Et(e,t,i,r,s,a){const o=(0,n.g2)("header-bar"),l=(0,n.g2)("van-field"),u=(0,n.g2)("van-tag"),c=(0,n.g2)("agreement-editor"),d=(0,n.g2)("van-button"),p=(0,n.g2)("van-cell-group"),m=(0,n.g2)("van-form");return(0,n.uX)(),(0,n.CE)("div",ut,[(0,n.bF)(o,{title:"新建需求"}),(0,n.Lk)("div",ct,[(0,n.bF)(m,{onSubmit:a.onSubmit},{default:(0,n.k6)((()=>[(0,n.bF)(p,{inset:""},{default:(0,n.k6)((()=>[(0,n.bF)(l,{modelValue:s.title,"onUpdate:modelValue":t[0]||(t[0]=e=>s.title=e),name:"title",label:"需求标题",placeholder:"请输入需求标题",rules:[{required:!0,message:"请填写需求标题"}]},null,8,["modelValue"]),(0,n.Lk)("div",dt,[t[1]||(t[1]=(0,n.Lk)("div",{class:"field-label"},"需求描述",-1)),(0,n.Lk)("div",pt,null,512),s.descriptionError?((0,n.uX)(),(0,n.CE)("div",mt,"请填写需求描述")):(0,n.Q3)("",!0)]),(0,n.Lk)("div",ht,[(0,n.Lk)("div",gt,[(0,n.Lk)("div",vt,[t[3]||(t[3]=(0,n.Lk)("span",null,"协议内容",-1)),(0,n.bF)(u,{type:"primary",size:"medium",style:{"margin-left":"8px"}},{default:(0,n.k6)((()=>t[2]||(t[2]=[(0,n.eW)("可选")]))),_:1})]),t[4]||(t[4]=(0,n.Lk)("span",{class:"field-tip"},"定义参与者需要同意的协议条款",-1))]),s.showAgreementEditor?((0,n.uX)(),(0,n.CE)("div",ft,[(0,n.bF)(c,{onSave:a.saveAgreement,onCancel:a.toggleAgreementEditor,ref:"agreementEditor",title:"添加协议"},null,8,["onSave","onCancel"])])):s.agreement?((0,n.uX)(),(0,n.CE)("div",kt,[(0,n.Lk)("div",{innerHTML:s.agreement,class:"agreement-content-preview"},null,8,yt),(0,n.Lk)("div",bt,[(0,n.bF)(d,{type:"primary",size:"small",onClick:a.toggleAgreementEditor},{default:(0,n.k6)((()=>t[5]||(t[5]=[(0,n.eW)(" 编辑协议 ")]))),_:1},8,["onClick"]),(0,n.bF)(d,{type:"danger",size:"small",onClick:a.clearAgreement},{default:(0,n.k6)((()=>t[6]||(t[6]=[(0,n.eW)(" 删除协议 ")]))),_:1},8,["onClick"])])])):((0,n.uX)(),(0,n.CE)("div",qt,[(0,n.bF)(d,{plain:"",type:"primary",size:"small",icon:"plus",onClick:a.toggleAgreementEditor},{default:(0,n.k6)((()=>t[7]||(t[7]=[(0,n.eW)(" 添加协议 ")]))),_:1},8,["onClick"]),t[8]||(t[8]=(0,n.Lk)("span",{class:"add-agreement-tip"},"添加协议可以规范参与者行为和责任",-1))]))])])),_:1}),(0,n.Lk)("div",wt,[(0,n.bF)(d,{round:"",block:"",type:"primary","native-type":"submit",loading:s.submitting,disabled:s.submitting},{default:(0,n.k6)((()=>t[9]||(t[9]=[(0,n.eW)(" 提交 ")]))),_:1},8,["loading","disabled"])])])),_:1},8,["onSubmit"])])])}const At={class:"agreement-editor"},Rt={class:"editor-header"},Ct={class:"rich-text-wrapper"},Lt={ref:"editor",class:"rich-text-editor"},Tt={key:0,class:"error-message"},It={class:"editor-actions"};function Ft(e,t,i,r,s,a){const o=(0,n.g2)("van-button");return(0,n.uX)(),(0,n.CE)("div",At,[(0,n.Lk)("div",Rt,[(0,n.Lk)("h3",null,(0,A.v_)(i.title),1),t[0]||(t[0]=(0,n.Lk)("p",{class:"editor-tip"},"请编辑此需求的协议内容，参与者同意此协议后才能参与需求。",-1))]),(0,n.Lk)("div",Ct,[(0,n.Lk)("div",Lt,null,512),s.error?((0,n.uX)(),(0,n.CE)("div",Tt,(0,A.v_)(s.errorMessage),1)):(0,n.Q3)("",!0)]),(0,n.Lk)("div",It,[(0,n.bF)(o,{type:"primary",onClick:a.saveAgreement,loading:s.saving,disabled:s.saving},{default:(0,n.k6)((()=>t[1]||(t[1]=[(0,n.eW)(" 保存协议 ")]))),_:1},8,["onClick","loading","disabled"]),(0,n.bF)(o,{type:"default",onClick:a.cancel,disabled:s.saving},{default:(0,n.k6)((()=>t[2]||(t[2]=[(0,n.eW)(" 取消 ")]))),_:1},8,["onClick","disabled"])])])}var St=i(2284),_t=i.n(St),Pt={name:"AgreementEditor",props:{initialContent:{type:String,default:""},title:{type:String,default:"编辑协议"}},data(){return{editor:null,content:"",saving:!1,error:!1,errorMessage:"协议内容不能为空"}},mounted(){this.initEditor()},beforeUnmount(){this.editor&&(this.editor.destroy(),this.editor=null)},methods:{initEditor(){this.editor=new(_t())(this.$refs.editor),this.editor.config.placeholder="请输入协议内容...",this.editor.config.zIndex=100,window.innerWidth<768?this.editor.config.menus=["bold","head","fontSize","list","justify","undo","redo"]:this.editor.config.menus=["bold","italic","underline","head","fontSize","fontName","strikeThrough","link","list","justify","quote","undo","redo"],this.editor.config.height=300,this.editor.create(),this.initialContent?this.editor.txt.html(this.initialContent):this.editor.txt.html(this.getDefaultAgreementTemplate())},validateContent(){const e=this.editor.txt.html();return e&&"<p><br></p>"!==e?(this.error=!1,this.content=e,!0):(this.error=!0,!1)},saveAgreement(){this.validateContent()?(this.saving=!0,this.$emit("save",this.content)):(0,x.xr)(this.errorMessage)},saved(e,t){this.saving=!1,e?(0,x.GF)(t||"协议已保存"):(0,x.xr)(t||"保存失败")},cancel(){this.$emit("cancel")},getDefaultAgreementTemplate(){return"\n      <h3>参与协议</h3>\n      <p>欢迎参与本需求工作。在您申请参与之前，请仔细阅读以下协议内容：</p>\n      \n      <h4>1. 参与条件</h4>\n      <p>参与者同意按照需求描述完成相关工作，并遵守项目的时间节点和质量要求。</p>\n      \n      <h4>2. 权利与责任</h4>\n      <p>参与者有权获取与工作相关的必要信息和资源，同时有责任保持信息的保密性。</p>\n      \n      <h4>3. 成果交付</h4>\n      <p>参与者应当按时提交工作成果，并确保成果符合需求描述的要求。</p>\n      \n      <h4>4. 合作方式</h4>\n      <p>参与者需要与需求方保持良好的沟通，及时反馈工作进度和遇到的问题。</p>\n      \n      <p>申请参与即表示您已阅读并同意本协议的全部内容。</p>\n      "}}};const Dt=(0,l.A)(Pt,[["render",Ft],["__scopeId","data-v-2140807e"]]);var xt=Dt,Wt={name:"NewRequirementPage",components:{HeaderBar:F,AgreementEditor:xt},data(){return{title:"",description:"",agreement:"",editor:null,submitting:!1,descriptionError:!1,showAgreementEditor:!1}},mounted(){this.initEditor()},beforeUnmount(){this.editor&&(this.editor.destroy(),this.editor=null)},methods:{initEditor(){this.editor=new(_t())(this.$refs.editor),this.editor.config.placeholder="请输入需求详细描述",this.editor.config.zIndex=100,this.editor.config.menus=["bold","italic","underline","head","fontSize","fontName","strikeThrough","foreColor","backColor","link","list","justify","quote","emoticon","undo","redo"],window.innerWidth<768&&(this.editor.config.menus=["bold","head","fontSize","list","justify","emoticon","undo","redo"]),this.editor.config.height=250,this.editor.create()},validateDescription(){const e=this.editor.txt.html();return e&&"<p><br></p>"!==e?(this.descriptionError=!1,this.description=e,!0):(this.descriptionError=!0,!1)},toggleAgreementEditor(){this.showAgreementEditor=!this.showAgreementEditor},saveAgreement(e){this.agreement=e,this.showAgreementEditor=!1,this.$refs.agreementEditor&&this.$refs.agreementEditor.saved(!0)},clearAgreement(){this.agreement=""},async onSubmit(){if(this.validateDescription()){this.submitting=!0;try{const e={title:this.title,description:this.description,agreement:this.agreement||null};await v.requirements.create(e),(0,x.GF)("需求创建成功"),setTimeout((()=>{this.$router.push("/requirements")}),1e3)}catch(e){console.error("Error creating requirement:",e),(0,x.xr)("创建需求失败: "+(e.response?.data?.error||"未知错误"))}finally{this.submitting=!1}}}}};const $t=(0,l.A)(Wt,[["render",Et],["__scopeId","data-v-2fe568e4"]]);var Xt=$t;const Bt={class:"page"},Nt={class:"page-content"},Mt={class:"rich-text-wrapper"},Ot={ref:"editor",class:"rich-text-editor"},Vt={key:0,class:"error-message"},Ut={class:"agreement-section"},jt={class:"field-label"},zt={class:"label-with-tip"},Ht={style:{margin:"16px"}};function Gt(e,t,i,r,s,a){const o=(0,n.g2)("header-bar"),l=(0,n.g2)("van-loading"),u=(0,n.g2)("van-field"),c=(0,n.g2)("van-dropdown-item"),d=(0,n.g2)("van-dropdown-menu"),p=(0,n.g2)("van-tag"),m=(0,n.g2)("van-cell"),h=(0,n.g2)("van-cell-group"),g=(0,n.g2)("van-button"),v=(0,n.g2)("van-form");return(0,n.uX)(),(0,n.CE)("div",Bt,[(0,n.bF)(o,{title:"编辑需求"}),(0,n.Lk)("div",Nt,[s.loading?((0,n.uX)(),(0,n.Wv)(l,{key:0,vertical:"",class:"loading-overlay"},{default:(0,n.k6)((()=>t[2]||(t[2]=[(0,n.eW)("加载中...")]))),_:1})):((0,n.uX)(),(0,n.Wv)(v,{key:1,onSubmit:a.onSubmit},{default:(0,n.k6)((()=>[(0,n.bF)(h,{inset:""},{default:(0,n.k6)((()=>[(0,n.bF)(u,{modelValue:s.title,"onUpdate:modelValue":t[0]||(t[0]=e=>s.title=e),name:"title",label:"需求标题",placeholder:"请输入需求标题",rules:[{required:!0,message:"请填写需求标题"}]},null,8,["modelValue"]),(0,n.Lk)("div",Mt,[t[3]||(t[3]=(0,n.Lk)("div",{class:"field-label"},"需求描述",-1)),(0,n.Lk)("div",Ot,null,512),s.descriptionError?((0,n.uX)(),(0,n.CE)("div",Vt,"请填写需求描述")):(0,n.Q3)("",!0)]),(0,n.bF)(u,{name:"status",label:"状态",readonly:""},{input:(0,n.k6)((()=>[(0,n.bF)(d,null,{default:(0,n.k6)((()=>[(0,n.bF)(c,{modelValue:s.status,"onUpdate:modelValue":t[1]||(t[1]=e=>s.status=e),options:s.statusOptions},null,8,["modelValue","options"])])),_:1})])),_:1}),(0,n.Lk)("div",Ut,[(0,n.Lk)("div",jt,[(0,n.Lk)("div",zt,[t[5]||(t[5]=(0,n.Lk)("span",null,"协议内容",-1)),(0,n.bF)(p,{type:"primary",size:"medium",style:{"margin-left":"8px"}},{default:(0,n.k6)((()=>t[4]||(t[4]=[(0,n.eW)("可选")]))),_:1})]),t[6]||(t[6]=(0,n.Lk)("span",{class:"field-tip"},"您可以选择编辑协议或在需求详情页中编辑",-1))]),(0,n.bF)(m,{title:"查看或编辑协议","is-link":"",onClick:a.goToEditAgreement},null,8,["onClick"])])])),_:1}),(0,n.Lk)("div",Ht,[(0,n.bF)(g,{round:"",block:"",type:"primary","native-type":"submit",loading:s.submitting,disabled:s.submitting},{default:(0,n.k6)((()=>t[7]||(t[7]=[(0,n.eW)(" 保存 ")]))),_:1},8,["loading","disabled"])])])),_:1},8,["onSubmit"]))])])}var Kt={name:"EditRequirementPage",components:{HeaderBar:F},props:{id:{type:String,required:!0}},data(){return{title:"",description:"",status:"",loading:!0,submitting:!1,descriptionError:!1,editor:null,statusOptions:[{text:"已创建",value:"CREATED"},{text:"进行中",value:"IN_PROGRESS"},{text:"已完成",value:"COMPLETED"},{text:"已取消",value:"CANCELLED"}]}},mounted(){this.fetchRequirementDetail()},beforeUnmount(){this.editor&&(this.editor.destroy(),this.editor=null)},methods:{async fetchRequirementDetail(){try{const e=await v.requirements.getById(this.id),t=e.data;this.title=t.title,this.description=t.description,this.status=t.status,this.loading=!1,this.$nextTick((()=>{this.initEditor()}))}catch(e){console.error("Error fetching requirement:",e),(0,x.xr)("获取需求详情失败"),this.$router.push(`/requirement/${this.id}`)}},initEditor(){this.editor=new(_t())(this.$refs.editor),this.editor.config.placeholder="请输入需求详细描述",this.editor.config.zIndex=100,this.editor.config.menus=["bold","italic","underline","head","fontSize","fontName","strikeThrough","foreColor","backColor","link","list","justify","quote","emoticon","undo","redo"],window.innerWidth<768&&(this.editor.config.menus=["bold","head","fontSize","list","justify","emoticon","undo","redo"]),this.editor.config.height=250,this.editor.create(),this.editor.txt.html(this.description)},validateDescription(){const e=this.editor.txt.html();return e&&"<p><br></p>"!==e?(this.descriptionError=!1,this.description=e,!0):(this.descriptionError=!0,!1)},goToEditAgreement(){this.$router.push(`/requirement/${this.id}/agreement/edit`)},async onSubmit(){if(this.validateDescription()){this.submitting=!0;try{const e={title:this.title,description:this.description,status:this.status};await v.requirements.update(this.id,e),(0,x.GF)("需求更新成功"),setTimeout((()=>{this.$router.push(`/requirement/${this.id}`)}),1e3)}catch(e){console.error("Error updating requirement:",e),(0,x.xr)("更新需求失败: "+(e.response?.data?.error||"未知错误"))}finally{this.submitting=!1}}}}};const Jt=(0,l.A)(Kt,[["render",Gt],["__scopeId","data-v-f5aebe8c"]]);var Qt=Jt;const Zt={class:"page"},Yt={class:"page-content"},ei={class:"rich-text-wrapper"},ti={ref:"editor",class:"rich-text-editor"},ii={key:0,class:"error-message"},ri={style:{margin:"16px"}};function ni(e,t,i,r,s,a){const o=(0,n.g2)("header-bar"),l=(0,n.g2)("van-field"),u=(0,n.g2)("van-cell-group"),c=(0,n.g2)("van-button"),d=(0,n.g2)("van-form"),p=(0,n.g2)("van-picker"),m=(0,n.g2)("van-popup"),h=(0,n.g2)("van-loading");return(0,n.uX)(),(0,n.CE)("div",Zt,[(0,n.bF)(o,{title:"新建结果"}),(0,n.Lk)("div",Yt,[(0,n.bF)(d,{onSubmit:a.onSubmit},{default:(0,n.k6)((()=>[(0,n.bF)(u,{inset:""},{default:(0,n.k6)((()=>[(0,n.bF)(l,{modelValue:s.title,"onUpdate:modelValue":t[0]||(t[0]=e=>s.title=e),name:"title",label:"结果标题",placeholder:"请输入结果标题",rules:[{required:!0,message:"请填写结果标题"}]},null,8,["modelValue"]),(0,n.Lk)("div",ei,[t[4]||(t[4]=(0,n.Lk)("div",{class:"field-label"},"结果描述",-1)),(0,n.Lk)("div",ti,null,512),s.descriptionError?((0,n.uX)(),(0,n.CE)("div",ii,"请填写结果描述")):(0,n.Q3)("",!0)]),!s.relatedRequirementId&&a.requirementOptions.length>0?((0,n.uX)(),(0,n.Wv)(l,{key:0,readonly:"",name:"relatedRequirement",label:"关联需求",value:s.selectedRequirementTitle,"right-icon":"arrow-down",onClick:t[1]||(t[1]=e=>s.showRequirementPicker=!0)},null,8,["value"])):(0,n.Q3)("",!0),s.relatedRequirementId?((0,n.uX)(),(0,n.Wv)(l,{key:1,readonly:"",name:"relatedRequirementFixed",label:"关联需求",value:s.selectedRequirementTitle},null,8,["value"])):(0,n.Q3)("",!0)])),_:1}),(0,n.Lk)("div",ri,[(0,n.bF)(c,{round:"",block:"",type:"primary","native-type":"submit",loading:s.submitting,disabled:s.submitting},{default:(0,n.k6)((()=>t[5]||(t[5]=[(0,n.eW)(" 提交 ")]))),_:1},8,["loading","disabled"])])])),_:1},8,["onSubmit"]),(0,n.bF)(m,{show:s.showRequirementPicker,"onUpdate:show":t[3]||(t[3]=e=>s.showRequirementPicker=e),position:"bottom",round:"",style:{height:"50%"}},{default:(0,n.k6)((()=>[(0,n.bF)(p,{title:"选择关联需求",columns:a.requirementOptions,onConfirm:a.onRequirementConfirm,onCancel:t[2]||(t[2]=e=>s.showRequirementPicker=!1),"show-toolbar":""},null,8,["columns","onConfirm"])])),_:1},8,["show"]),s.loading?((0,n.uX)(),(0,n.Wv)(h,{key:0,vertical:"",class:"loading-overlay"},{default:(0,n.k6)((()=>t[6]||(t[6]=[(0,n.eW)("加载中...")]))),_:1})):(0,n.Q3)("",!0)])])}i(1701);var si={name:"NewResultPage",components:{HeaderBar:F},data(){return{title:"",description:"",relatedRequirementId:this.$route.query.requirementId||"",submitting:!1,loading:!1,showRequirementPicker:!1,requirements:[],selectedRequirementId:"",selectedRequirementTitle:"无关联需求",editor:null,descriptionError:!1}},computed:{requirementOptions(){const e=[{text:"无关联需求",value:null}];return e.concat(this.requirements.map((e=>({text:e.title,value:e.id}))))}},mounted(){this.initEditor(),this.fetchRequirements(),this.relatedRequirementId&&this.fetchRequirementDetails(this.relatedRequirementId)},beforeUnmount(){this.editor&&(this.editor.destroy(),this.editor=null)},methods:{initEditor(){this.editor=new(_t())(this.$refs.editor),this.editor.config.placeholder="请输入结果详细描述",this.editor.config.zIndex=100,this.editor.config.menus=["bold","italic","underline","head","fontSize","fontName","strikeThrough","foreColor","backColor","link","list","justify","quote","emoticon","undo","redo"],window.innerWidth<768&&(this.editor.config.menus=["bold","head","fontSize","list","justify","emoticon","undo","redo"]),this.editor.config.height=250,this.editor.create()},validateDescription(){const e=this.editor.txt.html();return e&&"<p><br></p>"!==e?(this.descriptionError=!1,this.description=e,!0):(this.descriptionError=!0,!1)},async fetchRequirementDetails(e){this.loading=!0;try{const t=await v.requirements.getById(e);this.selectedRequirementTitle=t.data.title,this.selectedRequirementId=e}catch(t){console.error("Error fetching requirement details:",t),(0,x.xr)("获取需求详情失败")}finally{this.loading=!1}},async fetchRequirements(){this.loading=!0;try{const e=await v.requirements.getAll();this.requirements=e.data}catch(e){console.error("Error fetching requirements:",e),(0,x.xr)("获取需求列表失败")}finally{this.loading=!1}},onRequirementConfirm(e){this.selectedRequirementId=e.value,this.selectedRequirementTitle=e.value?e.text:"无关联需求",this.showRequirementPicker=!1},async onSubmit(){if(this.validateDescription()){this.submitting=!0;try{const e={title:this.title,description:this.description,relatedRequirementId:this.relatedRequirementId||this.selectedRequirementId||null};await v.results.create(e),(0,x.GF)("结果创建成功"),this.relatedRequirementId?setTimeout((()=>{this.$router.push(`/results/requirement/${this.relatedRequirementId}`)}),1e3):setTimeout((()=>{this.$router.push("/results")}),1e3)}catch(e){console.error("Error creating result:",e),(0,x.xr)("创建结果失败: "+(e.response?.data?.error||"未知错误"))}finally{this.submitting=!1}}}}};const ai=(0,l.A)(si,[["render",ni],["__scopeId","data-v-3f0fc5c6"]]);var oi=ai;const li={class:"page"},ui={class:"page-content"},ci={class:"rich-text-wrapper"},di={ref:"editor",class:"rich-text-editor"},pi={key:0,class:"error-message"},mi={style:{margin:"16px"}};function hi(e,t,i,r,s,a){const o=(0,n.g2)("header-bar"),l=(0,n.g2)("van-loading"),u=(0,n.g2)("van-field"),c=(0,n.g2)("van-dropdown-item"),d=(0,n.g2)("van-dropdown-menu"),p=(0,n.g2)("van-cell-group"),m=(0,n.g2)("van-button"),h=(0,n.g2)("van-form"),g=(0,n.g2)("van-picker"),v=(0,n.g2)("van-popup");return(0,n.uX)(),(0,n.CE)("div",li,[(0,n.bF)(o,{title:"编辑结果"}),(0,n.Lk)("div",ui,[s.loading?((0,n.uX)(),(0,n.Wv)(l,{key:0,vertical:"",class:"loading-overlay"},{default:(0,n.k6)((()=>t[5]||(t[5]=[(0,n.eW)("加载中...")]))),_:1})):((0,n.uX)(),(0,n.Wv)(h,{key:1,onSubmit:a.onSubmit},{default:(0,n.k6)((()=>[(0,n.bF)(p,{inset:""},{default:(0,n.k6)((()=>[(0,n.bF)(u,{modelValue:s.title,"onUpdate:modelValue":t[0]||(t[0]=e=>s.title=e),name:"title",label:"结果标题",placeholder:"请输入结果标题",rules:[{required:!0,message:"请填写结果标题"}]},null,8,["modelValue"]),(0,n.Lk)("div",ci,[t[6]||(t[6]=(0,n.Lk)("div",{class:"field-label"},"结果描述",-1)),(0,n.Lk)("div",di,null,512),s.descriptionError?((0,n.uX)(),(0,n.CE)("div",pi,"请填写结果描述")):(0,n.Q3)("",!0)]),(0,n.bF)(u,{name:"status",label:"状态",readonly:""},{input:(0,n.k6)((()=>[(0,n.bF)(d,null,{default:(0,n.k6)((()=>[(0,n.bF)(c,{modelValue:s.status,"onUpdate:modelValue":t[1]||(t[1]=e=>s.status=e),options:s.statusOptions},null,8,["modelValue","options"])])),_:1})])),_:1}),a.requirementOptions.length>0?((0,n.uX)(),(0,n.Wv)(u,{key:0,readonly:"",name:"relatedRequirement",label:"关联需求",value:s.selectedRequirementTitle,"right-icon":"arrow-down",onClick:t[2]||(t[2]=e=>s.showRequirementPicker=!0)},null,8,["value"])):(0,n.Q3)("",!0)])),_:1}),(0,n.Lk)("div",mi,[(0,n.bF)(m,{round:"",block:"",type:"primary","native-type":"submit",loading:s.submitting,disabled:s.submitting},{default:(0,n.k6)((()=>t[7]||(t[7]=[(0,n.eW)(" 保存 ")]))),_:1},8,["loading","disabled"])])])),_:1},8,["onSubmit"])),(0,n.bF)(v,{show:s.showRequirementPicker,"onUpdate:show":t[4]||(t[4]=e=>s.showRequirementPicker=e),position:"bottom",round:"",style:{height:"50%"}},{default:(0,n.k6)((()=>[(0,n.bF)(g,{title:"选择关联需求",columns:a.requirementOptions,onConfirm:a.onRequirementConfirm,onCancel:t[3]||(t[3]=e=>s.showRequirementPicker=!1),"show-toolbar":""},null,8,["columns","onConfirm"])])),_:1},8,["show"])])])}var gi={name:"EditResultPage",components:{HeaderBar:F},props:{id:{type:String,required:!0}},data(){return{title:"",description:"",status:"",relatedRequirementId:null,loading:!0,submitting:!1,showRequirementPicker:!1,requirements:[],selectedRequirementTitle:"无关联需求",editor:null,descriptionError:!1,statusOptions:[{text:"草稿",value:"DRAFT"},{text:"已完成",value:"COMPLETED"},{text:"已归档",value:"ARCHIVED"},{text:"已拒绝",value:"REJECTED"}]}},computed:{requirementOptions(){const e=[{text:"无关联需求",value:null}];return e.concat(this.requirements.map((e=>({text:e.title,value:e.id}))))}},mounted(){this.fetchResultDetail(),this.fetchRequirements()},beforeUnmount(){this.editor&&(this.editor.destroy(),this.editor=null)},methods:{async fetchResultDetail(){try{const e=await v.results.getById(this.id),t=e.data;this.title=t.title,this.description=t.description,this.status=t.status,this.relatedRequirementId=t.relatedRequirementId,this.relatedRequirementId&&this.fetchRelatedRequirementTitle(),this.loading=!1,this.$nextTick((()=>{this.initEditor()}))}catch(e){console.error("Error fetching result:",e),(0,x.xr)("获取结果详情失败"),this.$router.push(`/result/${this.id}`)}},async fetchRelatedRequirementTitle(){if(this.relatedRequirementId)try{const e=await v.requirements.getById(this.relatedRequirementId);this.selectedRequirementTitle=e.data.title}catch(e){console.error("Error fetching related requirement title:",e),this.selectedRequirementTitle="未能获取需求标题"}},async fetchRequirements(){try{const e=await v.requirements.getAll();this.requirements=e.data}catch(e){console.error("Error fetching requirements:",e)}},initEditor(){this.editor=new(_t())(this.$refs.editor),this.editor.config.placeholder="请输入结果详细描述",this.editor.config.zIndex=100,this.editor.config.menus=["bold","italic","underline","head","fontSize","fontName","strikeThrough","foreColor","backColor","link","list","justify","quote","emoticon","undo","redo"],window.innerWidth<768&&(this.editor.config.menus=["bold","head","fontSize","list","justify","emoticon","undo","redo"]),this.editor.config.height=250,this.editor.create(),this.editor.txt.html(this.description)},validateDescription(){const e=this.editor.txt.html();return e&&"<p><br></p>"!==e?(this.descriptionError=!1,this.description=e,!0):(this.descriptionError=!0,!1)},onRequirementConfirm(e){this.relatedRequirementId=e.value,this.selectedRequirementTitle=e.value?e.text:"无关联需求",this.showRequirementPicker=!1},async onSubmit(){if(this.validateDescription()){this.submitting=!0;try{const e={title:this.title,description:this.description,status:this.status,relatedRequirementId:this.relatedRequirementId};await v.results.update(this.id,e),(0,x.GF)("结果更新成功"),setTimeout((()=>{this.$router.push(`/result/${this.id}`)}),1e3)}catch(e){console.error("Error updating result:",e),(0,x.xr)("更新结果失败: "+(e.response?.data?.error||"未知错误"))}finally{this.submitting=!1}}}}};const vi=(0,l.A)(gi,[["render",hi],["__scopeId","data-v-62c42f32"]]);var fi=vi;const ki={class:"page"},yi={class:"page-content"},bi={class:"requirement-info"};function qi(e,t,i,r,s,a){const o=(0,n.g2)("header-bar"),l=(0,n.g2)("van-loading"),u=(0,n.g2)("van-empty"),c=(0,n.g2)("van-tag"),d=(0,n.g2)("van-cell"),p=(0,n.g2)("van-cell-group");return(0,n.uX)(),(0,n.CE)("div",ki,[(0,n.bF)(o,{title:"相关结果","right-text":"添加结果",onRightClick:a.goToNewResult},null,8,["onRightClick"]),(0,n.Lk)("div",yi,[s.loading?((0,n.uX)(),(0,n.Wv)(l,{key:0,vertical:"",class:"loading-overlay"},{default:(0,n.k6)((()=>t[0]||(t[0]=[(0,n.eW)("加载中...")]))),_:1})):((0,n.uX)(),(0,n.CE)(n.FK,{key:1},[(0,n.Lk)("div",bi,[(0,n.Lk)("h3",null,"需求: "+(0,A.v_)(s.requirementTitle),1)]),0===s.resultsList.length?((0,n.uX)(),(0,n.Wv)(u,{key:0,description:"暂无相关结果数据"})):((0,n.uX)(),(0,n.Wv)(p,{key:1,class:"list-container"},{default:(0,n.k6)((()=>[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(s.resultsList,(e=>((0,n.uX)(),(0,n.Wv)(d,{key:e.id,title:e.title,"is-link":"",onClick:t=>a.goToResultDetail(e.id),class:"list-item"},{"right-icon":(0,n.k6)((()=>[(0,n.bF)(c,{type:a.getStatusType(e.status),class:"custom-tag",round:""},{default:(0,n.k6)((()=>[(0,n.eW)((0,A.v_)(a.getStatusText(e.status)),1)])),_:2},1032,["type"])])),_:2},1032,["title","onClick"])))),128))])),_:1}))],64))])])}var wi={name:"ResultsByRequirementPage",components:{HeaderBar:F},props:{requirementId:{type:String,required:!0}},data(){return{resultsList:[],requirementTitle:"",loading:!0}},created(){this.fetchRequirementData(),this.fetchResultsData()},methods:{async fetchRequirementData(){try{const e=await v.requirements.getById(this.requirementId);this.requirementTitle=e.data.title}catch(e){console.error("Error fetching requirement data:",e),this.requirementTitle="未知需求"}},async fetchResultsData(){try{const e=await v.results.getByRequirement(this.requirementId);this.resultsList=e.data}catch(e){console.error("Error fetching results data:",e),(0,x.xr)("获取结果数据失败")}finally{this.loading=!1}},goToResultDetail(e){this.$router.push(`/result/${e}`)},goToNewResult(){this.$router.push(`/result/new?requirementId=${this.requirementId}`)},getStatusText(e){const t={DRAFT:"草稿",COMPLETED:"已完成",ARCHIVED:"已归档",REJECTED:"已拒绝"};return t[e]||"未知状态"},getStatusType(e){const t={DRAFT:"primary",COMPLETED:"success",ARCHIVED:"warning",REJECTED:"danger"};return t[e]||"default"}}};const Ei=(0,l.A)(wi,[["render",qi],["__scopeId","data-v-71bcea11"]]);var Ai=Ei;const Ri={class:"page"},Ci={class:"page-content"};function Li(e,t,i,r,s,a){const o=(0,n.g2)("header-bar"),l=(0,n.g2)("van-loading"),u=(0,n.g2)("agreement-editor");return(0,n.uX)(),(0,n.CE)("div",Ri,[(0,n.bF)(o,{title:"编辑协议"}),(0,n.Lk)("div",Ci,[s.loading?((0,n.uX)(),(0,n.Wv)(l,{key:0,vertical:"",class:"loading-overlay"},{default:(0,n.k6)((()=>t[0]||(t[0]=[(0,n.eW)("加载中...")]))),_:1})):((0,n.uX)(),(0,n.Wv)(u,{key:1,initialContent:s.agreement,onSave:a.saveAgreement,onCancel:a.goBack,ref:"agreementEditor"},null,8,["initialContent","onSave","onCancel"]))])])}var Ti={name:"EditAgreementPage",components:{HeaderBar:F,AgreementEditor:xt},props:{id:{type:String,required:!0}},data(){return{requirement:null,agreement:"",loading:!0}},created(){this.fetchRequirementDetail()},methods:{async fetchRequirementDetail(){this.loading=!0;try{const e=await v.requirements.getById(this.id);this.requirement=e.data,this.agreement=this.requirement.agreement||""}catch(e){console.error("Error fetching requirement detail:",e),(0,x.xr)("获取需求详情失败"),this.$router.push(`/requirement/${this.id}`)}finally{this.loading=!1}},async saveAgreement(e){try{await v.requirements.updateAgreement(this.id,e),this.$refs.agreementEditor.saved(!0,"协议保存成功"),setTimeout((()=>{this.goBack()}),1e3)}catch(t){console.error("Error updating agreement:",t),this.$refs.agreementEditor.saved(!1,"保存协议失败: "+(t.response?.data?.message||"未知错误"))}},goBack(){this.$router.push(`/requirement/${this.id}`)}}};const Ii=(0,l.A)(Ti,[["render",Li],["__scopeId","data-v-29c0c2ac"]]);var Fi=Ii;const Si={class:"page"},_i={class:"page-content"},Pi={style:{margin:"16px"}},Di={key:0,class:"biometric-login"},xi={class:"form-footer"};function Wi(e,t,i,r,s,a){const o=(0,n.g2)("header-bar"),l=(0,n.g2)("van-field"),u=(0,n.g2)("van-cell-group"),c=(0,n.g2)("van-button"),d=(0,n.g2)("van-form"),p=(0,n.g2)("van-icon"),m=(0,n.g2)("router-link");return(0,n.uX)(),(0,n.CE)("div",Si,[(0,n.bF)(o,{title:"登录","show-back":!1}),(0,n.Lk)("div",_i,[t[6]||(t[6]=(0,n.Lk)("div",{class:"logo-container"},[(0,n.Lk)("h2",{class:"small-seal-font"},"生命树")],-1)),(0,n.bF)(d,{onSubmit:r.onSubmit},{default:(0,n.k6)((()=>[(0,n.bF)(u,{inset:""},{default:(0,n.k6)((()=>[(0,n.bF)(l,{modelValue:r.email,"onUpdate:modelValue":t[0]||(t[0]=e=>r.email=e),name:"email",label:"邮箱",placeholder:"请输入邮箱",rules:[{required:!0,message:"请填写邮箱"},{pattern:r.emailPattern,message:"请输入有效的邮箱地址"}]},null,8,["modelValue","rules"]),(0,n.bF)(l,{modelValue:r.password,"onUpdate:modelValue":t[1]||(t[1]=e=>r.password=e),type:"password",name:"password",label:"密码",placeholder:"请输入密码",rules:[{required:!0,message:"请填写密码"}]},null,8,["modelValue"])])),_:1}),(0,n.Lk)("div",Pi,[(0,n.bF)(c,{round:"",block:"",type:"primary","native-type":"submit",loading:r.loading,disabled:r.loading},{default:(0,n.k6)((()=>t[2]||(t[2]=[(0,n.eW)(" 登录 ")]))),_:1},8,["loading","disabled"])])])),_:1},8,["onSubmit"]),r.biometricsAvailable?((0,n.uX)(),(0,n.CE)("div",Di,[(0,n.bF)(c,{round:"",block:"",type:"default",onClick:r.loginWithBiometrics,disabled:r.loading},{icon:(0,n.k6)((()=>[(0,n.bF)(p,{name:"scan",size:"20"})])),default:(0,n.k6)((()=>[t[3]||(t[3]=(0,n.eW)(" 使用生物识别登录 "))])),_:1},8,["onClick","disabled"])])):(0,n.Q3)("",!0),(0,n.Lk)("div",xi,[(0,n.Lk)("p",null,[t[5]||(t[5]=(0,n.eW)("还没有账号？ ")),(0,n.bF)(m,{to:"/register"},{default:(0,n.k6)((()=>t[4]||(t[4]=[(0,n.eW)("立即注册")]))),_:1})])])])])}var $i={name:"LoginPage",components:{HeaderBar:F},setup(){const e=(0,d.rd)(),t=(0,p.KR)(""),r=(0,p.KR)(""),s=(0,p.KR)(!1),a=(0,p.KR)(!1),o=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,l=()=>"undefined"!==typeof window&&window.Capacitor&&window.Capacitor.isNativePlatform(),u=async()=>{try{if(!l())return console.log("非原生环境，生物识别不可用"),!1;const{NativeBiometric:t}=await i.e(926).then(i.bind(i,4926)),r=await t.isAvailable();if(console.log("生物识别可用性检查结果:",r),!r.isAvailable)return console.log("设备不支持生物识别"),!1;try{const e=await t.getCredentials({server:"lifetree-app"});return console.log("生物识别凭据检查:",e?"找到凭据":"未找到凭据"),Boolean(e&&e.username&&e.password)}catch(e){return console.error("获取生物识别凭据失败:",e),!1}}catch(t){return console.error("检查生物识别可用性失败:",t),!1}},c=async()=>{s.value=!0;try{if(!l())throw new Error("非原生环境，无法使用生物识别");const{NativeBiometric:t}=await i.e(926).then(i.bind(i,4926)),r=await t.isAvailable();if(console.log("生物识别可用性检查:",r),!r.isAvailable)throw new Error("设备不支持生物识别");console.log("开始生物识别验证..."),await t.verifyIdentity({reason:"登录到生命树应用",title:"生物识别验证",subtitle:"请使用Face ID进行验证",description:"这将允许您快速安全地登录"}),console.log("生物识别验证成功"),console.log("尝试获取存储的凭据...");const n=await t.getCredentials({server:"lifetree-app"});if(console.log("获取到凭据:",n?"成功":"失败"),!n||!n.username||!n.password)throw new Error("未找到有效的生物识别凭据");console.log("使用凭据尝试登录...");const s=await v.auth.login({email:n.username,password:n.password});if(!s||!s.data)throw new Error("登录响应无效");{const{user:t,token:i}=s.data;localStorage.setItem("user",JSON.stringify(t)),localStorage.setItem("token",i),q.state.user=t,q.state.token=i,q.state.isAuthenticated=!0,(0,x.P0)({message:"生物识别登录成功",type:"success"});const r=sessionStorage.getItem("redirectPath")||"/";sessionStorage.removeItem("redirectPath"),setTimeout((()=>{e.push(r)}),1e3)}}catch(t){console.error("生物识别登录详细错误:",t),(0,x.xr)("生物识别登录失败: "+(t.message||"请使用账号密码登录")),r.value=""}finally{s.value=!1}},m=async t=>{s.value=!0;try{console.log("开始常规登录...");const n=await v.auth.login({email:t.email,password:t.password});if(console.log("登录响应:",n?"成功":"失败"),!n||!n.data)throw new Error("登录响应无效");const{user:s,token:o}=n.data;localStorage.setItem("user",JSON.stringify(s)),localStorage.setItem("token",o),q.state.user=s,q.state.token=o,q.state.isAuthenticated=!0;try{if(l()){const{NativeBiometric:e}=await i.e(926).then(i.bind(i,4926));console.log("尝试保存生物识别凭据..."),await e.setCredentials({username:t.email,password:t.password,server:"lifetree-app"}),console.log("生物识别凭据保存成功"),a.value=!0}}catch(r){console.error("保存生物识别凭据失败:",r)}(0,x.P0)({message:"登录成功",type:"success"});const u=sessionStorage.getItem("redirectPath")||"/";sessionStorage.removeItem("redirectPath"),setTimeout((()=>{e.push(u)}),1e3)}catch(r){console.error("登录失败详细错误:",r);const e=r.response?.data?.error||"登录失败，请检查您的凭据";(0,x.xr)(e)}finally{s.value=!1}},h=async()=>{try{const e=await fetch(v.baseURL+"/health");console.log("API连接测试结果:",e.status),e.ok?console.log("API连接成功"):console.log("API连接失败")}catch(e){console.error("API连接测试错误:",e)}};return(0,n.sV)((async()=>{console.log("Login组件已挂载"),console.log("检查平台:",l()?"原生平台":"浏览器"),await h();const e=await u();console.log("生物识别可用性:",e),a.value=e})),{email:t,password:r,loading:s,emailPattern:o,biometricsAvailable:a,onSubmit:m,loginWithBiometrics:c}}};const Xi=(0,l.A)($i,[["render",Wi],["__scopeId","data-v-0e5dc4d4"]]);var Bi=Xi;const Ni={class:"page"},Mi={class:"page-content"},Oi={style:{margin:"16px"}},Vi={class:"form-footer"};function Ui(e,t,i,r,s,a){const o=(0,n.g2)("header-bar"),l=(0,n.g2)("van-field"),u=(0,n.g2)("van-cell-group"),c=(0,n.g2)("van-button"),d=(0,n.g2)("van-form"),p=(0,n.g2)("router-link");return(0,n.uX)(),(0,n.CE)("div",Ni,[(0,n.bF)(o,{title:"注册"}),(0,n.Lk)("div",Mi,[t[7]||(t[7]=(0,n.Lk)("div",{class:"logo-container"},[(0,n.Lk)("h2",{class:"small-seal-font"},"生命树")],-1)),(0,n.bF)(d,{onSubmit:r.onSubmit},{default:(0,n.k6)((()=>[(0,n.bF)(u,{inset:""},{default:(0,n.k6)((()=>[(0,n.bF)(l,{modelValue:r.email,"onUpdate:modelValue":t[0]||(t[0]=e=>r.email=e),name:"email",label:"邮箱",placeholder:"请输入邮箱",rules:[{required:!0,message:"请填写邮箱"},{pattern:r.emailPattern,message:"请输入有效的邮箱地址"}]},null,8,["modelValue","rules"]),(0,n.bF)(l,{modelValue:r.name,"onUpdate:modelValue":t[1]||(t[1]=e=>r.name=e),name:"name",label:"用户名",placeholder:"请输入用户名",rules:[{required:!0,message:"请填写用户名"}]},null,8,["modelValue"]),(0,n.bF)(l,{modelValue:r.password,"onUpdate:modelValue":t[2]||(t[2]=e=>r.password=e),type:"password",name:"password",label:"密码",placeholder:"请输入密码",rules:[{required:!0,message:"请填写密码"},{pattern:r.passwordPattern,message:"密码至少6位，包含字母和数字"}]},null,8,["modelValue","rules"]),(0,n.bF)(l,{modelValue:r.confirmPassword,"onUpdate:modelValue":t[3]||(t[3]=e=>r.confirmPassword=e),type:"password",name:"confirmPassword",label:"确认密码",placeholder:"请再次输入密码",rules:[{required:!0,message:"请再次输入密码"},{validator:r.validatePasswordConfirmation,message:"两次输入的密码不一致"}]},null,8,["modelValue","rules"])])),_:1}),(0,n.Lk)("div",Oi,[(0,n.bF)(c,{round:"",block:"",type:"primary","native-type":"submit",loading:r.loading,disabled:r.loading},{default:(0,n.k6)((()=>t[4]||(t[4]=[(0,n.eW)(" 注册 ")]))),_:1},8,["loading","disabled"])])])),_:1},8,["onSubmit"]),(0,n.Lk)("div",Vi,[(0,n.Lk)("p",null,[t[6]||(t[6]=(0,n.eW)("已有账号？ ")),(0,n.bF)(p,{to:"/login"},{default:(0,n.k6)((()=>t[5]||(t[5]=[(0,n.eW)("立即登录")]))),_:1})])])])])}var ji={name:"RegisterPage",components:{HeaderBar:F},setup(){const e=(0,d.rd)(),t=(0,p.KR)(""),i=(0,p.KR)(""),r=(0,p.KR)(""),n=(0,p.KR)(""),s=(0,p.KR)(!1),a=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,o=/^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]{6,}$/,l=e=>e===r.value,u=async t=>{s.value=!0;try{await q.register({email:t.email,name:t.name,password:t.password}),(0,x.P0)({message:"注册成功，请登录",type:"success"}),setTimeout((()=>{e.push("/login")}),1e3)}catch(i){const e=i.response?.data?.error||"注册失败，请重试";(0,x.xr)(e)}finally{s.value=!1}};return{email:t,name:i,password:r,confirmPassword:n,loading:s,emailPattern:a,passwordPattern:o,validatePasswordConfirmation:l,onSubmit:u}}};const zi=(0,l.A)(ji,[["render",Ui],["__scopeId","data-v-5c542bcc"]]);var Hi=zi;const Gi="/lifetree/",Ki=[{path:"/",name:"Home",component:M},{path:"/requirements",name:"Requirements",component:H,meta:{requiresAuth:!0}},{path:"/results",name:"Results",component:Y,meta:{requiresAuth:!0}},{path:"/profile",name:"Profile",component:ce,meta:{requiresAuth:!0}},{path:"/requirement/:id",name:"RequirementDetail",component:Ue,props:!0,meta:{requiresAuth:!0}},{path:"/requirement/edit/:id",name:"EditRequirement",component:Qt,props:!0,meta:{requiresAuth:!0}},{path:"/requirement/:id/agreement/edit",name:"EditAgreement",component:Fi,props:!0,meta:{requiresAuth:!0}},{path:"/result/:id",name:"ResultDetail",component:tt,props:!0,meta:{requiresAuth:!0}},{path:"/result/edit/:id",name:"EditResult",component:fi,props:!0,meta:{requiresAuth:!0}},{path:"/results/requirement/:requirementId",name:"ResultsByRequirement",component:Ai,props:!0,meta:{requiresAuth:!0}},{path:"/agreement",name:"Agreement",component:lt},{path:"/requirement/new",name:"NewRequirement",component:Xt,meta:{requiresAuth:!0}},{path:"/result/new",name:"NewResult",component:oi,meta:{requiresAuth:!0}},{path:"/login",name:"Login",component:Bi,meta:{guest:!0}},{path:"/register",name:"Register",component:Hi,meta:{guest:!0}},{path:"/:pathMatch(.*)*",redirect:"/"}],Ji=(0,d.aE)({history:(0,d.Bt)(Gi),routes:Ki});Ji.beforeEach(((e,t,i)=>{e.matched.some((e=>e.meta.requiresAuth))?q.state.isAuthenticated?i():(sessionStorage.setItem("redirectPath",e.fullPath),i({path:"/login"})):e.matched.some((e=>e.meta.guest))&&q.state.isAuthenticated?i({path:"/"}):i()}));var Qi=Ji,Zi=i(4296),Yi=i(8728),er=i(7648),tr=i(828),ir=i(55),rr=i(786),nr=i(7363),sr=i(9472),ar=i(3623),or=i(7515),lr=i(2352),ur=i(9056),cr=i(5802),dr=i(4025),pr=i(3429),mr=i(4743),hr=i(1824),gr=i(5746),vr=i(5116),fr=i(6767),kr=i(8427),yr=i(5399);i(2241);const br=(0,r.Ef)(c);br.use(Qi),br.use(Zi.$n),br.use(Yi.HF),br.use(er.gq),br.use(tr.fh),br.use(ir.Qh),br.use(rr.jq),br.use(nr.In),br.use(sr.lV),br.use(ar.D0),br.use(or.y8),br.use(lr.lG),br.use(ur.M9),br.use(cr.vw),br.use(dr.Rh),br.use(pr.Ee),br.use(mr.j5),br.use(hr.B8),br.use(gr.Sv),br.use(vr.zD),br.use(fr.LC),br.use(kr.rI),br.use(yr.tJ),br.config.globalProperties.$axios=m.A,br.mount("#app")}},t={};function i(r){var n=t[r];if(void 0!==n)return n.exports;var s=t[r]={exports:{}};return e[r].call(s.exports,s,s.exports,i),s.exports}i.m=e,function(){var e=[];i.O=function(t,r,n,s){if(!r){var a=1/0;for(c=0;c<e.length;c++){r=e[c][0],n=e[c][1],s=e[c][2];for(var o=!0,l=0;l<r.length;l++)(!1&s||a>=s)&&Object.keys(i.O).every((function(e){return i.O[e](r[l])}))?r.splice(l--,1):(o=!1,s<a&&(a=s));if(o){e.splice(c--,1);var u=n();void 0!==u&&(t=u)}}return t}s=s||0;for(var c=e.length;c>0&&e[c-1][2]>s;c--)e[c]=e[c-1];e[c]=[r,n,s]}}(),function(){i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,{a:t}),t}}(),function(){i.d=function(e,t){for(var r in t)i.o(t,r)&&!i.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}}(),function(){i.f={},i.e=function(e){return Promise.all(Object.keys(i.f).reduce((function(t,r){return i.f[r](e,t),t}),[]))}}(),function(){i.u=function(e){return"js/"+e+"."+{542:"d1a1cfef",926:"6f28a985"}[e]+".js"}}(),function(){i.miniCssF=function(e){}}(),function(){i.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={},t="mobile-app:";i.l=function(r,n,s,a){if(e[r])e[r].push(n);else{var o,l;if(void 0!==s)for(var u=document.getElementsByTagName("script"),c=0;c<u.length;c++){var d=u[c];if(d.getAttribute("src")==r||d.getAttribute("data-webpack")==t+s){o=d;break}}o||(l=!0,o=document.createElement("script"),o.charset="utf-8",o.timeout=120,i.nc&&o.setAttribute("nonce",i.nc),o.setAttribute("data-webpack",t+s),o.src=r),e[r]=[n];var p=function(t,i){o.onerror=o.onload=null,clearTimeout(m);var n=e[r];if(delete e[r],o.parentNode&&o.parentNode.removeChild(o),n&&n.forEach((function(e){return e(i)})),t)return t(i)},m=setTimeout(p.bind(null,void 0,{type:"timeout",target:o}),12e4);o.onerror=p.bind(null,o.onerror),o.onload=p.bind(null,o.onload),l&&document.head.appendChild(o)}}}(),function(){i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){i.p="/lifetree/"}(),function(){var e={524:0};i.f.j=function(t,r){var n=i.o(e,t)?e[t]:void 0;if(0!==n)if(n)r.push(n[2]);else{var s=new Promise((function(i,r){n=e[t]=[i,r]}));r.push(n[2]=s);var a=i.p+i.u(t),o=new Error,l=function(r){if(i.o(e,t)&&(n=e[t],0!==n&&(e[t]=void 0),n)){var s=r&&("load"===r.type?"missing":r.type),a=r&&r.target&&r.target.src;o.message="Loading chunk "+t+" failed.\n("+s+": "+a+")",o.name="ChunkLoadError",o.type=s,o.request=a,n[1](o)}};i.l(a,l,"chunk-"+t,t)}},i.O.j=function(t){return 0===e[t]};var t=function(t,r){var n,s,a=r[0],o=r[1],l=r[2],u=0;if(a.some((function(t){return 0!==e[t]}))){for(n in o)i.o(o,n)&&(i.m[n]=o[n]);if(l)var c=l(i)}for(t&&t(r);u<a.length;u++)s=a[u],i.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return i.O(c)},r=self["webpackChunkmobile_app"]=self["webpackChunkmobile_app"]||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))}();var r=i.O(void 0,[504],(function(){return i(8019)}));r=i.O(r)})();