(function(){"use strict";var e={2928:function(e,t,i){var r=i(3751),n=i(641);const a={id:"app"};function s(e,t,i,r,s,o){const l=(0,n.g2)("router-view");return(0,n.uX)(),(0,n.CE)("div",a,[(0,n.bF)(l)])}var o={name:"App"},l=i(6262);const u=(0,l.A)(o,[["render",s]]);var c=u,d=(i(8111),i(3579),i(5220)),p=i(953),m=i(4335);const h=m.A.create({baseURL:"https://api.u252116.nyat.app:44058/api",timeout:1e4,headers:{"Content-Type":"application/json"}});h.interceptors.request.use((e=>{const t=localStorage.getItem("token");return t&&(e.headers["Authorization"]=`Bearer ${t}`),e}),(e=>Promise.reject(e))),h.interceptors.response.use((e=>e),(e=>{if(e.response)switch(e.response.status){case 401:localStorage.removeItem("token"),localStorage.removeItem("user"),location.reload();break;case 403:console.error("没有权限访问该资源");break;case 404:console.error("请求的资源不存在");break;case 500:console.error("服务器错误");break;default:console.error("未知错误")}return Promise.reject(e)}));const g={auth:{register:e=>h.post("/auth/register",e),login:e=>h.post("/auth/login",e)},user:{getCurrentUser:()=>h.get("/users/me"),updateUser:e=>h.put("/users/me",e),getAllUsers:()=>h.get("/admin/users")},requirements:{getAll:()=>h.get("/requirements"),getById:e=>h.get(`/requirements/${e}`),create:e=>h.post("/requirements",e),update:(e,t)=>h.put(`/requirements/${e}`,t),delete:e=>h.delete(`/requirements/${e}`),getMyRequirementsWithApplications:()=>h.get("/requirements/my-requirements"),getMyApplications:()=>h.get("/requirements/my-applications"),getApplicationsByRequirement:e=>h.get(`/requirements/${e}/applications`),acceptRequirement:e=>h.post(`/requirements/${e}/accept`),approveApplication:(e,t)=>h.post(`/requirements/${e}/applications/${t}/approve`),rejectApplication:(e,t)=>h.post(`/requirements/${e}/applications/${t}/reject`)},results:{getAll:()=>h.get("/results"),getById:e=>h.get(`/results/${e}`),getByUser:e=>h.get(`/results/user/${e}`),getByRequirement:e=>h.get(`/results/requirement/${e}`),create:e=>h.post("/results",e),update:(e,t)=>h.put(`/results/${e}`,t),delete:e=>h.delete(`/results/${e}`)}};var v=g;const f=()=>{const e=localStorage.getItem("user");return e?JSON.parse(e):null},y=()=>localStorage.getItem("token"),k=(0,p.Kh)({user:f(),token:y(),isAuthenticated:!!y(),error:null,loading:!1}),b={isPlatformSupported(){return"undefined"!==typeof window&&window.Capacitor&&window.Capacitor.isNativePlatform()},async register(e){k.loading=!0,k.error=null;try{console.log("开始注册用户...");const t=await v.auth.register(e);return console.log("注册响应:",t?"成功":"失败"),t.data}catch(t){throw console.error("注册失败详细错误:",t),k.error=t.response?.data?.error||"注册失败，请重试",t}finally{k.loading=!1}},async login(e){k.loading=!0,k.error=null;try{console.log("开始登录...");const r=await v.auth.login(e);if(console.log("登录响应:",r?"成功":"失败"),!r||!r.data)throw new Error("登录响应无效");const{user:n,token:a}=r.data;if(localStorage.setItem("user",JSON.stringify(n)),localStorage.setItem("token",a),k.user=n,k.token=a,k.isAuthenticated=!0,this.isPlatformSupported())try{console.log("尝试保存生物识别凭据...");const{NativeBiometric:t}=await i.e(926).then(i.bind(i,4926));await t.setCredentials({username:e.email,password:e.password,server:"lifetree-app"}),console.log("生物识别凭据保存成功")}catch(t){console.error("保存生物识别凭据失败:",t)}return n}catch(t){throw console.error("登录失败详细错误:",t),t.response&&console.error("错误响应:",t.response.data),k.error=t.response?.data?.error||"登录失败，请检查您的凭据",t}finally{k.loading=!1}},async biometricLogin(){k.loading=!0,k.error=null;try{if(!this.isPlatformSupported())throw new Error("非原生环境，无法使用生物识别");console.log("开始生物识别登录...");const{NativeBiometric:e}=await i.e(926).then(i.bind(i,4926)),t=await e.isAvailable();if(console.log("生物识别可用性检查:",t),!t.isAvailable)throw new Error("设备不支持生物识别");console.log("开始生物识别验证..."),await e.verifyIdentity({reason:"登录到生命树应用",title:"生物识别验证",subtitle:"请使用Face ID或Touch ID进行验证",description:"这将允许您快速安全地登录"}),console.log("生物识别验证成功"),console.log("尝试获取存储的凭据...");const r=await e.getCredentials({server:"lifetree-app"});if(console.log("获取到凭据:",r?"成功":"失败"),!r||!r.username||!r.password)throw new Error("没有找到存储的生物识别凭据");console.log("使用凭据尝试登录...");const n=await v.auth.login({email:r.username,password:r.password});if(console.log("登录响应:",n?"成功":"失败"),!n||!n.data)throw new Error("登录响应无效");const{user:a,token:s}=n.data;return localStorage.setItem("user",JSON.stringify(a)),localStorage.setItem("token",s),k.user=a,k.token=s,k.isAuthenticated=!0,a}catch(e){throw console.error("生物识别登录详细错误:",e),k.error="生物识别登录失败: "+(e.message||"未知错误"),e}finally{k.loading=!1}},async logout(){console.log("执行注销..."),localStorage.removeItem("user"),localStorage.removeItem("token"),k.user=null,k.token=null,k.isAuthenticated=!1,console.log("注销完成")},async getCurrentUser(){if(!k.token)return console.log("无访问令牌，无法获取用户信息"),null;k.loading=!0;try{console.log("开始获取当前用户信息...");const e=await v.user.getCurrentUser();console.log("获取用户信息响应:",e?"成功":"失败");const t=e.data;return localStorage.setItem("user",JSON.stringify(t)),k.user=t,t}catch(e){return console.error("获取用户信息失败:",e),e.response&&401===e.response.status&&(console.log("令牌已过期，执行注销"),await this.logout()),null}finally{k.loading=!1}},async updateUser(e){if(!k.isAuthenticated)return console.log("用户未认证，无法更新用户信息"),null;k.loading=!0;try{console.log("开始更新用户信息...");const t=await v.user.updateUser(e);console.log("更新用户信息响应:",t?"成功":"失败");const i=t.data;return localStorage.setItem("user",JSON.stringify(i)),k.user=i,i}catch(t){throw console.error("更新用户信息失败:",t),k.error=t.response?.data?.error||"更新用户信息失败",t}finally{k.loading=!1}},async isBiometricAvailable(){try{if(!this.isPlatformSupported())return console.log("非原生环境，生物识别不可用"),!1;console.log("检查生物识别可用性...");const{NativeBiometric:t}=await i.e(926).then(i.bind(i,4926)),r=await t.isAvailable();if(console.log("生物识别可用性检查结果:",r),r.isAvailable)try{console.log("检查存储的凭据...");const e=await t.getCredentials({server:"lifetree-app"});return console.log("存储的凭据检查结果:",e?"有凭据":"无凭据"),Boolean(e&&e.username&&e.password)}catch(e){return console.error("获取生物识别凭据失败:",e),!1}return!1}catch(e){return console.error("检查生物识别可用性失败:",e),!1}},async deleteBiometricCredentials(){try{if(!this.isPlatformSupported())return console.log("非原生环境，无法删除生物识别凭据"),!1;console.log("开始删除生物识别凭据...");const{NativeBiometric:e}=await i.e(926).then(i.bind(i,4926));return await e.deleteCredentials({server:"lifetree-app"}),console.log("删除生物识别凭据成功"),!0}catch(e){return console.error("删除生物识别凭据失败:",e),!1}}};var q={state:k,...b};const w={class:"page"};function R(e,t,i,r,a,s){const o=(0,n.g2)("header-bar"),l=(0,n.g2)("nav-bar");return(0,n.uX)(),(0,n.CE)("div",w,[(0,n.bF)(o,{title:"首页","show-back":!1}),t[0]||(t[0]=(0,n.Lk)("div",{class:"page-content home-content"},[(0,n.Lk)("div",{class:"welcome-section"},[(0,n.Lk)("h2",{class:"small-seal-font"},"生命树")])],-1)),(0,n.bF)(l)])}var E=i(33);const C={class:"header-bar"},A={class:"header-title"};function L(e,t,i,r,a,s){const o=(0,n.g2)("van-nav-bar");return(0,n.uX)(),(0,n.CE)("div",C,[(0,n.bF)(o,{"left-text":i.showBack?"返回":"","left-arrow":i.showBack,onClickLeft:s.onClickLeft,"right-text":i.rightText,onClickRight:s.onClickRight},{title:(0,n.k6)((()=>[(0,n.Lk)("span",A,(0,E.v_)(i.title),1)])),_:1},8,["left-text","left-arrow","onClickLeft","right-text","onClickRight"])])}var I={name:"HeaderBar",props:{title:{type:String,default:""},showBack:{type:Boolean,default:!0},rightText:{type:String,default:""}},methods:{onClickLeft(){this.showBack&&this.$router.back()},onClickRight(){this.$emit("right-click")}}};const T=(0,l.A)(I,[["render",L],["__scopeId","data-v-348dafc9"]]);var S=T;const F={class:"nav-bar"},P={class:"custom-icon"},D={class:"icon-circle"};function _(e,t,i,r,a,s){const o=(0,n.g2)("van-tabbar-item"),l=(0,n.g2)("van-icon"),u=(0,n.g2)("van-tabbar");return(0,n.uX)(),(0,n.CE)("div",F,[(0,n.bF)(u,{modelValue:a.active,"onUpdate:modelValue":t[10]||(t[10]=e=>a.active=e),route:""},{default:(0,n.k6)((()=>[(0,n.bF)(o,{to:"/results"},{icon:(0,n.k6)((()=>[(0,n.Lk)("div",{class:"custom-icon",onTouchstart:t[0]||(t[0]=e=>s.handleTouchStart("results")),onTouchend:t[1]||(t[1]=(...e)=>s.handleTouchEnd&&s.handleTouchEnd(...e)),onMousedown:t[2]||(t[2]=e=>s.handleMouseDown("results")),onMouseup:t[3]||(t[3]=(...e)=>s.handleMouseUp&&s.handleMouseUp(...e)),onMouseleave:t[4]||(t[4]=(...e)=>s.handleMouseUp&&s.handleMouseUp(...e))},t[11]||(t[11]=[(0,n.Lk)("div",{class:"icon-circle"},[(0,n.Lk)("img",{src:"https://b.yzcdn.cn/vant/light-theme.svg",alt:"太阳",class:"theme-icon"})],-1)]),32)])),_:1}),(0,n.bF)(o,{to:"/profile"},{icon:(0,n.k6)((()=>[(0,n.Lk)("div",P,[(0,n.Lk)("div",D,[(0,n.bF)(l,{name:"contact",size:"24"})])])])),_:1}),(0,n.bF)(o,{to:"/requirements"},{icon:(0,n.k6)((()=>[(0,n.Lk)("div",{class:"custom-icon",onTouchstart:t[5]||(t[5]=e=>s.handleTouchStart("requirements")),onTouchend:t[6]||(t[6]=(...e)=>s.handleTouchEnd&&s.handleTouchEnd(...e)),onMousedown:t[7]||(t[7]=e=>s.handleMouseDown("requirements")),onMouseup:t[8]||(t[8]=(...e)=>s.handleMouseUp&&s.handleMouseUp(...e)),onMouseleave:t[9]||(t[9]=(...e)=>s.handleMouseUp&&s.handleMouseUp(...e))},t[12]||(t[12]=[(0,n.Lk)("div",{class:"icon-circle"},[(0,n.Lk)("img",{src:"https://b.yzcdn.cn/vant/dark-theme.svg",alt:"月亮",class:"theme-icon"})],-1)]),32)])),_:1})])),_:1},8,["modelValue"])])}i(4114);var x=i(3326),W={name:"NavBar",data(){return{active:0,longPressTimer:null,longPressDelay:800,currentIcon:null}},watch:{$route(e){"/requirements"===e.path?this.active=0:"/profile"===e.path?this.active=1:"/results"===e.path&&(this.active=2)}},created(){const e=this.$route.path;"/requirements"===e?this.active=0:"/profile"===e?this.active=1:"/results"===e?this.active=2:"/"===e&&(this.active=0)},methods:{handleTouchStart(e){this.currentIcon=e,this.longPressTimer&&clearTimeout(this.longPressTimer),this.longPressTimer=setTimeout((()=>{this.onLongPress(e)}),this.longPressDelay)},handleTouchEnd(){this.longPressTimer&&(clearTimeout(this.longPressTimer),this.longPressTimer=null),this.currentIcon=null},handleMouseDown(e){this.currentIcon=e,this.longPressTimer&&clearTimeout(this.longPressTimer),this.longPressTimer=setTimeout((()=>{this.onLongPress(e)}),this.longPressDelay)},handleMouseUp(){this.longPressTimer&&(clearTimeout(this.longPressTimer),this.longPressTimer=null),this.currentIcon=null},onLongPress(e){"requirements"===e?this.$router.push("/requirement/new"):"results"===e&&this.$router.push("/result/new"),(0,x.P0)({message:`正在前往${"requirements"===e?"新建需求":"新建结果"}页面...`,type:"success"})}}};const X=(0,l.A)(W,[["render",_],["__scopeId","data-v-779e60c8"]]);var $=X,N={name:"HomePage",components:{HeaderBar:S,NavBar:$}};const B=(0,l.A)(N,[["render",R],["__scopeId","data-v-158472a2"]]);var O=B;const M={class:"page"},V={class:"page-content"};function U(e,t,i,r,a,s){const o=(0,n.g2)("header-bar"),l=(0,n.g2)("van-empty"),u=(0,n.g2)("van-cell"),c=(0,n.g2)("van-cell-group"),d=(0,n.g2)("van-loading"),p=(0,n.g2)("nav-bar");return(0,n.uX)(),(0,n.CE)("div",M,[(0,n.bF)(o,{title:"需求列表","show-back":!1}),(0,n.Lk)("div",V,[a.loading||0!==a.requirementsList.length?((0,n.uX)(),(0,n.Wv)(c,{key:1,class:"list-container"},{default:(0,n.k6)((()=>[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(s.limitedRequirementsList,(e=>((0,n.uX)(),(0,n.Wv)(u,{key:e.id,title:e.title,"is-link":"",onClick:t=>s.goToDetail(e.id),class:"list-item"},null,8,["title","onClick"])))),128))])),_:1})):((0,n.uX)(),(0,n.Wv)(l,{key:0,description:"暂无需求数据"}))]),a.initialLoading?((0,n.uX)(),(0,n.Wv)(d,{key:0,vertical:"",class:"loading-overlay"},{default:(0,n.k6)((()=>t[0]||(t[0]=[(0,n.eW)("加载中...")]))),_:1})):(0,n.Q3)("",!0),(0,n.bF)(p)])}i(2489);var j={name:"Requirements",components:{HeaderBar:S,NavBar:$},data(){return{requirementsList:[],loading:!1,initialLoading:!0}},computed:{limitedRequirementsList(){const e=this.requirementsList.filter((e=>"CREATED"===e.status||"CONFIRMING"===e.status)),t=[...e].sort(((e,t)=>e.updatedAt&&t.updatedAt?new Date(t.updatedAt)-new Date(e.updatedAt):e.createdAt&&t.createdAt?new Date(t.createdAt)-new Date(e.createdAt):0));return t.slice(0,3)}},created(){this.fetchRequirements()},mounted(){window.addEventListener("focus",this.refreshOnFocus)},beforeUnmount(){window.removeEventListener("focus",this.refreshOnFocus)},methods:{async fetchRequirements(){try{this.initialLoading=!0;const e=await v.requirements.getAll();console.log(e),this.requirementsList=JSON.parse(JSON.stringify(e.data)),console.log("获取到的需求数据:",this.requirementsList)}catch(e){console.error("Error fetching requirements:",e),(0,x.xr)("获取需求列表失败")}finally{this.initialLoading=!1}},refreshOnFocus(){"/requirements"===this.$route.path&&this.fetchRequirements()},goToDetail(e){this.$router.push(`/requirement/${e}`)}}};const z=(0,l.A)(j,[["render",U],["__scopeId","data-v-53956121"]]);var G=z;const H={class:"page"},J={class:"page-content"};function K(e,t,i,r,a,s){const o=(0,n.g2)("header-bar"),l=(0,n.g2)("van-empty"),u=(0,n.g2)("van-cell"),c=(0,n.g2)("van-cell-group"),d=(0,n.g2)("van-loading"),p=(0,n.g2)("nav-bar");return(0,n.uX)(),(0,n.CE)("div",H,[(0,n.bF)(o,{title:"结果列表","show-back":!1}),(0,n.Lk)("div",J,[a.loading||0!==a.resultsList.length?((0,n.uX)(),(0,n.Wv)(c,{key:1,class:"list-container"},{default:(0,n.k6)((()=>[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(s.limitedResultsList,(e=>((0,n.uX)(),(0,n.Wv)(u,{key:e.id,title:e.title,"is-link":"",onClick:t=>s.goToDetail(e.id),class:"list-item"},null,8,["title","onClick"])))),128))])),_:1})):((0,n.uX)(),(0,n.Wv)(l,{key:0,description:"暂无结果数据"}))]),a.initialLoading?((0,n.uX)(),(0,n.Wv)(d,{key:0,vertical:"",class:"loading-overlay"},{default:(0,n.k6)((()=>t[0]||(t[0]=[(0,n.eW)("加载中...")]))),_:1})):(0,n.Q3)("",!0),(0,n.bF)(p)])}var Q={name:"Results",components:{HeaderBar:S,NavBar:$},data(){return{resultsList:[],loading:!1,initialLoading:!0}},computed:{limitedResultsList(){return this.resultsList.slice(0,3)}},created(){this.fetchResults()},methods:{async fetchResults(){try{const e=await v.results.getAll();this.resultsList=e.data.sort(((e,t)=>new Date(t.createdAt)-new Date(e.createdAt))),this.initialLoading=!1}catch(e){console.error("Error fetching results:",e),(0,x.xr)("获取结果列表失败"),this.initialLoading=!1}},goToDetail(e){this.$router.push(`/result/${e}`)},getStatusText(e){const t={DRAFT:"草稿",COMPLETED:"已完成",ARCHIVED:"已归档",REJECTED:"已拒绝"};return t[e]||"未知状态"},getStatusType(e){const t={DRAFT:"primary",COMPLETED:"success",ARCHIVED:"warning",REJECTED:"danger"};return t[e]||"default"}}};const Z=(0,l.A)(Q,[["render",K],["__scopeId","data-v-05c8b3ad"]]);var Y=Z;const ee={class:"page"},te={class:"page-content"},ie={class:"profile-avatar"},re={class:"action-buttons logout-button"},ne={class:"popup-header"},ae={class:"applications-list"},se={class:"application-actions"};function oe(e,t,i,a,s,o){const l=(0,n.g2)("header-bar"),u=(0,n.g2)("van-icon"),c=(0,n.g2)("van-cell"),d=(0,n.g2)("van-cell-group"),p=(0,n.g2)("van-button"),m=(0,n.g2)("van-list"),h=(0,n.g2)("van-tab"),g=(0,n.g2)("van-tag"),v=(0,n.g2)("van-tabs"),f=(0,n.g2)("van-loading"),y=(0,n.g2)("van-empty"),k=(0,n.g2)("van-popup"),b=(0,n.g2)("nav-bar");return(0,n.uX)(),(0,n.CE)("div",ee,[(0,n.bF)(l,{title:"个人信息","show-back":!1}),(0,n.Lk)("div",te,[(0,n.Lk)("div",ie,[(0,n.bF)(u,{name:"contact",size:"64"})]),(0,n.bF)(d,{inset:""},{default:(0,n.k6)((()=>[(0,n.bF)(c,{title:"用户名",value:s.user.name},null,8,["value"]),(0,n.bF)(c,{title:"邮箱",value:s.user.email},null,8,["value"])])),_:1}),(0,n.Lk)("div",re,[(0,n.bF)(p,{type:"default",block:"",onClick:o.logout},{default:(0,n.k6)((()=>t[5]||(t[5]=[(0,n.eW)("退出登录")]))),_:1},8,["onClick"])]),(0,n.bF)(v,{active:s.activeTab,"onUpdate:active":t[2]||(t[2]=e=>s.activeTab=e),sticky:""},{default:(0,n.k6)((()=>[(0,n.bF)(h,{title:"我的需求"},{default:(0,n.k6)((()=>[t[6]||(t[6]=(0,n.Lk)("div",{class:"section-header my-requirements-header"},[(0,n.Lk)("div",{class:"section-title"},"我创建的需求")],-1)),(0,n.bF)(m,{loading:s.myRequirementsLoading,"onUpdate:loading":t[0]||(t[0]=e=>s.myRequirementsLoading=e),finished:s.myRequirementsFinished,"finished-text":"没有更多了",onLoad:o.loadMyRequirements},{default:(0,n.k6)((()=>[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(s.myRequirements,(e=>((0,n.uX)(),(0,n.Wv)(c,{key:e.id,title:e.title,label:o.getPendingApplicantsInfo(e),"is-link":"",onClick:t=>o.goToRequirementDetail(e.id)},(0,n.eX)({_:2},[e.pendingApplicationsCount>0?{name:"right-icon",fn:(0,n.k6)((()=>[(0,n.bF)(p,{size:"small",type:"primary",onClick:(0,r.D$)((t=>o.viewApplications(e.id)),["stop"])},{default:(0,n.k6)((()=>[(0,n.eW)(" 查看申请("+(0,E.v_)(e.pendingApplicationsCount)+") ",1)])),_:2},1032,["onClick"])])),key:"0"}:void 0]),1032,["title","label","onClick"])))),128))])),_:1},8,["loading","finished","onLoad"])])),_:1}),(0,n.bF)(h,{title:"我的申请"},{default:(0,n.k6)((()=>[t[7]||(t[7]=(0,n.Lk)("div",{class:"section-header my-applications-header"},[(0,n.Lk)("div",{class:"section-title"},"我申请的需求")],-1)),(0,n.bF)(m,{loading:s.pendingRequirementsLoading,"onUpdate:loading":t[1]||(t[1]=e=>s.pendingRequirementsLoading=e),finished:s.pendingRequirementsFinished,"finished-text":"没有更多了",onLoad:o.loadPendingRequirements},{default:(0,n.k6)((()=>[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(s.pendingRequirements,(e=>((0,n.uX)(),(0,n.Wv)(c,{key:e.id,title:e.title,"is-link":"",onClick:t=>o.goToRequirementDetail(e.id)},{"right-icon":(0,n.k6)((()=>[(0,n.bF)(g,{type:o.getApplicationStatusType(e.applicationStatus),class:"custom-tag",round:""},{default:(0,n.k6)((()=>[(0,n.eW)((0,E.v_)(o.getApplicationStatusText(e.applicationStatus)),1)])),_:2},1032,["type"])])),_:2},1032,["title","onClick"])))),128))])),_:1},8,["loading","finished","onLoad"])])),_:1})])),_:1},8,["active"])]),(0,n.bF)(k,{show:s.showApplicationsPopup,"onUpdate:show":t[4]||(t[4]=e=>s.showApplicationsPopup=e),position:"bottom",style:{height:"60%"},round:""},{default:(0,n.k6)((()=>[(0,n.Lk)("div",ne,[t[8]||(t[8]=(0,n.Lk)("div",{class:"popup-title"},"申请列表",-1)),(0,n.bF)(u,{name:"cross",onClick:t[3]||(t[3]=e=>s.showApplicationsPopup=!1)})]),(0,n.Lk)("div",ae,[s.applicationsLoading?((0,n.uX)(),(0,n.Wv)(f,{key:0,vertical:""},{default:(0,n.k6)((()=>t[9]||(t[9]=[(0,n.eW)("加载中...")]))),_:1})):((0,n.uX)(),(0,n.CE)(n.FK,{key:1},[0===s.applications.length?((0,n.uX)(),(0,n.Wv)(y,{key:0,description:"暂无申请"})):((0,n.uX)(),(0,n.Wv)(d,{key:1},{default:(0,n.k6)((()=>[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(s.applications,(e=>((0,n.uX)(),(0,n.Wv)(c,{key:e.id,title:e.applicantName,label:o.formatDate(e.createdAt),value:o.getApplicationStatusText(e.status),"value-class":o.getApplicationStatusClass(e.status)},(0,n.eX)({_:2},["PENDING"===e.status?{name:"right-icon",fn:(0,n.k6)((()=>[(0,n.Lk)("div",se,[(0,n.bF)(p,{size:"small",type:"success",onClick:t=>o.approveApplication(e.requirementId,e.id),loading:s.approvingId===e.id},{default:(0,n.k6)((()=>t[10]||(t[10]=[(0,n.eW)(" 同意 ")]))),_:2},1032,["onClick","loading"]),(0,n.bF)(p,{size:"small",type:"danger",onClick:t=>o.rejectApplication(e.requirementId,e.id),loading:s.rejectingId===e.id},{default:(0,n.k6)((()=>t[11]||(t[11]=[(0,n.eW)(" 拒绝 ")]))),_:2},1032,["onClick","loading"])])])),key:"0"}:void 0]),1032,["title","label","value","value-class"])))),128))])),_:1}))],64))])])),_:1},8,["show"]),(0,n.bF)(b)])}var le={name:"ProfilePage",components:{HeaderBar:S,NavBar:$},data(){return{user:{id:"",name:"",email:""},activeTab:0,myRequirements:[],myRequirementsLoading:!1,myRequirementsFinished:!1,pendingRequirements:[],pendingRequirementsLoading:!1,pendingRequirementsFinished:!1,showApplicationsPopup:!1,applications:[],applicationsLoading:!1,currentRequirementId:null,approvingId:null,rejectingId:null}},created(){this.fetchUserData()},methods:{fetchUserData(){this.user=q.state.user||{name:"未知用户",email:"未知邮箱"}},async loadMyRequirements(){try{const e=await v.requirements.getMyRequirementsWithApplications();this.myRequirements=e.data,this.myRequirementsFinished=!0,this.myRequirementsLoading=!1}catch(e){console.error("Error loading my requirements:",e),(0,x.xr)("加载需求失败"),this.myRequirementsLoading=!1}},async loadPendingRequirements(){try{const e=await v.requirements.getMyApplications();this.pendingRequirements=e.data,this.pendingRequirementsFinished=!0,this.pendingRequirementsLoading=!1}catch(e){console.error("Error loading pending requirements:",e),(0,x.xr)("加载申请失败"),this.pendingRequirementsLoading=!1}},async loadApplications(e){this.applicationsLoading=!0,this.currentRequirementId=e;try{const t=await v.requirements.getApplicationsByRequirement(e);this.applications=t.data}catch(t){console.error("Error loading applications:",t),(0,x.xr)("加载申请列表失败")}finally{this.applicationsLoading=!1}},viewApplications(e){this.loadApplications(e),this.showApplicationsPopup=!0},async approveApplication(e,t){this.approvingId=t;try{await v.requirements.approveApplication(e,t),(0,x.GF)("已同意申请"),this.loadApplications(e),this.loadMyRequirements()}catch(i){console.error("Error approving application:",i),(0,x.xr)("操作失败")}finally{this.approvingId=null}},async rejectApplication(e,t){this.rejectingId=t;try{await v.requirements.rejectApplication(e,t),(0,x.GF)("已拒绝申请"),this.loadApplications(e),this.loadMyRequirements()}catch(i){console.error("Error rejecting application:",i),(0,x.xr)("操作失败")}finally{this.rejectingId=null}},getPendingApplicantsInfo(e){return e.pendingApplicationsCount>0?`${e.pendingApplicationsCount}人申请 | 状态: ${this.getStatusText(e.status)}`:`状态: ${this.getStatusText(e.status)}`},getStatusText(e){const t={CREATED:"已创建",CONFIRMING:"确认中",IN_PROGRESS:"进行中",COMPLETED:"已完成",CANCELLED:"已取消"};return t[e]||"未知状态"},getApplicationStatusText(e){const t={PENDING:"等待确认",APPROVED:"已同意",REJECTED:"已拒绝"};return t[e]||"未知状态"},getApplicationStatusType(e){const t={PENDING:"warning",APPROVED:"success",REJECTED:"danger"};return t[e]||"default"},getApplicationStatusClass(e){const t={PENDING:"status-pending",APPROVED:"status-approved",REJECTED:"status-rejected"};return t[e]||""},formatDate(e){if(!e)return"";const t=new Date(e);return t.toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})},goToRequirementDetail(e){this.$router.push(`/requirement/${e}`)},logout(){q.logout(),this.$router.push("/login")}}};const ue=(0,l.A)(le,[["render",oe],["__scopeId","data-v-e013082a"]]);var ce=ue;const de={class:"page"},pe={class:"page-content"},me={class:"detail-header"},he={class:"detail-meta"},ge={class:"status-row"},ve={key:0,class:"application-count"},fe={class:"detail-content"},ye=["innerHTML"],ke={class:"application-actions"},be={class:"bottom-action-bar"},qe={class:"icon-circle"};function we(e,t,i,r,a,s){const o=(0,n.g2)("header-bar"),l=(0,n.g2)("van-loading"),u=(0,n.g2)("van-tag"),c=(0,n.g2)("van-cell-group"),d=(0,n.g2)("van-button"),p=(0,n.g2)("van-cell"),m=(0,n.g2)("van-action-sheet"),h=(0,n.g2)("van-icon");return(0,n.uX)(),(0,n.CE)("div",de,[(0,n.bF)(o,{title:"需求详情"}),(0,n.Lk)("div",pe,[a.loading?((0,n.uX)(),(0,n.Wv)(l,{key:0,vertical:"",class:"loading-overlay"},{default:(0,n.k6)((()=>t[3]||(t[3]=[(0,n.eW)("加载中...")]))),_:1})):((0,n.uX)(),(0,n.CE)(n.FK,{key:1},[(0,n.Lk)("div",me,[(0,n.Lk)("h2",null,(0,E.v_)(a.requirement.title),1),(0,n.Lk)("div",he,[(0,n.Lk)("div",ge,[(0,n.bF)(u,{type:s.getStatusType(a.requirement.status),class:"custom-tag",round:""},{default:(0,n.k6)((()=>[(0,n.eW)((0,E.v_)(s.getStatusText(a.requirement.status)),1)])),_:1},8,["type"]),a.pendingApplicationsCount>0?((0,n.uX)(),(0,n.CE)("span",ve,(0,E.v_)(a.pendingApplicationsCount)+"人申请 ",1)):(0,n.Q3)("",!0)]),(0,n.Lk)("span",null,"发布时间: "+(0,E.v_)(s.formatDate(a.requirement.createdAt)),1)])]),(0,n.bF)(c,{inset:"",title:"需求描述"},{default:(0,n.k6)((()=>[(0,n.Lk)("div",fe,[(0,n.Lk)("p",{innerHTML:a.requirement.description},null,8,ye)])])),_:1}),s.hasPermission&&a.pendingApplicationsCount>0?((0,n.uX)(),(0,n.Wv)(c,{key:0,inset:"",title:"申请人列表",style:{"margin-top":"16px"}},{default:(0,n.k6)((()=>[a.applicationsLoading?((0,n.uX)(),(0,n.Wv)(l,{key:0,size:"24px"},{default:(0,n.k6)((()=>t[4]||(t[4]=[(0,n.eW)("加载中...")]))),_:1})):((0,n.uX)(!0),(0,n.CE)(n.FK,{key:1},(0,n.pI)(a.pendingApplications,(e=>((0,n.uX)(),(0,n.Wv)(p,{key:e.id,title:e.applicantName,label:s.formatDate(e.createdAt)},{"right-icon":(0,n.k6)((()=>[(0,n.Lk)("div",ke,[(0,n.bF)(d,{size:"small",type:"success",onClick:t=>s.approveApplication(e.id),loading:a.approvingId===e.id},{default:(0,n.k6)((()=>t[5]||(t[5]=[(0,n.eW)(" 同意 ")]))),_:2},1032,["onClick","loading"]),(0,n.bF)(d,{size:"small",type:"danger",onClick:t=>s.rejectApplication(e.id),loading:a.rejectingId===e.id},{default:(0,n.k6)((()=>t[6]||(t[6]=[(0,n.eW)(" 拒绝 ")]))),_:2},1032,["onClick","loading"])])])),_:2},1032,["title","label"])))),128))])),_:1})):(0,n.Q3)("",!0),s.hasPermission?((0,n.uX)(),(0,n.Wv)(c,{key:1,inset:"",title:"操作",style:{"margin-top":"16px"}},{default:(0,n.k6)((()=>[(0,n.bF)(p,{title:"查看相关结果","is-link":"",onClick:s.goToResults},null,8,["onClick"]),(0,n.bF)(p,{title:"更改状态","is-link":"",onClick:t[0]||(t[0]=e=>a.showStatusActionSheet=!0)}),(0,n.bF)(p,{title:"删除需求","is-link":"",onClick:s.confirmDelete},null,8,["onClick"])])),_:1})):((0,n.uX)(),(0,n.Wv)(c,{key:2,inset:"",title:"操作",style:{"margin-top":"16px"}},{default:(0,n.k6)((()=>[(0,n.bF)(p,{title:"查看相关结果","is-link":"",onClick:s.goToResults},null,8,["onClick"])])),_:1}))],64))]),(0,n.bF)(m,{show:a.showStatusActionSheet,"onUpdate:show":t[1]||(t[1]=e=>a.showStatusActionSheet=e),actions:a.statusActions,"cancel-text":"取消",onSelect:s.onSelectStatus},null,8,["show","actions","onSelect"]),(0,n.Lk)("div",be,[(0,n.Lk)("div",{onClick:t[2]||(t[2]=(...e)=>s.goToAgreement&&s.goToAgreement(...e))},[(0,n.Lk)("div",qe,[(0,n.bF)(h,{name:"friends-o",size:"24"})])])])])}var Re=i(5749),Ee={name:"RequirementDetailPage",components:{HeaderBar:S},props:{id:{type:[String,Number],required:!0}},data(){return{requirement:{id:"",title:"",description:"",status:"",createdBy:"",createdAt:"",updatedAt:""},loading:!0,pendingApplicationsCount:0,pendingApplications:[],applicationsLoading:!1,showStatusActionSheet:!1,statusActions:[{name:"已创建",value:"CREATED"},{name:"进行中",value:"IN_PROGRESS"},{name:"已完成",value:"COMPLETED"},{name:"已取消",value:"CANCELLED"}],approvingId:null,rejectingId:null}},computed:{hasPermission(){const e=q.state.user;return!!e&&("ADMIN"===e.role||e.id===this.requirement.createdBy)}},created(){this.fetchRequirementDetail()},methods:{async fetchRequirementDetail(){this.loading=!0;try{const e=await v.requirements.getById(this.id);this.requirement=e.data,this.hasPermission&&this.fetchApplications()}catch(e){console.error("Error fetching requirement detail:",e),(0,x.xr)("获取需求详情失败")}finally{this.loading=!1}},async fetchApplications(){this.applicationsLoading=!0;try{const e=await v.requirements.getApplicationsByRequirement(this.id);this.pendingApplications=e.data.filter((e=>"PENDING"===e.status)),this.pendingApplicationsCount=this.pendingApplications.length}catch(e){console.error("Error fetching applications:",e)}finally{this.applicationsLoading=!1}},async approveApplication(e){this.approvingId=e;try{await v.requirements.approveApplication(this.id,e),(0,x.GF)("已同意申请"),this.fetchRequirementDetail()}catch(t){console.error("Error approving application:",t),(0,x.xr)("操作失败: "+(t.response?.data?.message||"未知错误"))}finally{this.approvingId=null}},async rejectApplication(e){this.rejectingId=e;try{await v.requirements.rejectApplication(this.id,e),(0,x.GF)("已拒绝申请"),this.fetchRequirementDetail()}catch(t){console.error("Error rejecting application:",t),(0,x.xr)("操作失败: "+(t.response?.data?.message||"未知错误"))}finally{this.rejectingId=null}},formatDate(e){if(!e)return"未知";const t=new Date(e);return t.toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})},getStatusText(e){const t={CREATED:"已创建",CONFIRMING:"确认中",IN_PROGRESS:"进行中",COMPLETED:"已完成",CANCELLED:"已取消"};return t[e]||"未知状态"},getStatusType(e){const t={CREATED:"primary",CONFIRMING:"warning",IN_PROGRESS:"success",COMPLETED:"success",CANCELLED:"danger"};return t[e]||"default"},async onSelectStatus(e){if(this.hasPermission)try{await v.requirements.update(this.id,{status:e.value}),this.requirement.status=e.value,(0,x.GF)("状态更新成功")}catch(t){console.error("Error updating status:",t),(0,x.xr)("状态更新失败")}else(0,x.xr)("您没有权限执行此操作")},confirmDelete(){this.hasPermission?(0,Re.M5)({title:"确认删除",message:"确定要删除这个需求吗？此操作不可撤销！"}).then((async()=>{try{await v.requirements.delete(this.id),(0,x.GF)("需求已删除"),this.$router.push("/requirements")}catch(e){console.error("Error deleting requirement:",e),(0,x.xr)("删除需求失败")}})).catch((()=>{})):(0,x.xr)("您没有权限执行此操作")},goToAgreement(){this.$router.push({path:"/agreement",query:{requirementId:this.id,status:this.requirement.status}})},goToResults(){this.$router.push(`/results/requirement/${this.id}`)}}};const Ce=(0,l.A)(Ee,[["render",we],["__scopeId","data-v-6184d9cd"]]);var Ae=Ce;const Le={class:"page"},Ie={class:"page-content"},Te={class:"detail-header"},Se={class:"detail-meta"},Fe={class:"status-row"},Pe={class:"detail-content"},De=["innerHTML"];function _e(e,t,i,r,a,s){const o=(0,n.g2)("header-bar"),l=(0,n.g2)("van-loading"),u=(0,n.g2)("van-tag"),c=(0,n.g2)("van-cell-group"),d=(0,n.g2)("van-cell"),p=(0,n.g2)("van-action-sheet");return(0,n.uX)(),(0,n.CE)("div",Le,[s.hasPermission?((0,n.uX)(),(0,n.Wv)(o,{key:0,title:a.result.title||"结果详情","right-text":"编辑",onRightClick:s.goToEdit},null,8,["title","onRightClick"])):((0,n.uX)(),(0,n.Wv)(o,{key:1,title:a.result.title||"结果详情"},null,8,["title"])),(0,n.Lk)("div",Ie,[a.loading?((0,n.uX)(),(0,n.Wv)(l,{key:0,vertical:"",class:"loading-overlay"},{default:(0,n.k6)((()=>t[2]||(t[2]=[(0,n.eW)("加载中...")]))),_:1})):((0,n.uX)(),(0,n.CE)(n.FK,{key:1},[(0,n.Lk)("div",Te,[(0,n.Lk)("h2",null,(0,E.v_)(a.result.title),1),(0,n.Lk)("div",Se,[(0,n.Lk)("div",Fe,[(0,n.bF)(u,{type:s.getStatusType(a.result.status),class:"custom-tag",round:""},{default:(0,n.k6)((()=>[(0,n.eW)((0,E.v_)(s.getStatusText(a.result.status)),1)])),_:1},8,["type"])]),(0,n.Lk)("span",null,"创建时间: "+(0,E.v_)(s.formatDate(a.result.createdAt)),1),(0,n.Lk)("span",null,"更新时间: "+(0,E.v_)(s.formatDate(a.result.updatedAt)),1)])]),(0,n.bF)(c,{inset:"",title:"结果描述"},{default:(0,n.k6)((()=>[(0,n.Lk)("div",Pe,[(0,n.Lk)("p",{innerHTML:a.result.description},null,8,De)])])),_:1}),a.result.relatedRequirementId?((0,n.uX)(),(0,n.Wv)(c,{key:0,inset:"",title:"关联需求"},{default:(0,n.k6)((()=>[(0,n.bF)(d,{title:a.relatedRequirementTitle||"查看关联需求","is-link":"",onClick:s.goToRelatedRequirement},null,8,["title","onClick"])])),_:1})):(0,n.Q3)("",!0),s.hasPermission?((0,n.uX)(),(0,n.Wv)(c,{key:1,inset:"",title:"操作",style:{"margin-top":"16px"}},{default:(0,n.k6)((()=>[(0,n.bF)(d,{title:"更改状态","is-link":"",onClick:t[0]||(t[0]=e=>a.showStatusActionSheet=!0)}),(0,n.bF)(d,{title:"删除结果","is-link":"",onClick:s.confirmDelete},null,8,["onClick"])])),_:1})):(0,n.Q3)("",!0)],64))]),(0,n.bF)(p,{show:a.showStatusActionSheet,"onUpdate:show":t[1]||(t[1]=e=>a.showStatusActionSheet=e),actions:a.statusActions,"cancel-text":"取消",onSelect:s.onSelectStatus},null,8,["show","actions","onSelect"])])}var xe={name:"ResultDetailPage",components:{HeaderBar:S},props:{id:{type:String,required:!0}},data(){return{result:{id:"",title:"",description:"",status:"",relatedRequirementId:null,createdBy:"",createdAt:"",updatedAt:""},relatedRequirementTitle:"",loading:!0,showStatusActionSheet:!1,statusActions:[{name:"草稿",value:"DRAFT"},{name:"已完成",value:"COMPLETED"},{name:"已归档",value:"ARCHIVED"},{name:"已拒绝",value:"REJECTED"}]}},computed:{hasPermission(){const e=q.state.user;return!!e&&("ADMIN"===e.role||e.id===this.result.createdBy)}},created(){this.fetchResultDetail()},methods:{async fetchResultDetail(){this.loading=!0;try{const e=await v.results.getById(this.id);this.result=e.data,this.result.relatedRequirementId&&this.fetchRelatedRequirement(this.result.relatedRequirementId)}catch(e){console.error("Error fetching result detail:",e),(0,x.xr)("获取结果详情失败")}finally{this.loading=!1}},async fetchRelatedRequirement(e){try{const t=await v.requirements.getById(e);this.relatedRequirementTitle=t.data.title}catch(t){console.error("Error fetching related requirement:",t),this.relatedRequirementTitle="未能获取需求标题"}},formatDate(e){if(!e)return"未知";const t=new Date(e);return t.toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})},getStatusText(e){const t={DRAFT:"草稿",COMPLETED:"已完成",ARCHIVED:"已归档",REJECTED:"已拒绝"};return t[e]||"未知状态"},getStatusType(e){const t={DRAFT:"primary",COMPLETED:"success",ARCHIVED:"warning",REJECTED:"danger"};return t[e]||"default"},async onSelectStatus(e){if(this.hasPermission)try{await v.results.update(this.id,{status:e.value}),this.result.status=e.value,(0,x.GF)("状态更新成功")}catch(t){console.error("Error updating status:",t),(0,x.xr)("状态更新失败")}else(0,x.xr)("您没有权限执行此操作")},confirmDelete(){this.hasPermission?(0,Re.M5)({title:"确认删除",message:"确定要删除这个结果吗？此操作不可撤销！"}).then((async()=>{try{await v.results.delete(this.id),(0,x.GF)("结果已删除"),this.$router.push("/results")}catch(e){console.error("Error deleting result:",e),(0,x.xr)("删除结果失败")}})).catch((()=>{})):(0,x.xr)("您没有权限执行此操作")},goToEdit(){this.hasPermission?this.$router.push(`/result/edit/${this.id}`):(0,x.xr)("您没有权限执行此操作")},goToRelatedRequirement(){this.result.relatedRequirementId&&this.$router.push(`/requirement/${this.result.relatedRequirementId}`)}}};const We=(0,l.A)(xe,[["render",_e],["__scopeId","data-v-be9cfd0c"]]);var Xe=We;const $e={class:"page"},Ne={class:"page-content"},Be={class:"agreement-action"},Oe={key:1,class:"info-text"},Me={style:{"margin-top":"16px"}},Ve={key:3,class:"info-text"},Ue={key:0},je={key:1},ze={style:{"margin-top":"16px"}};function Ge(e,t,i,r,a,s){const o=(0,n.g2)("header-bar"),l=(0,n.g2)("van-button");return(0,n.uX)(),(0,n.CE)("div",$e,[(0,n.bF)(o,{title:"协议"}),(0,n.Lk)("div",Ne,[t[5]||(t[5]=(0,n.Fv)('<div class="agreement-header" data-v-079a778c><h2 data-v-079a778c>服务协议</h2><div class="agreement-version" data-v-079a778c><span data-v-079a778c>版本号: v1.0.0</span></div></div><div class="agreement-content" data-v-079a778c><h3 data-v-079a778c>1. 协议介绍</h3><p data-v-079a778c>本协议是您与我们之间关于使用本应用服务所订立的契约。请您仔细阅读本协议，确保理解各条款内容。</p><h3 data-v-079a778c>2. 服务内容</h3><p data-v-079a778c>本应用提供需求发布、需求管理和结果展示等服务，具体服务内容以实际提供的为准。我们有权对服务内容进行更新或调整。</p><h3 data-v-079a778c>3. 用户隐私</h3><p data-v-079a778c>我们尊重并保护用户隐私。我们会按照隐私政策收集、使用、存储和分享您的个人信息。请您详细阅读我们的隐私政策并理解其内容。</p><h3 data-v-079a778c>4. 用户行为</h3><p data-v-079a778c>用户在使用本应用服务时应遵守相关法律法规，不得利用本应用从事违法活动。用户需对自己在本应用上发布的内容负责。</p><h3 data-v-079a778c>5. 免责声明</h3><p data-v-079a778c>因网络状况、通讯线路等任何技术原因而导致用户不能正常使用本应用，我们不承担任何法律责任。我们对用户使用本应用的结果不做任何保证。</p><h3 data-v-079a778c>6. 协议修改</h3><p data-v-079a778c>我们保留随时修改本协议的权利。协议修改后，将在应用内通知用户。如用户继续使用本应用，则视为接受修改后的协议。</p></div>',2)),(0,n.Lk)("div",Be,[!a.requirementId||"CREATED"!==a.requirementStatus&&"IN_PROGRESS"!==a.requirementStatus||s.isCreator||a.alreadyApplied?a.requirementId&&a.alreadyApplied?((0,n.uX)(),(0,n.CE)("div",Oe,[t[2]||(t[2]=(0,n.Lk)("p",null,"您已经申请过这个需求，请等待确认",-1)),(0,n.Lk)("div",Me,[(0,n.bF)(l,{type:"default",block:"",onClick:s.goBack},{default:(0,n.k6)((()=>t[1]||(t[1]=[(0,n.eW)("返回")]))),_:1},8,["onClick"])])])):a.requirementId?((0,n.uX)(),(0,n.CE)("div",Ve,[s.isCreator?((0,n.uX)(),(0,n.CE)("p",Ue,"这是您创建的需求，您可以在个人中心查看申请情况")):["COMPLETED","CANCELLED"].includes(a.requirementStatus)?((0,n.uX)(),(0,n.CE)("p",je,"此需求当前状态不可接受")):(0,n.Q3)("",!0),(0,n.Lk)("div",ze,[(0,n.bF)(l,{type:"default",block:"",onClick:s.goBack},{default:(0,n.k6)((()=>t[4]||(t[4]=[(0,n.eW)("返回")]))),_:1},8,["onClick"])])])):((0,n.uX)(),(0,n.Wv)(l,{key:2,type:"primary",block:"",onClick:s.goBack},{default:(0,n.k6)((()=>t[3]||(t[3]=[(0,n.eW)("返回")]))),_:1},8,["onClick"])):((0,n.uX)(),(0,n.Wv)(l,{key:0,type:"primary",block:"",onClick:s.acceptRequirement,loading:a.loading},{default:(0,n.k6)((()=>t[0]||(t[0]=[(0,n.eW)(" 申请接受需求 ")]))),_:1},8,["onClick","loading"]))])])])}var He={name:"AgreementPage",components:{HeaderBar:S},data(){return{requirementId:null,requirementStatus:null,requirementCreatedBy:null,loading:!1,alreadyApplied:!1}},computed:{isCreator(){const e=q.state.user?.id;return this.requirementCreatedBy===e}},created(){this.$route.query.requirementId&&(this.requirementId=this.$route.query.requirementId,this.requirementStatus=this.$route.query.status,this.fetchRequirementDetails(),this.checkUserApplication())},methods:{async fetchRequirementDetails(){if(this.requirementId)try{const e=await v.requirements.getById(this.requirementId);this.requirementCreatedBy=e.data.createdBy}catch(e){console.error("Error fetching requirement details:",e)}},async checkUserApplication(){if(this.requirementId)try{const e=await v.requirements.getMyApplications(),t=e.data.some((e=>e.id===this.requirementId&&("PENDING"===e.applicationStatus||"APPROVED"===e.applicationStatus)));this.alreadyApplied=t}catch(e){console.error("Error checking user applications:",e)}},goBack(){this.$router.back()},async acceptRequirement(){if(this.requirementId){this.loading=!0;try{await v.requirements.acceptRequirement(this.requirementId),(0,x.GF)("申请已提交，等待确认"),this.$router.push(`/requirement/${this.requirementId}`)}catch(e){console.error("Error accepting requirement:",e),(0,x.xr)("接受需求失败: "+(e.response?.data?.message||"未知错误"))}finally{this.loading=!1}}}}};const Je=(0,l.A)(He,[["render",Ge],["__scopeId","data-v-079a778c"]]);var Ke=Je;const Qe={class:"page"},Ze={class:"page-content"},Ye={class:"rich-text-wrapper"},et={ref:"editor",class:"rich-text-editor"},tt={key:0,class:"error-message"},it={style:{margin:"16px"}};function rt(e,t,i,r,a,s){const o=(0,n.g2)("header-bar"),l=(0,n.g2)("van-field"),u=(0,n.g2)("van-cell-group"),c=(0,n.g2)("van-button"),d=(0,n.g2)("van-form");return(0,n.uX)(),(0,n.CE)("div",Qe,[(0,n.bF)(o,{title:"新建需求"}),(0,n.Lk)("div",Ze,[(0,n.bF)(d,{onSubmit:s.onSubmit},{default:(0,n.k6)((()=>[(0,n.bF)(u,{inset:""},{default:(0,n.k6)((()=>[(0,n.bF)(l,{modelValue:a.title,"onUpdate:modelValue":t[0]||(t[0]=e=>a.title=e),name:"title",label:"需求标题",placeholder:"请输入需求标题",rules:[{required:!0,message:"请填写需求标题"}]},null,8,["modelValue"]),(0,n.Lk)("div",Ye,[t[1]||(t[1]=(0,n.Lk)("div",{class:"field-label"},"需求描述",-1)),(0,n.Lk)("div",et,null,512),a.descriptionError?((0,n.uX)(),(0,n.CE)("div",tt,"请填写需求描述")):(0,n.Q3)("",!0)])])),_:1}),(0,n.Lk)("div",it,[(0,n.bF)(c,{round:"",block:"",type:"primary","native-type":"submit",loading:a.submitting,disabled:a.submitting},{default:(0,n.k6)((()=>t[2]||(t[2]=[(0,n.eW)(" 提交 ")]))),_:1},8,["loading","disabled"])])])),_:1},8,["onSubmit"])])])}var nt=i(2284),at=i.n(nt),st={name:"NewRequirementPage",components:{HeaderBar:S},data(){return{title:"",description:"",editor:null,submitting:!1,descriptionError:!1}},mounted(){this.initEditor()},beforeUnmount(){this.editor&&(this.editor.destroy(),this.editor=null)},methods:{initEditor(){this.editor=new(at())(this.$refs.editor),this.editor.config.placeholder="请输入需求详细描述",this.editor.config.zIndex=100,this.editor.config.menus=["bold","italic","underline","head","fontSize","fontName","strikeThrough","foreColor","backColor","link","list","justify","quote","emoticon","undo","redo"],window.innerWidth<768&&(this.editor.config.menus=["bold","head","fontSize","list","justify","emoticon","undo","redo"]),this.editor.config.height=250,this.editor.create()},validateDescription(){const e=this.editor.txt.html();return e&&"<p><br></p>"!==e?(this.descriptionError=!1,this.description=e,!0):(this.descriptionError=!0,!1)},async onSubmit(){if(this.validateDescription()){this.submitting=!0;try{const e={title:this.title,description:this.description};await v.requirements.create(e),(0,x.GF)("需求创建成功"),setTimeout((()=>{this.$router.push("/requirements")}),1e3)}catch(e){console.error("Error creating requirement:",e),(0,x.xr)("创建需求失败: "+(e.response?.data?.error||"未知错误"))}finally{this.submitting=!1}}}}};const ot=(0,l.A)(st,[["render",rt],["__scopeId","data-v-23f86520"]]);var lt=ot;const ut={class:"page"},ct={class:"page-content"},dt={class:"rich-text-wrapper"},pt={ref:"editor",class:"rich-text-editor"},mt={key:0,class:"error-message"},ht={style:{margin:"16px"}};function gt(e,t,i,r,a,s){const o=(0,n.g2)("header-bar"),l=(0,n.g2)("van-loading"),u=(0,n.g2)("van-field"),c=(0,n.g2)("van-dropdown-item"),d=(0,n.g2)("van-dropdown-menu"),p=(0,n.g2)("van-cell-group"),m=(0,n.g2)("van-button"),h=(0,n.g2)("van-form");return(0,n.uX)(),(0,n.CE)("div",ut,[(0,n.bF)(o,{title:"编辑需求"}),(0,n.Lk)("div",ct,[a.loading?((0,n.uX)(),(0,n.Wv)(l,{key:0,vertical:"",class:"loading-overlay"},{default:(0,n.k6)((()=>t[2]||(t[2]=[(0,n.eW)("加载中...")]))),_:1})):((0,n.uX)(),(0,n.Wv)(h,{key:1,onSubmit:s.onSubmit},{default:(0,n.k6)((()=>[(0,n.bF)(p,{inset:""},{default:(0,n.k6)((()=>[(0,n.bF)(u,{modelValue:a.title,"onUpdate:modelValue":t[0]||(t[0]=e=>a.title=e),name:"title",label:"需求标题",placeholder:"请输入需求标题",rules:[{required:!0,message:"请填写需求标题"}]},null,8,["modelValue"]),(0,n.Lk)("div",dt,[t[3]||(t[3]=(0,n.Lk)("div",{class:"field-label"},"需求描述",-1)),(0,n.Lk)("div",pt,null,512),a.descriptionError?((0,n.uX)(),(0,n.CE)("div",mt,"请填写需求描述")):(0,n.Q3)("",!0)]),(0,n.bF)(u,{name:"status",label:"状态",readonly:""},{input:(0,n.k6)((()=>[(0,n.bF)(d,null,{default:(0,n.k6)((()=>[(0,n.bF)(c,{modelValue:a.status,"onUpdate:modelValue":t[1]||(t[1]=e=>a.status=e),options:a.statusOptions},null,8,["modelValue","options"])])),_:1})])),_:1})])),_:1}),(0,n.Lk)("div",ht,[(0,n.bF)(m,{round:"",block:"",type:"primary","native-type":"submit",loading:a.submitting,disabled:a.submitting},{default:(0,n.k6)((()=>t[4]||(t[4]=[(0,n.eW)(" 保存 ")]))),_:1},8,["loading","disabled"])])])),_:1},8,["onSubmit"]))])])}var vt={name:"EditRequirementPage",components:{HeaderBar:S},props:{id:{type:String,required:!0}},data(){return{title:"",description:"",status:"",loading:!0,submitting:!1,descriptionError:!1,editor:null,statusOptions:[{text:"已创建",value:"CREATED"},{text:"进行中",value:"IN_PROGRESS"},{text:"已完成",value:"COMPLETED"},{text:"已取消",value:"CANCELLED"}]}},mounted(){this.fetchRequirementDetail()},beforeUnmount(){this.editor&&(this.editor.destroy(),this.editor=null)},methods:{async fetchRequirementDetail(){try{const e=await v.requirements.getById(this.id),t=e.data;this.title=t.title,this.description=t.description,this.status=t.status,this.loading=!1,this.$nextTick((()=>{this.initEditor()}))}catch(e){console.error("Error fetching requirement:",e),(0,x.xr)("获取需求详情失败"),this.$router.push(`/requirement/${this.id}`)}},initEditor(){this.editor=new(at())(this.$refs.editor),this.editor.config.placeholder="请输入需求详细描述",this.editor.config.zIndex=100,this.editor.config.menus=["bold","italic","underline","head","fontSize","fontName","strikeThrough","foreColor","backColor","link","list","justify","quote","emoticon","undo","redo"],window.innerWidth<768&&(this.editor.config.menus=["bold","head","fontSize","list","justify","emoticon","undo","redo"]),this.editor.config.height=250,this.editor.create(),this.editor.txt.html(this.description)},validateDescription(){const e=this.editor.txt.html();return e&&"<p><br></p>"!==e?(this.descriptionError=!1,this.description=e,!0):(this.descriptionError=!0,!1)},async onSubmit(){if(this.validateDescription()){this.submitting=!0;try{const e={title:this.title,description:this.description,status:this.status};await v.requirements.update(this.id,e),(0,x.GF)("需求更新成功"),setTimeout((()=>{this.$router.push(`/requirement/${this.id}`)}),1e3)}catch(e){console.error("Error updating requirement:",e),(0,x.xr)("更新需求失败: "+(e.response?.data?.error||"未知错误"))}finally{this.submitting=!1}}}}};const ft=(0,l.A)(vt,[["render",gt],["__scopeId","data-v-e8c3c826"]]);var yt=ft;const kt={class:"page"},bt={class:"page-content"},qt={class:"rich-text-wrapper"},wt={ref:"editor",class:"rich-text-editor"},Rt={key:0,class:"error-message"},Et={style:{margin:"16px"}};function Ct(e,t,i,r,a,s){const o=(0,n.g2)("header-bar"),l=(0,n.g2)("van-field"),u=(0,n.g2)("van-cell-group"),c=(0,n.g2)("van-button"),d=(0,n.g2)("van-form"),p=(0,n.g2)("van-picker"),m=(0,n.g2)("van-popup"),h=(0,n.g2)("van-loading");return(0,n.uX)(),(0,n.CE)("div",kt,[(0,n.bF)(o,{title:"新建结果"}),(0,n.Lk)("div",bt,[(0,n.bF)(d,{onSubmit:s.onSubmit},{default:(0,n.k6)((()=>[(0,n.bF)(u,{inset:""},{default:(0,n.k6)((()=>[(0,n.bF)(l,{modelValue:a.title,"onUpdate:modelValue":t[0]||(t[0]=e=>a.title=e),name:"title",label:"结果标题",placeholder:"请输入结果标题",rules:[{required:!0,message:"请填写结果标题"}]},null,8,["modelValue"]),(0,n.Lk)("div",qt,[t[4]||(t[4]=(0,n.Lk)("div",{class:"field-label"},"结果描述",-1)),(0,n.Lk)("div",wt,null,512),a.descriptionError?((0,n.uX)(),(0,n.CE)("div",Rt,"请填写结果描述")):(0,n.Q3)("",!0)]),!a.relatedRequirementId&&s.requirementOptions.length>0?((0,n.uX)(),(0,n.Wv)(l,{key:0,readonly:"",name:"relatedRequirement",label:"关联需求",value:a.selectedRequirementTitle,"right-icon":"arrow-down",onClick:t[1]||(t[1]=e=>a.showRequirementPicker=!0)},null,8,["value"])):(0,n.Q3)("",!0),a.relatedRequirementId?((0,n.uX)(),(0,n.Wv)(l,{key:1,readonly:"",name:"relatedRequirementFixed",label:"关联需求",value:a.selectedRequirementTitle},null,8,["value"])):(0,n.Q3)("",!0)])),_:1}),(0,n.Lk)("div",Et,[(0,n.bF)(c,{round:"",block:"",type:"primary","native-type":"submit",loading:a.submitting,disabled:a.submitting},{default:(0,n.k6)((()=>t[5]||(t[5]=[(0,n.eW)(" 提交 ")]))),_:1},8,["loading","disabled"])])])),_:1},8,["onSubmit"]),(0,n.bF)(m,{show:a.showRequirementPicker,"onUpdate:show":t[3]||(t[3]=e=>a.showRequirementPicker=e),position:"bottom",round:"",style:{height:"50%"}},{default:(0,n.k6)((()=>[(0,n.bF)(p,{title:"选择关联需求",columns:s.requirementOptions,onConfirm:s.onRequirementConfirm,onCancel:t[2]||(t[2]=e=>a.showRequirementPicker=!1),"show-toolbar":""},null,8,["columns","onConfirm"])])),_:1},8,["show"]),a.loading?((0,n.uX)(),(0,n.Wv)(h,{key:0,vertical:"",class:"loading-overlay"},{default:(0,n.k6)((()=>t[6]||(t[6]=[(0,n.eW)("加载中...")]))),_:1})):(0,n.Q3)("",!0)])])}i(1701);var At={name:"NewResultPage",components:{HeaderBar:S},data(){return{title:"",description:"",relatedRequirementId:this.$route.query.requirementId||"",submitting:!1,loading:!1,showRequirementPicker:!1,requirements:[],selectedRequirementId:"",selectedRequirementTitle:"无关联需求",editor:null,descriptionError:!1}},computed:{requirementOptions(){const e=[{text:"无关联需求",value:null}];return e.concat(this.requirements.map((e=>({text:e.title,value:e.id}))))}},mounted(){this.initEditor(),this.fetchRequirements(),this.relatedRequirementId&&this.fetchRequirementDetails(this.relatedRequirementId)},beforeUnmount(){this.editor&&(this.editor.destroy(),this.editor=null)},methods:{initEditor(){this.editor=new(at())(this.$refs.editor),this.editor.config.placeholder="请输入结果详细描述",this.editor.config.zIndex=100,this.editor.config.menus=["bold","italic","underline","head","fontSize","fontName","strikeThrough","foreColor","backColor","link","list","justify","quote","emoticon","undo","redo"],window.innerWidth<768&&(this.editor.config.menus=["bold","head","fontSize","list","justify","emoticon","undo","redo"]),this.editor.config.height=250,this.editor.create()},validateDescription(){const e=this.editor.txt.html();return e&&"<p><br></p>"!==e?(this.descriptionError=!1,this.description=e,!0):(this.descriptionError=!0,!1)},async fetchRequirementDetails(e){this.loading=!0;try{const t=await v.requirements.getById(e);this.selectedRequirementTitle=t.data.title,this.selectedRequirementId=e}catch(t){console.error("Error fetching requirement details:",t),(0,x.xr)("获取需求详情失败")}finally{this.loading=!1}},async fetchRequirements(){this.loading=!0;try{const e=await v.requirements.getAll();this.requirements=e.data}catch(e){console.error("Error fetching requirements:",e),(0,x.xr)("获取需求列表失败")}finally{this.loading=!1}},onRequirementConfirm(e){this.selectedRequirementId=e.value,this.selectedRequirementTitle=e.value?e.text:"无关联需求",this.showRequirementPicker=!1},async onSubmit(){if(this.validateDescription()){this.submitting=!0;try{const e={title:this.title,description:this.description,relatedRequirementId:this.relatedRequirementId||this.selectedRequirementId||null};await v.results.create(e),(0,x.GF)("结果创建成功"),this.relatedRequirementId?setTimeout((()=>{this.$router.push(`/results/requirement/${this.relatedRequirementId}`)}),1e3):setTimeout((()=>{this.$router.push("/results")}),1e3)}catch(e){console.error("Error creating result:",e),(0,x.xr)("创建结果失败: "+(e.response?.data?.error||"未知错误"))}finally{this.submitting=!1}}}}};const Lt=(0,l.A)(At,[["render",Ct],["__scopeId","data-v-3f0fc5c6"]]);var It=Lt;const Tt={class:"page"},St={class:"page-content"},Ft={class:"rich-text-wrapper"},Pt={ref:"editor",class:"rich-text-editor"},Dt={key:0,class:"error-message"},_t={style:{margin:"16px"}};function xt(e,t,i,r,a,s){const o=(0,n.g2)("header-bar"),l=(0,n.g2)("van-loading"),u=(0,n.g2)("van-field"),c=(0,n.g2)("van-dropdown-item"),d=(0,n.g2)("van-dropdown-menu"),p=(0,n.g2)("van-cell-group"),m=(0,n.g2)("van-button"),h=(0,n.g2)("van-form"),g=(0,n.g2)("van-picker"),v=(0,n.g2)("van-popup");return(0,n.uX)(),(0,n.CE)("div",Tt,[(0,n.bF)(o,{title:"编辑结果"}),(0,n.Lk)("div",St,[a.loading?((0,n.uX)(),(0,n.Wv)(l,{key:0,vertical:"",class:"loading-overlay"},{default:(0,n.k6)((()=>t[5]||(t[5]=[(0,n.eW)("加载中...")]))),_:1})):((0,n.uX)(),(0,n.Wv)(h,{key:1,onSubmit:s.onSubmit},{default:(0,n.k6)((()=>[(0,n.bF)(p,{inset:""},{default:(0,n.k6)((()=>[(0,n.bF)(u,{modelValue:a.title,"onUpdate:modelValue":t[0]||(t[0]=e=>a.title=e),name:"title",label:"结果标题",placeholder:"请输入结果标题",rules:[{required:!0,message:"请填写结果标题"}]},null,8,["modelValue"]),(0,n.Lk)("div",Ft,[t[6]||(t[6]=(0,n.Lk)("div",{class:"field-label"},"结果描述",-1)),(0,n.Lk)("div",Pt,null,512),a.descriptionError?((0,n.uX)(),(0,n.CE)("div",Dt,"请填写结果描述")):(0,n.Q3)("",!0)]),(0,n.bF)(u,{name:"status",label:"状态",readonly:""},{input:(0,n.k6)((()=>[(0,n.bF)(d,null,{default:(0,n.k6)((()=>[(0,n.bF)(c,{modelValue:a.status,"onUpdate:modelValue":t[1]||(t[1]=e=>a.status=e),options:a.statusOptions},null,8,["modelValue","options"])])),_:1})])),_:1}),s.requirementOptions.length>0?((0,n.uX)(),(0,n.Wv)(u,{key:0,readonly:"",name:"relatedRequirement",label:"关联需求",value:a.selectedRequirementTitle,"right-icon":"arrow-down",onClick:t[2]||(t[2]=e=>a.showRequirementPicker=!0)},null,8,["value"])):(0,n.Q3)("",!0)])),_:1}),(0,n.Lk)("div",_t,[(0,n.bF)(m,{round:"",block:"",type:"primary","native-type":"submit",loading:a.submitting,disabled:a.submitting},{default:(0,n.k6)((()=>t[7]||(t[7]=[(0,n.eW)(" 保存 ")]))),_:1},8,["loading","disabled"])])])),_:1},8,["onSubmit"])),(0,n.bF)(v,{show:a.showRequirementPicker,"onUpdate:show":t[4]||(t[4]=e=>a.showRequirementPicker=e),position:"bottom",round:"",style:{height:"50%"}},{default:(0,n.k6)((()=>[(0,n.bF)(g,{title:"选择关联需求",columns:s.requirementOptions,onConfirm:s.onRequirementConfirm,onCancel:t[3]||(t[3]=e=>a.showRequirementPicker=!1),"show-toolbar":""},null,8,["columns","onConfirm"])])),_:1},8,["show"])])])}var Wt={name:"EditResultPage",components:{HeaderBar:S},props:{id:{type:String,required:!0}},data(){return{title:"",description:"",status:"",relatedRequirementId:null,loading:!0,submitting:!1,showRequirementPicker:!1,requirements:[],selectedRequirementTitle:"无关联需求",editor:null,descriptionError:!1,statusOptions:[{text:"草稿",value:"DRAFT"},{text:"已完成",value:"COMPLETED"},{text:"已归档",value:"ARCHIVED"},{text:"已拒绝",value:"REJECTED"}]}},computed:{requirementOptions(){const e=[{text:"无关联需求",value:null}];return e.concat(this.requirements.map((e=>({text:e.title,value:e.id}))))}},mounted(){this.fetchResultDetail(),this.fetchRequirements()},beforeUnmount(){this.editor&&(this.editor.destroy(),this.editor=null)},methods:{async fetchResultDetail(){try{const e=await v.results.getById(this.id),t=e.data;this.title=t.title,this.description=t.description,this.status=t.status,this.relatedRequirementId=t.relatedRequirementId,this.relatedRequirementId&&this.fetchRelatedRequirementTitle(),this.loading=!1,this.$nextTick((()=>{this.initEditor()}))}catch(e){console.error("Error fetching result:",e),(0,x.xr)("获取结果详情失败"),this.$router.push(`/result/${this.id}`)}},async fetchRelatedRequirementTitle(){if(this.relatedRequirementId)try{const e=await v.requirements.getById(this.relatedRequirementId);this.selectedRequirementTitle=e.data.title}catch(e){console.error("Error fetching related requirement title:",e),this.selectedRequirementTitle="未能获取需求标题"}},async fetchRequirements(){try{const e=await v.requirements.getAll();this.requirements=e.data}catch(e){console.error("Error fetching requirements:",e)}},initEditor(){this.editor=new(at())(this.$refs.editor),this.editor.config.placeholder="请输入结果详细描述",this.editor.config.zIndex=100,this.editor.config.menus=["bold","italic","underline","head","fontSize","fontName","strikeThrough","foreColor","backColor","link","list","justify","quote","emoticon","undo","redo"],window.innerWidth<768&&(this.editor.config.menus=["bold","head","fontSize","list","justify","emoticon","undo","redo"]),this.editor.config.height=250,this.editor.create(),this.editor.txt.html(this.description)},validateDescription(){const e=this.editor.txt.html();return e&&"<p><br></p>"!==e?(this.descriptionError=!1,this.description=e,!0):(this.descriptionError=!0,!1)},onRequirementConfirm(e){this.relatedRequirementId=e.value,this.selectedRequirementTitle=e.value?e.text:"无关联需求",this.showRequirementPicker=!1},async onSubmit(){if(this.validateDescription()){this.submitting=!0;try{const e={title:this.title,description:this.description,status:this.status,relatedRequirementId:this.relatedRequirementId};await v.results.update(this.id,e),(0,x.GF)("结果更新成功"),setTimeout((()=>{this.$router.push(`/result/${this.id}`)}),1e3)}catch(e){console.error("Error updating result:",e),(0,x.xr)("更新结果失败: "+(e.response?.data?.error||"未知错误"))}finally{this.submitting=!1}}}}};const Xt=(0,l.A)(Wt,[["render",xt],["__scopeId","data-v-62c42f32"]]);var $t=Xt;const Nt={class:"page"},Bt={class:"page-content"},Ot={class:"requirement-info"};function Mt(e,t,i,r,a,s){const o=(0,n.g2)("header-bar"),l=(0,n.g2)("van-loading"),u=(0,n.g2)("van-empty"),c=(0,n.g2)("van-tag"),d=(0,n.g2)("van-cell"),p=(0,n.g2)("van-cell-group");return(0,n.uX)(),(0,n.CE)("div",Nt,[(0,n.bF)(o,{title:"相关结果","right-text":"添加结果",onRightClick:s.goToNewResult},null,8,["onRightClick"]),(0,n.Lk)("div",Bt,[a.loading?((0,n.uX)(),(0,n.Wv)(l,{key:0,vertical:"",class:"loading-overlay"},{default:(0,n.k6)((()=>t[0]||(t[0]=[(0,n.eW)("加载中...")]))),_:1})):((0,n.uX)(),(0,n.CE)(n.FK,{key:1},[(0,n.Lk)("div",Ot,[(0,n.Lk)("h3",null,"需求: "+(0,E.v_)(a.requirementTitle),1)]),0===a.resultsList.length?((0,n.uX)(),(0,n.Wv)(u,{key:0,description:"暂无相关结果数据"})):((0,n.uX)(),(0,n.Wv)(p,{key:1,class:"list-container"},{default:(0,n.k6)((()=>[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(a.resultsList,(e=>((0,n.uX)(),(0,n.Wv)(d,{key:e.id,title:e.title,"is-link":"",onClick:t=>s.goToResultDetail(e.id),class:"list-item"},{"right-icon":(0,n.k6)((()=>[(0,n.bF)(c,{type:s.getStatusType(e.status),class:"custom-tag",round:""},{default:(0,n.k6)((()=>[(0,n.eW)((0,E.v_)(s.getStatusText(e.status)),1)])),_:2},1032,["type"])])),_:2},1032,["title","onClick"])))),128))])),_:1}))],64))])])}var Vt={name:"ResultsByRequirementPage",components:{HeaderBar:S},props:{requirementId:{type:String,required:!0}},data(){return{resultsList:[],requirementTitle:"",loading:!0}},created(){this.fetchRequirementData(),this.fetchResultsData()},methods:{async fetchRequirementData(){try{const e=await v.requirements.getById(this.requirementId);this.requirementTitle=e.data.title}catch(e){console.error("Error fetching requirement data:",e),this.requirementTitle="未知需求"}},async fetchResultsData(){try{const e=await v.results.getByRequirement(this.requirementId);this.resultsList=e.data}catch(e){console.error("Error fetching results data:",e),(0,x.xr)("获取结果数据失败")}finally{this.loading=!1}},goToResultDetail(e){this.$router.push(`/result/${e}`)},goToNewResult(){this.$router.push(`/result/new?requirementId=${this.requirementId}`)},getStatusText(e){const t={DRAFT:"草稿",COMPLETED:"已完成",ARCHIVED:"已归档",REJECTED:"已拒绝"};return t[e]||"未知状态"},getStatusType(e){const t={DRAFT:"primary",COMPLETED:"success",ARCHIVED:"warning",REJECTED:"danger"};return t[e]||"default"}}};const Ut=(0,l.A)(Vt,[["render",Mt],["__scopeId","data-v-71bcea11"]]);var jt=Ut;const zt={class:"page"},Gt={class:"page-content"},Ht={style:{margin:"16px"}},Jt={key:0,class:"biometric-login"},Kt={class:"form-footer"};function Qt(e,t,i,r,a,s){const o=(0,n.g2)("header-bar"),l=(0,n.g2)("van-field"),u=(0,n.g2)("van-cell-group"),c=(0,n.g2)("van-button"),d=(0,n.g2)("van-form"),p=(0,n.g2)("van-icon"),m=(0,n.g2)("router-link");return(0,n.uX)(),(0,n.CE)("div",zt,[(0,n.bF)(o,{title:"登录","show-back":!1}),(0,n.Lk)("div",Gt,[t[6]||(t[6]=(0,n.Lk)("div",{class:"logo-container"},[(0,n.Lk)("h2",{class:"small-seal-font"},"生命树")],-1)),(0,n.bF)(d,{onSubmit:r.onSubmit},{default:(0,n.k6)((()=>[(0,n.bF)(u,{inset:""},{default:(0,n.k6)((()=>[(0,n.bF)(l,{modelValue:r.email,"onUpdate:modelValue":t[0]||(t[0]=e=>r.email=e),name:"email",label:"邮箱",placeholder:"请输入邮箱",rules:[{required:!0,message:"请填写邮箱"},{pattern:r.emailPattern,message:"请输入有效的邮箱地址"}]},null,8,["modelValue","rules"]),(0,n.bF)(l,{modelValue:r.password,"onUpdate:modelValue":t[1]||(t[1]=e=>r.password=e),type:"password",name:"password",label:"密码",placeholder:"请输入密码",rules:[{required:!0,message:"请填写密码"}]},null,8,["modelValue"])])),_:1}),(0,n.Lk)("div",Ht,[(0,n.bF)(c,{round:"",block:"",type:"primary","native-type":"submit",loading:r.loading,disabled:r.loading},{default:(0,n.k6)((()=>t[2]||(t[2]=[(0,n.eW)(" 登录 ")]))),_:1},8,["loading","disabled"])])])),_:1},8,["onSubmit"]),r.biometricsAvailable?((0,n.uX)(),(0,n.CE)("div",Jt,[(0,n.bF)(c,{round:"",block:"",type:"default",onClick:r.loginWithBiometrics,disabled:r.loading},{icon:(0,n.k6)((()=>[(0,n.bF)(p,{name:"scan",size:"20"})])),default:(0,n.k6)((()=>[t[3]||(t[3]=(0,n.eW)(" 使用生物识别登录 "))])),_:1},8,["onClick","disabled"])])):(0,n.Q3)("",!0),(0,n.Lk)("div",Kt,[(0,n.Lk)("p",null,[t[5]||(t[5]=(0,n.eW)("还没有账号？ ")),(0,n.bF)(m,{to:"/register"},{default:(0,n.k6)((()=>t[4]||(t[4]=[(0,n.eW)("立即注册")]))),_:1})])])])])}var Zt={name:"LoginPage",components:{HeaderBar:S},setup(){const e=(0,p.KR)(""),t=(0,p.KR)(""),r=(0,p.KR)(!1),a=(0,p.KR)(!1),s=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,o=()=>"undefined"!==typeof window&&window.Capacitor&&window.Capacitor.isNativePlatform(),l=async()=>{try{if(!o())return console.log("非原生环境，生物识别不可用"),!1;const{NativeBiometric:t}=await i.e(926).then(i.bind(i,4926)),r=await t.isAvailable();if(console.log("生物识别可用性检查结果:",r),!r.isAvailable)return console.log("设备不支持生物识别"),!1;try{const e=await t.getCredentials({server:"lifetree-app"});return console.log("生物识别凭据检查:",e?"找到凭据":"未找到凭据"),Boolean(e&&e.username&&e.password)}catch(e){return console.error("获取生物识别凭据失败:",e),!1}}catch(t){return console.error("检查生物识别可用性失败:",t),!1}},u=async()=>{r.value=!0;try{if(!o())throw new Error("非原生环境，无法使用生物识别");const{NativeBiometric:e}=await i.e(926).then(i.bind(i,4926)),t=await e.isAvailable();if(console.log("生物识别可用性检查:",t),!t.isAvailable)throw new Error("设备不支持生物识别");console.log("开始生物识别验证..."),await e.verifyIdentity({reason:"登录到生命树应用",title:"生物识别验证",subtitle:"请使用Face ID进行验证",description:"这将允许您快速安全地登录"}),console.log("生物识别验证成功"),console.log("尝试获取存储的凭据...");const r=await e.getCredentials({server:"lifetree-app"});if(console.log("获取到凭据:",r?"成功":"失败"),!r||!r.username||!r.password)throw new Error("未找到有效的生物识别凭据");console.log("使用凭据尝试登录...");const n=await v.auth.login({email:r.username,password:r.password});if(!n||!n.data)throw new Error("登录响应无效");{const{user:e,token:t}=n.data;localStorage.setItem("user",JSON.stringify(e)),localStorage.setItem("token",t),q.state.user=e,q.state.token=t,q.state.isAuthenticated=!0,(0,x.P0)({message:"生物识别登录成功",type:"success"});const i=sessionStorage.getItem("redirectPath")||"/";sessionStorage.removeItem("redirectPath"),setTimeout((()=>{window.location.href=i}),1e3)}}catch(e){console.error("生物识别登录详细错误:",e),(0,x.xr)("生物识别登录失败: "+(e.message||"请使用账号密码登录")),t.value=""}finally{r.value=!1}},c=async e=>{r.value=!0;try{console.log("开始常规登录...");const r=await v.auth.login({email:e.email,password:e.password});if(console.log("登录响应:",r?"成功":"失败"),!r||!r.data)throw new Error("登录响应无效");const{user:n,token:s}=r.data;localStorage.setItem("user",JSON.stringify(n)),localStorage.setItem("token",s),q.state.user=n,q.state.token=s,q.state.isAuthenticated=!0;try{if(o()){const{NativeBiometric:t}=await i.e(926).then(i.bind(i,4926));console.log("尝试保存生物识别凭据..."),await t.setCredentials({username:e.email,password:e.password,server:"lifetree-app"}),console.log("生物识别凭据保存成功"),a.value=!0}}catch(t){console.error("保存生物识别凭据失败:",t)}(0,x.P0)({message:"登录成功",type:"success"});const l=sessionStorage.getItem("redirectPath")||"/";sessionStorage.removeItem("redirectPath"),setTimeout((()=>{window.location.href=l}),1e3)}catch(t){console.error("登录失败详细错误:",t);const e=t.response?.data?.error||"登录失败，请检查您的凭据";(0,x.xr)(e)}finally{r.value=!1}},d=async()=>{try{const e=await fetch(v.baseURL+"/health");console.log("API连接测试结果:",e.status),e.ok?console.log("API连接成功"):console.log("API连接失败")}catch(e){console.error("API连接测试错误:",e)}};return(0,n.sV)((async()=>{console.log("Login组件已挂载"),console.log("检查平台:",o()?"原生平台":"浏览器"),await d();const e=await l();console.log("生物识别可用性:",e),a.value=e})),{email:e,password:t,loading:r,emailPattern:s,biometricsAvailable:a,onSubmit:c,loginWithBiometrics:u}}};const Yt=(0,l.A)(Zt,[["render",Qt],["__scopeId","data-v-2dde4192"]]);var ei=Yt;const ti={class:"page"},ii={class:"page-content"},ri={style:{margin:"16px"}},ni={class:"form-footer"};function ai(e,t,i,r,a,s){const o=(0,n.g2)("header-bar"),l=(0,n.g2)("van-field"),u=(0,n.g2)("van-cell-group"),c=(0,n.g2)("van-button"),d=(0,n.g2)("van-form"),p=(0,n.g2)("router-link");return(0,n.uX)(),(0,n.CE)("div",ti,[(0,n.bF)(o,{title:"注册"}),(0,n.Lk)("div",ii,[t[7]||(t[7]=(0,n.Lk)("div",{class:"logo-container"},[(0,n.Lk)("h2",{class:"small-seal-font"},"生命树")],-1)),(0,n.bF)(d,{onSubmit:r.onSubmit},{default:(0,n.k6)((()=>[(0,n.bF)(u,{inset:""},{default:(0,n.k6)((()=>[(0,n.bF)(l,{modelValue:r.email,"onUpdate:modelValue":t[0]||(t[0]=e=>r.email=e),name:"email",label:"邮箱",placeholder:"请输入邮箱",rules:[{required:!0,message:"请填写邮箱"},{pattern:r.emailPattern,message:"请输入有效的邮箱地址"}]},null,8,["modelValue","rules"]),(0,n.bF)(l,{modelValue:r.name,"onUpdate:modelValue":t[1]||(t[1]=e=>r.name=e),name:"name",label:"用户名",placeholder:"请输入用户名",rules:[{required:!0,message:"请填写用户名"}]},null,8,["modelValue"]),(0,n.bF)(l,{modelValue:r.password,"onUpdate:modelValue":t[2]||(t[2]=e=>r.password=e),type:"password",name:"password",label:"密码",placeholder:"请输入密码",rules:[{required:!0,message:"请填写密码"},{pattern:r.passwordPattern,message:"密码至少6位，包含字母和数字"}]},null,8,["modelValue","rules"]),(0,n.bF)(l,{modelValue:r.confirmPassword,"onUpdate:modelValue":t[3]||(t[3]=e=>r.confirmPassword=e),type:"password",name:"confirmPassword",label:"确认密码",placeholder:"请再次输入密码",rules:[{required:!0,message:"请再次输入密码"},{validator:r.validatePasswordConfirmation,message:"两次输入的密码不一致"}]},null,8,["modelValue","rules"])])),_:1}),(0,n.Lk)("div",ri,[(0,n.bF)(c,{round:"",block:"",type:"primary","native-type":"submit",loading:r.loading,disabled:r.loading},{default:(0,n.k6)((()=>t[4]||(t[4]=[(0,n.eW)(" 注册 ")]))),_:1},8,["loading","disabled"])])])),_:1},8,["onSubmit"]),(0,n.Lk)("div",ni,[(0,n.Lk)("p",null,[t[6]||(t[6]=(0,n.eW)("已有账号？ ")),(0,n.bF)(p,{to:"/login"},{default:(0,n.k6)((()=>t[5]||(t[5]=[(0,n.eW)("立即登录")]))),_:1})])])])])}var si={name:"RegisterPage",components:{HeaderBar:S},setup(){const e=(0,d.rd)(),t=(0,p.KR)(""),i=(0,p.KR)(""),r=(0,p.KR)(""),n=(0,p.KR)(""),a=(0,p.KR)(!1),s=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,o=/^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]{6,}$/,l=e=>e===r.value,u=async t=>{a.value=!0;try{await q.register({email:t.email,name:t.name,password:t.password}),(0,x.P0)({message:"注册成功，请登录",type:"success"}),setTimeout((()=>{e.push("/login")}),1e3)}catch(i){const e=i.response?.data?.error||"注册失败，请重试";(0,x.xr)(e)}finally{a.value=!1}};return{email:t,name:i,password:r,confirmPassword:n,loading:a,emailPattern:s,passwordPattern:o,validatePasswordConfirmation:l,onSubmit:u}}};const oi=(0,l.A)(si,[["render",ai],["__scopeId","data-v-5c542bcc"]]);var li=oi;const ui=[{path:"/",name:"Home",component:O},{path:"/requirements",name:"Requirements",component:G,meta:{requiresAuth:!0}},{path:"/results",name:"Results",component:Y,meta:{requiresAuth:!0}},{path:"/profile",name:"Profile",component:ce,meta:{requiresAuth:!0}},{path:"/requirement/:id",name:"RequirementDetail",component:Ae,props:!0,meta:{requiresAuth:!0}},{path:"/requirement/edit/:id",name:"EditRequirement",component:yt,props:!0,meta:{requiresAuth:!0}},{path:"/result/:id",name:"ResultDetail",component:Xe,props:!0,meta:{requiresAuth:!0}},{path:"/result/edit/:id",name:"EditResult",component:$t,props:!0,meta:{requiresAuth:!0}},{path:"/results/requirement/:requirementId",name:"ResultsByRequirement",component:jt,props:!0,meta:{requiresAuth:!0}},{path:"/agreement",name:"Agreement",component:Ke},{path:"/requirement/new",name:"NewRequirement",component:lt,meta:{requiresAuth:!0}},{path:"/result/new",name:"NewResult",component:It,meta:{requiresAuth:!0}},{path:"/login",name:"Login",component:ei,meta:{guest:!0}},{path:"/register",name:"Register",component:li,meta:{guest:!0}},{path:"/:pathMatch(.*)*",redirect:"/"}],ci=(0,d.aE)({history:(0,d.Bt)(),routes:ui});ci.beforeEach(((e,t,i)=>{e.matched.some((e=>e.meta.requiresAuth))?q.state.isAuthenticated?i():(sessionStorage.setItem("redirectPath",e.fullPath),i({path:"/login"})):e.matched.some((e=>e.meta.guest))&&q.state.isAuthenticated?i({path:"/"}):i()}));var di=ci,pi=i(4296),mi=i(8728),hi=i(7648),gi=i(828),vi=i(55),fi=i(786),yi=i(7363),ki=i(9472),bi=i(3623),qi=i(7515),wi=i(2352),Ri=i(9056),Ei=i(5802),Ci=i(4025),Ai=i(3429),Li=i(4743),Ii=i(1824),Ti=i(5746),Si=i(5116),Fi=i(6767),Pi=i(8427),Di=i(5399);i(2241);const _i=(0,r.Ef)(c);_i.use(di),_i.use(pi.$n),_i.use(mi.HF),_i.use(hi.gq),_i.use(gi.fh),_i.use(vi.Qh),_i.use(fi.jq),_i.use(yi.In),_i.use(ki.lV),_i.use(bi.D0),_i.use(qi.y8),_i.use(wi.lG),_i.use(Ri.M9),_i.use(Ei.vw),_i.use(Ci.Rh),_i.use(Ai.Ee),_i.use(Li.j5),_i.use(Ii.B8),_i.use(Ti.Sv),_i.use(Si.zD),_i.use(Fi.LC),_i.use(Pi.rI),_i.use(Di.tJ),_i.config.globalProperties.$axios=m.A,_i.mount("#app")}},t={};function i(r){var n=t[r];if(void 0!==n)return n.exports;var a=t[r]={exports:{}};return e[r].call(a.exports,a,a.exports,i),a.exports}i.m=e,function(){var e=[];i.O=function(t,r,n,a){if(!r){var s=1/0;for(c=0;c<e.length;c++){r=e[c][0],n=e[c][1],a=e[c][2];for(var o=!0,l=0;l<r.length;l++)(!1&a||s>=a)&&Object.keys(i.O).every((function(e){return i.O[e](r[l])}))?r.splice(l--,1):(o=!1,a<s&&(s=a));if(o){e.splice(c--,1);var u=n();void 0!==u&&(t=u)}}return t}a=a||0;for(var c=e.length;c>0&&e[c-1][2]>a;c--)e[c]=e[c-1];e[c]=[r,n,a]}}(),function(){i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,{a:t}),t}}(),function(){i.d=function(e,t){for(var r in t)i.o(t,r)&&!i.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}}(),function(){i.f={},i.e=function(e){return Promise.all(Object.keys(i.f).reduce((function(t,r){return i.f[r](e,t),t}),[]))}}(),function(){i.u=function(e){return"js/"+e+"."+{542:"d1a1cfef",926:"6f28a985"}[e]+".js"}}(),function(){i.miniCssF=function(e){}}(),function(){i.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={},t="mobile-app:";i.l=function(r,n,a,s){if(e[r])e[r].push(n);else{var o,l;if(void 0!==a)for(var u=document.getElementsByTagName("script"),c=0;c<u.length;c++){var d=u[c];if(d.getAttribute("src")==r||d.getAttribute("data-webpack")==t+a){o=d;break}}o||(l=!0,o=document.createElement("script"),o.charset="utf-8",o.timeout=120,i.nc&&o.setAttribute("nonce",i.nc),o.setAttribute("data-webpack",t+a),o.src=r),e[r]=[n];var p=function(t,i){o.onerror=o.onload=null,clearTimeout(m);var n=e[r];if(delete e[r],o.parentNode&&o.parentNode.removeChild(o),n&&n.forEach((function(e){return e(i)})),t)return t(i)},m=setTimeout(p.bind(null,void 0,{type:"timeout",target:o}),12e4);o.onerror=p.bind(null,o.onerror),o.onload=p.bind(null,o.onload),l&&document.head.appendChild(o)}}}(),function(){i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){i.p="/lifetree/"}(),function(){var e={524:0};i.f.j=function(t,r){var n=i.o(e,t)?e[t]:void 0;if(0!==n)if(n)r.push(n[2]);else{var a=new Promise((function(i,r){n=e[t]=[i,r]}));r.push(n[2]=a);var s=i.p+i.u(t),o=new Error,l=function(r){if(i.o(e,t)&&(n=e[t],0!==n&&(e[t]=void 0),n)){var a=r&&("load"===r.type?"missing":r.type),s=r&&r.target&&r.target.src;o.message="Loading chunk "+t+" failed.\n("+a+": "+s+")",o.name="ChunkLoadError",o.type=a,o.request=s,n[1](o)}};i.l(s,l,"chunk-"+t,t)}},i.O.j=function(t){return 0===e[t]};var t=function(t,r){var n,a,s=r[0],o=r[1],l=r[2],u=0;if(s.some((function(t){return 0!==e[t]}))){for(n in o)i.o(o,n)&&(i.m[n]=o[n]);if(l)var c=l(i)}for(t&&t(r);u<s.length;u++)a=s[u],i.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return i.O(c)},r=self["webpackChunkmobile_app"]=self["webpackChunkmobile_app"]||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))}();var r=i.O(void 0,[504],(function(){return i(2928)}));r=i.O(r)})();