(function(){"use strict";var e={2105:function(e,t,i){var n=i(3751),r=i(641);const s={id:"app"};function a(e,t,i,n,a,o){const l=(0,r.g2)("router-view");return(0,r.uX)(),(0,r.CE)("div",s,[(0,r.bF)(l)])}var o={name:"App"},l=i(6262);const u=(0,l.A)(o,[["render",a]]);var d=u,c=(i(8111),i(3579),i(5220)),m=(i(4114),i(953)),p=i(4335);const h=p.A.create({baseURL:"https://api.u252116.nyat.app:44058/api",timeout:1e4,headers:{"Content-Type":"application/json"}});h.interceptors.request.use((e=>{const t=localStorage.getItem("token");return t&&(e.headers["Authorization"]=`Bearer ${t}`),e}),(e=>Promise.reject(e))),h.interceptors.response.use((e=>e),(e=>{if(e.response)switch(e.response.status){case 401:localStorage.removeItem("token"),localStorage.removeItem("user"),location.reload();break;case 403:console.error("没有权限访问该资源");break;case 404:console.error("请求的资源不存在");break;case 500:console.error("服务器错误");break;default:console.error("未知错误")}return Promise.reject(e)}));const g={auth:{register:e=>h.post("/auth/register",e),login:e=>h.post("/auth/login",e)},user:{getCurrentUser:()=>h.get("/users/me"),updateUser:e=>h.put("/users/me",e),getAllUsers:()=>h.get("/admin/users")},requirements:{getAll:()=>h.get("/requirements"),getById:e=>h.get(`/requirements/${e}`),create:e=>h.post("/requirements",e),update:(e,t)=>h.put(`/requirements/${e}`,t),updateAgreement:(e,t,i=null)=>h.put(`/requirements/${e}/agreement`,{agreement:t,agreementButtonText:i}),delete:e=>h.delete(`/requirements/${e}`),getMyRequirementsWithApplications:()=>h.get("/requirements/my-requirements"),getMyApplications:()=>h.get("/requirements/my-applications"),getApplicationsByRequirement:e=>h.get(`/requirements/${e}/applications`),acceptRequirement:e=>h.post(`/requirements/${e}/accept`),approveApplication:(e,t)=>h.post(`/requirements/${e}/applications/${t}/approve`),rejectApplication:(e,t)=>h.post(`/requirements/${e}/applications/${t}/reject`)},results:{getAll:()=>h.get("/results"),getById:e=>h.get(`/results/${e}`),getByUser:e=>h.get(`/results/user/${e}`),getByRequirement:e=>h.get(`/results/requirement/${e}`),create:e=>h.post("/results",e),update:(e,t)=>h.put(`/results/${e}`,t),delete:e=>h.delete(`/results/${e}`)}};var v=g;const f=()=>{const e=localStorage.getItem("user");return e?JSON.parse(e):null},k=()=>localStorage.getItem("token"),y=(0,m.Kh)({user:f(),token:k(),isAuthenticated:!!k(),error:null,loading:!1}),b={isPlatformSupported(){return"undefined"!==typeof window&&window.Capacitor&&window.Capacitor.isNativePlatform()},async register(e){y.loading=!0,y.error=null;try{console.log("开始注册用户...");const t=await v.auth.register(e);return console.log("注册响应:",t?"成功":"失败"),t.data}catch(t){throw console.error("注册失败详细错误:",t),y.error=t.response?.data?.error||"注册失败，请重试",t}finally{y.loading=!1}},async login(e){y.loading=!0,y.error=null;try{console.log("开始登录...");const n=await v.auth.login(e);if(console.log("登录响应:",n?"成功":"失败"),!n||!n.data)throw new Error("登录响应无效");const{user:r,token:s}=n.data;if(localStorage.setItem("user",JSON.stringify(r)),localStorage.setItem("token",s),y.user=r,y.token=s,y.isAuthenticated=!0,this.isPlatformSupported())try{console.log("尝试保存生物识别凭据...");const{NativeBiometric:t}=await i.e(926).then(i.bind(i,4926));await t.setCredentials({username:e.email,password:e.password,server:"lifetree-app"}),console.log("生物识别凭据保存成功")}catch(t){console.error("保存生物识别凭据失败:",t)}return r}catch(t){throw console.error("登录失败详细错误:",t),t.response&&console.error("错误响应:",t.response.data),y.error=t.response?.data?.error||"登录失败，请检查您的凭据",t}finally{y.loading=!1}},async biometricLogin(){y.loading=!0,y.error=null;try{if(!this.isPlatformSupported())throw new Error("非原生环境，无法使用生物识别");console.log("开始生物识别登录...");const{NativeBiometric:e}=await i.e(926).then(i.bind(i,4926)),t=await e.isAvailable();if(console.log("生物识别可用性检查:",t),!t.isAvailable)throw new Error("设备不支持生物识别");console.log("开始生物识别验证..."),await e.verifyIdentity({reason:"登录到生命树应用",title:"生物识别验证",subtitle:"请使用Face ID或Touch ID进行验证",description:"这将允许您快速安全地登录"}),console.log("生物识别验证成功"),console.log("尝试获取存储的凭据...");const n=await e.getCredentials({server:"lifetree-app"});if(console.log("获取到凭据:",n?"成功":"失败"),!n||!n.username||!n.password)throw new Error("没有找到存储的生物识别凭据");console.log("使用凭据尝试登录...");const r=await v.auth.login({email:n.username,password:n.password});if(console.log("登录响应:",r?"成功":"失败"),!r||!r.data)throw new Error("登录响应无效");const{user:s,token:a}=r.data;return localStorage.setItem("user",JSON.stringify(s)),localStorage.setItem("token",a),y.user=s,y.token=a,y.isAuthenticated=!0,s}catch(e){throw console.error("生物识别登录详细错误:",e),y.error="生物识别登录失败: "+(e.message||"未知错误"),e}finally{y.loading=!1}},async logout(){console.log("执行注销..."),localStorage.removeItem("user"),localStorage.removeItem("token"),y.user=null,y.token=null,y.isAuthenticated=!1,console.log("注销完成"),nn.push("/login")},async getCurrentUser(){if(!y.token)return console.log("无访问令牌，无法获取用户信息"),null;y.loading=!0;try{console.log("开始获取当前用户信息...");const e=await v.user.getCurrentUser();console.log("获取用户信息响应:",e?"成功":"失败");const t=e.data;return localStorage.setItem("user",JSON.stringify(t)),y.user=t,t}catch(e){return console.error("获取用户信息失败:",e),e.response&&401===e.response.status&&(console.log("令牌已过期，执行注销"),await this.logout()),null}finally{y.loading=!1}},async updateUser(e){if(!y.isAuthenticated)return console.log("用户未认证，无法更新用户信息"),null;y.loading=!0;try{console.log("开始更新用户信息...");const t=await v.user.updateUser(e);console.log("更新用户信息响应:",t?"成功":"失败");const i=t.data;return localStorage.setItem("user",JSON.stringify(i)),y.user=i,i}catch(t){throw console.error("更新用户信息失败:",t),y.error=t.response?.data?.error||"更新用户信息失败",t}finally{y.loading=!1}},async isBiometricAvailable(){try{if(!this.isPlatformSupported())return console.log("非原生环境，生物识别不可用"),!1;console.log("检查生物识别可用性...");const{NativeBiometric:t}=await i.e(926).then(i.bind(i,4926)),n=await t.isAvailable();if(console.log("生物识别可用性检查结果:",n),n.isAvailable)try{console.log("检查存储的凭据...");const e=await t.getCredentials({server:"lifetree-app"});return console.log("存储的凭据检查结果:",e?"有凭据":"无凭据"),Boolean(e&&e.username&&e.password)}catch(e){return console.error("获取生物识别凭据失败:",e),!1}return!1}catch(e){return console.error("检查生物识别可用性失败:",e),!1}},async deleteBiometricCredentials(){try{if(!this.isPlatformSupported())return console.log("非原生环境，无法删除生物识别凭据"),!1;console.log("开始删除生物识别凭据...");const{NativeBiometric:e}=await i.e(926).then(i.bind(i,4926));return await e.deleteCredentials({server:"lifetree-app"}),console.log("删除生物识别凭据成功"),!0}catch(e){return console.error("删除生物识别凭据失败:",e),!1}}};var q={state:y,...b};const w={class:"page"};function E(e,t,i,n,s,a){const o=(0,r.g2)("header-bar"),l=(0,r.g2)("nav-bar");return(0,r.uX)(),(0,r.CE)("div",w,[(0,r.bF)(o,{title:"首页","show-back":!1}),t[0]||(t[0]=(0,r.Lk)("div",{class:"page-content home-content"},[(0,r.Lk)("div",{class:"welcome-section"},[(0,r.Lk)("h2",{class:"small-seal-font"},"生命树")])],-1)),(0,r.bF)(l)])}var A=i(33);const R={class:"header-bar"},C={class:"header-title"};function L(e,t,i,n,s,a){const o=(0,r.g2)("van-nav-bar");return(0,r.uX)(),(0,r.CE)("div",R,[(0,r.bF)(o,{"left-text":i.showBack?"返回":"","left-arrow":i.showBack,onClickLeft:a.onClickLeft,"right-text":i.rightText,onClickRight:a.onClickRight},{title:(0,r.k6)((()=>[(0,r.Lk)("span",C,(0,A.v_)(i.title),1)])),_:1},8,["left-text","left-arrow","onClickLeft","right-text","onClickRight"])])}var T={name:"HeaderBar",props:{title:{type:String,default:""},showBack:{type:Boolean,default:!0},rightText:{type:String,default:""}},methods:{onClickLeft(){this.showBack&&this.$router.back()},onClickRight(){this.$emit("right-click")}}};const F=(0,l.A)(T,[["render",L],["__scopeId","data-v-348dafc9"]]);var I=F;const x={class:"nav-bar"},S={class:"custom-icon"},_={class:"icon-circle"};function P(e,t,i,n,s,a){const o=(0,r.g2)("van-tabbar-item"),l=(0,r.g2)("van-icon"),u=(0,r.g2)("van-tabbar");return(0,r.uX)(),(0,r.CE)("div",x,[(0,r.bF)(u,{modelValue:s.active,"onUpdate:modelValue":t[10]||(t[10]=e=>s.active=e),route:""},{default:(0,r.k6)((()=>[(0,r.bF)(o,{to:"/results"},{icon:(0,r.k6)((()=>[(0,r.Lk)("div",{class:"custom-icon",onTouchstart:t[0]||(t[0]=e=>a.handleTouchStart("results")),onTouchend:t[1]||(t[1]=(...e)=>a.handleTouchEnd&&a.handleTouchEnd(...e)),onMousedown:t[2]||(t[2]=e=>a.handleMouseDown("results")),onMouseup:t[3]||(t[3]=(...e)=>a.handleMouseUp&&a.handleMouseUp(...e)),onMouseleave:t[4]||(t[4]=(...e)=>a.handleMouseUp&&a.handleMouseUp(...e))},t[11]||(t[11]=[(0,r.Lk)("div",{class:"icon-circle"},[(0,r.Lk)("img",{src:"https://b.yzcdn.cn/vant/light-theme.svg",alt:"太阳",class:"theme-icon"})],-1)]),32)])),_:1}),(0,r.bF)(o,{to:"/profile"},{icon:(0,r.k6)((()=>[(0,r.Lk)("div",S,[(0,r.Lk)("div",_,[(0,r.bF)(l,{name:"contact",size:"24"})])])])),_:1}),(0,r.bF)(o,{to:"/requirements"},{icon:(0,r.k6)((()=>[(0,r.Lk)("div",{class:"custom-icon",onTouchstart:t[5]||(t[5]=e=>a.handleTouchStart("requirements")),onTouchend:t[6]||(t[6]=(...e)=>a.handleTouchEnd&&a.handleTouchEnd(...e)),onMousedown:t[7]||(t[7]=e=>a.handleMouseDown("requirements")),onMouseup:t[8]||(t[8]=(...e)=>a.handleMouseUp&&a.handleMouseUp(...e)),onMouseleave:t[9]||(t[9]=(...e)=>a.handleMouseUp&&a.handleMouseUp(...e))},t[12]||(t[12]=[(0,r.Lk)("div",{class:"icon-circle"},[(0,r.Lk)("img",{src:"https://b.yzcdn.cn/vant/dark-theme.svg",alt:"月亮",class:"theme-icon"})],-1)]),32)])),_:1})])),_:1},8,["modelValue"])])}var D=i(3326),B={name:"NavBar",data(){return{active:0,longPressTimer:null,longPressDelay:800,currentIcon:null}},watch:{$route(e){"/requirements"===e.path?this.active=0:"/profile"===e.path?this.active=1:"/results"===e.path&&(this.active=2)}},created(){const e=this.$route.path;"/requirements"===e?this.active=0:"/profile"===e?this.active=1:"/results"===e?this.active=2:"/"===e&&(this.active=0)},methods:{handleTouchStart(e){this.currentIcon=e,this.longPressTimer&&clearTimeout(this.longPressTimer),this.longPressTimer=setTimeout((()=>{this.onLongPress(e)}),this.longPressDelay)},handleTouchEnd(){this.longPressTimer&&(clearTimeout(this.longPressTimer),this.longPressTimer=null),this.currentIcon=null},handleMouseDown(e){this.currentIcon=e,this.longPressTimer&&clearTimeout(this.longPressTimer),this.longPressTimer=setTimeout((()=>{this.onLongPress(e)}),this.longPressDelay)},handleMouseUp(){this.longPressTimer&&(clearTimeout(this.longPressTimer),this.longPressTimer=null),this.currentIcon=null},onLongPress(e){"requirements"===e?this.$router.push("/requirement/new"):"results"===e&&this.$router.push("/result/new"),(0,D.P0)({message:`正在前往${"requirements"===e?"新建需求":"新建结果"}页面...`,type:"success"})}}};const W=(0,l.A)(B,[["render",P],["__scopeId","data-v-779e60c8"]]);var $=W,X={name:"HomePage",components:{HeaderBar:I,NavBar:$}};const N=(0,l.A)(X,[["render",E],["__scopeId","data-v-158472a2"]]);var M=N;const O={class:"page"},V={class:"page-content"};function U(e,t,i,n,s,a){const o=(0,r.g2)("header-bar"),l=(0,r.g2)("van-empty"),u=(0,r.g2)("van-cell"),d=(0,r.g2)("van-cell-group"),c=(0,r.g2)("van-loading"),m=(0,r.g2)("nav-bar");return(0,r.uX)(),(0,r.CE)("div",O,[(0,r.bF)(o,{title:"需求列表","show-back":!1}),(0,r.Lk)("div",V,[s.loading||0!==s.requirementsList.length?((0,r.uX)(),(0,r.Wv)(d,{key:1,class:"list-container"},{default:(0,r.k6)((()=>[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(a.limitedRequirementsList,(e=>((0,r.uX)(),(0,r.Wv)(u,{key:e.id,title:e.title,"is-link":"",onClick:t=>a.goToDetail(e.id),class:"list-item"},null,8,["title","onClick"])))),128))])),_:1})):((0,r.uX)(),(0,r.Wv)(l,{key:0,description:"暂无需求数据"}))]),s.initialLoading?((0,r.uX)(),(0,r.Wv)(c,{key:0,vertical:"",class:"loading-overlay"},{default:(0,r.k6)((()=>t[0]||(t[0]=[(0,r.eW)("加载中...")]))),_:1})):(0,r.Q3)("",!0),(0,r.bF)(m)])}i(2489);var j={name:"Requirements",components:{HeaderBar:I,NavBar:$},data(){return{requirementsList:[],loading:!1,initialLoading:!0}},computed:{limitedRequirementsList(){const e=this.requirementsList.filter((e=>"CREATED"===e.status||"CONFIRMING"===e.status)),t=[...e].sort(((e,t)=>e.updatedAt&&t.updatedAt?new Date(t.updatedAt)-new Date(e.updatedAt):e.createdAt&&t.createdAt?new Date(t.createdAt)-new Date(e.createdAt):0));return t.slice(0,3)}},created(){this.fetchRequirements()},mounted(){window.addEventListener("focus",this.refreshOnFocus)},beforeUnmount(){window.removeEventListener("focus",this.refreshOnFocus)},methods:{async fetchRequirements(){try{this.initialLoading=!0;const e=await v.requirements.getAll();console.log(e),this.requirementsList=JSON.parse(JSON.stringify(e.data)),console.log("获取到的需求数据:",this.requirementsList)}catch(e){console.error("Error fetching requirements:",e),(0,D.xr)("获取需求列表失败")}finally{this.initialLoading=!1}},refreshOnFocus(){"/requirements"===this.$route.path&&this.fetchRequirements()},goToDetail(e){this.$router.push(`/requirement/${e}`)}}};const z=(0,l.A)(j,[["render",U],["__scopeId","data-v-53956121"]]);var H=z;const G={class:"page"},Q={class:"page-content"};function K(e,t,i,n,s,a){const o=(0,r.g2)("header-bar"),l=(0,r.g2)("van-empty"),u=(0,r.g2)("van-cell"),d=(0,r.g2)("van-cell-group"),c=(0,r.g2)("van-loading"),m=(0,r.g2)("nav-bar");return(0,r.uX)(),(0,r.CE)("div",G,[(0,r.bF)(o,{title:"结果列表","show-back":!1}),(0,r.Lk)("div",Q,[s.loading||0!==s.resultsList.length?((0,r.uX)(),(0,r.Wv)(d,{key:1,class:"list-container"},{default:(0,r.k6)((()=>[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(a.limitedResultsList,(e=>((0,r.uX)(),(0,r.Wv)(u,{key:e.id,title:e.title,"is-link":"",onClick:t=>a.goToDetail(e.id),class:"list-item"},null,8,["title","onClick"])))),128))])),_:1})):((0,r.uX)(),(0,r.Wv)(l,{key:0,description:"暂无结果数据"}))]),s.initialLoading?((0,r.uX)(),(0,r.Wv)(c,{key:0,vertical:"",class:"loading-overlay"},{default:(0,r.k6)((()=>t[0]||(t[0]=[(0,r.eW)("加载中...")]))),_:1})):(0,r.Q3)("",!0),(0,r.bF)(m)])}var J={name:"Results",components:{HeaderBar:I,NavBar:$},data(){return{resultsList:[],loading:!1,initialLoading:!0}},computed:{limitedResultsList(){return this.resultsList.slice(0,3)}},created(){this.fetchResults()},methods:{async fetchResults(){try{const e=await v.results.getAll();this.resultsList=e.data.sort(((e,t)=>new Date(t.createdAt)-new Date(e.createdAt))),this.initialLoading=!1}catch(e){console.error("Error fetching results:",e),(0,D.xr)("获取结果列表失败"),this.initialLoading=!1}},goToDetail(e){this.$router.push(`/result/${e}`)},getStatusText(e){const t={DRAFT:"草稿",COMPLETED:"已完成",ARCHIVED:"已归档",REJECTED:"已拒绝"};return t[e]||"未知状态"},getStatusType(e){const t={DRAFT:"primary",COMPLETED:"success",ARCHIVED:"warning",REJECTED:"danger"};return t[e]||"default"}}};const Z=(0,l.A)(J,[["render",K],["__scopeId","data-v-05c8b3ad"]]);var Y=Z;const ee={class:"page"},te={class:"page-content"},ie={class:"profile-avatar"},ne={class:"action-buttons logout-button"},re={class:"popup-header"},se={class:"applications-list"},ae={class:"application-actions"};function oe(e,t,i,s,a,o){const l=(0,r.g2)("header-bar"),u=(0,r.g2)("van-icon"),d=(0,r.g2)("van-cell"),c=(0,r.g2)("van-cell-group"),m=(0,r.g2)("van-button"),p=(0,r.g2)("van-list"),h=(0,r.g2)("van-tab"),g=(0,r.g2)("van-tag"),v=(0,r.g2)("van-tabs"),f=(0,r.g2)("van-loading"),k=(0,r.g2)("van-empty"),y=(0,r.g2)("van-popup"),b=(0,r.g2)("nav-bar");return(0,r.uX)(),(0,r.CE)("div",ee,[(0,r.bF)(l,{title:"个人信息","show-back":!1}),(0,r.Lk)("div",te,[(0,r.Lk)("div",ie,[(0,r.bF)(u,{name:"contact",size:"64"})]),(0,r.bF)(c,{inset:""},{default:(0,r.k6)((()=>[(0,r.bF)(d,{title:"用户名",value:a.user.name},null,8,["value"]),(0,r.bF)(d,{title:"邮箱",value:a.user.email},null,8,["value"])])),_:1}),(0,r.Lk)("div",ne,[(0,r.bF)(m,{type:"default",block:"",onClick:o.logout},{default:(0,r.k6)((()=>t[5]||(t[5]=[(0,r.eW)("退出登录")]))),_:1},8,["onClick"])]),(0,r.bF)(v,{active:a.activeTab,"onUpdate:active":t[2]||(t[2]=e=>a.activeTab=e),sticky:""},{default:(0,r.k6)((()=>[(0,r.bF)(h,{title:"我的需求"},{default:(0,r.k6)((()=>[t[6]||(t[6]=(0,r.Lk)("div",{class:"section-header my-requirements-header"},[(0,r.Lk)("div",{class:"section-title"},"我创建的需求")],-1)),(0,r.bF)(p,{loading:a.myRequirementsLoading,"onUpdate:loading":t[0]||(t[0]=e=>a.myRequirementsLoading=e),finished:a.myRequirementsFinished,"finished-text":"没有更多了",onLoad:o.loadMyRequirements},{default:(0,r.k6)((()=>[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(a.myRequirements,(e=>((0,r.uX)(),(0,r.Wv)(d,{key:e.id,title:e.title,label:o.getPendingApplicantsInfo(e),"is-link":"",onClick:t=>o.goToRequirementDetail(e.id)},(0,r.eX)({_:2},[e.pendingApplicationsCount>0?{name:"right-icon",fn:(0,r.k6)((()=>[(0,r.bF)(m,{size:"small",type:"primary",onClick:(0,n.D$)((t=>o.viewApplications(e.id)),["stop"])},{default:(0,r.k6)((()=>[(0,r.eW)(" 查看申请("+(0,A.v_)(e.pendingApplicationsCount)+") ",1)])),_:2},1032,["onClick"])])),key:"0"}:void 0]),1032,["title","label","onClick"])))),128))])),_:1},8,["loading","finished","onLoad"])])),_:1}),(0,r.bF)(h,{title:"我的申请"},{default:(0,r.k6)((()=>[t[7]||(t[7]=(0,r.Lk)("div",{class:"section-header my-applications-header"},[(0,r.Lk)("div",{class:"section-title"},"我申请的需求")],-1)),(0,r.bF)(p,{loading:a.pendingRequirementsLoading,"onUpdate:loading":t[1]||(t[1]=e=>a.pendingRequirementsLoading=e),finished:a.pendingRequirementsFinished,"finished-text":"没有更多了",onLoad:o.loadPendingRequirements},{default:(0,r.k6)((()=>[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(a.pendingRequirements,(e=>((0,r.uX)(),(0,r.Wv)(d,{key:e.id,title:e.title,"is-link":"",onClick:t=>o.goToRequirementDetail(e.id)},{"right-icon":(0,r.k6)((()=>[(0,r.bF)(g,{type:o.getApplicationStatusType(e.applicationStatus),class:"custom-tag",round:""},{default:(0,r.k6)((()=>[(0,r.eW)((0,A.v_)(o.getApplicationStatusText(e.applicationStatus)),1)])),_:2},1032,["type"])])),_:2},1032,["title","onClick"])))),128))])),_:1},8,["loading","finished","onLoad"])])),_:1})])),_:1},8,["active"])]),(0,r.bF)(y,{show:a.showApplicationsPopup,"onUpdate:show":t[4]||(t[4]=e=>a.showApplicationsPopup=e),position:"bottom",style:{height:"60%"},round:""},{default:(0,r.k6)((()=>[(0,r.Lk)("div",re,[t[8]||(t[8]=(0,r.Lk)("div",{class:"popup-title"},"申请列表",-1)),(0,r.bF)(u,{name:"cross",onClick:t[3]||(t[3]=e=>a.showApplicationsPopup=!1)})]),(0,r.Lk)("div",se,[a.applicationsLoading?((0,r.uX)(),(0,r.Wv)(f,{key:0,vertical:""},{default:(0,r.k6)((()=>t[9]||(t[9]=[(0,r.eW)("加载中...")]))),_:1})):((0,r.uX)(),(0,r.CE)(r.FK,{key:1},[0===a.applications.length?((0,r.uX)(),(0,r.Wv)(k,{key:0,description:"暂无申请"})):((0,r.uX)(),(0,r.Wv)(c,{key:1},{default:(0,r.k6)((()=>[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(a.applications,(e=>((0,r.uX)(),(0,r.Wv)(d,{key:e.id,title:e.applicantName,label:o.formatDate(e.createdAt),value:o.getApplicationStatusText(e.status),"value-class":o.getApplicationStatusClass(e.status)},(0,r.eX)({_:2},["PENDING"===e.status?{name:"right-icon",fn:(0,r.k6)((()=>[(0,r.Lk)("div",ae,[(0,r.bF)(m,{size:"small",type:"success",onClick:t=>o.approveApplication(e.requirementId,e.id),loading:a.approvingId===e.id},{default:(0,r.k6)((()=>t[10]||(t[10]=[(0,r.eW)(" 同意 ")]))),_:2},1032,["onClick","loading"]),(0,r.bF)(m,{size:"small",type:"danger",onClick:t=>o.rejectApplication(e.requirementId,e.id),loading:a.rejectingId===e.id},{default:(0,r.k6)((()=>t[11]||(t[11]=[(0,r.eW)(" 拒绝 ")]))),_:2},1032,["onClick","loading"])])])),key:"0"}:void 0]),1032,["title","label","value","value-class"])))),128))])),_:1}))],64))])])),_:1},8,["show"]),(0,r.bF)(b)])}var le={name:"ProfilePage",components:{HeaderBar:I,NavBar:$},data(){return{user:{id:"",name:"",email:""},activeTab:0,myRequirements:[],myRequirementsLoading:!1,myRequirementsFinished:!1,pendingRequirements:[],pendingRequirementsLoading:!1,pendingRequirementsFinished:!1,showApplicationsPopup:!1,applications:[],applicationsLoading:!1,currentRequirementId:null,approvingId:null,rejectingId:null}},created(){this.fetchUserData()},methods:{fetchUserData(){this.user=q.state.user||{name:"未知用户",email:"未知邮箱"}},async loadMyRequirements(){try{const e=await v.requirements.getMyRequirementsWithApplications();this.myRequirements=e.data,this.myRequirementsFinished=!0,this.myRequirementsLoading=!1}catch(e){console.error("Error loading my requirements:",e),(0,D.xr)("加载需求失败"),this.myRequirementsLoading=!1}},async loadPendingRequirements(){try{const e=await v.requirements.getMyApplications();this.pendingRequirements=e.data,this.pendingRequirementsFinished=!0,this.pendingRequirementsLoading=!1}catch(e){console.error("Error loading pending requirements:",e),(0,D.xr)("加载申请失败"),this.pendingRequirementsLoading=!1}},async loadApplications(e){this.applicationsLoading=!0,this.currentRequirementId=e;try{const t=await v.requirements.getApplicationsByRequirement(e);this.applications=t.data}catch(t){console.error("Error loading applications:",t),(0,D.xr)("加载申请列表失败")}finally{this.applicationsLoading=!1}},viewApplications(e){this.loadApplications(e),this.showApplicationsPopup=!0},async approveApplication(e,t){this.approvingId=t;try{await v.requirements.approveApplication(e,t),(0,D.GF)("已同意申请"),this.loadApplications(e),this.loadMyRequirements()}catch(i){console.error("Error approving application:",i),(0,D.xr)("操作失败")}finally{this.approvingId=null}},async rejectApplication(e,t){this.rejectingId=t;try{await v.requirements.rejectApplication(e,t),(0,D.GF)("已拒绝申请"),this.loadApplications(e),this.loadMyRequirements()}catch(i){console.error("Error rejecting application:",i),(0,D.xr)("操作失败")}finally{this.rejectingId=null}},getPendingApplicantsInfo(e){return e.pendingApplicationsCount>0?`${e.pendingApplicationsCount}人申请 | 状态: ${this.getStatusText(e.status)}`:`状态: ${this.getStatusText(e.status)}`},getStatusText(e){const t={CREATED:"已创建",CONFIRMING:"确认中",IN_PROGRESS:"进行中",COMPLETED:"已完成",CANCELLED:"已取消"};return t[e]||"未知状态"},getApplicationStatusText(e){const t={PENDING:"等待确认",APPROVED:"已同意",REJECTED:"已拒绝"};return t[e]||"未知状态"},getApplicationStatusType(e){const t={PENDING:"warning",APPROVED:"success",REJECTED:"danger"};return t[e]||"default"},getApplicationStatusClass(e){const t={PENDING:"status-pending",APPROVED:"status-approved",REJECTED:"status-rejected"};return t[e]||""},formatDate(e){if(!e)return"";const t=new Date(e);return t.toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})},goToRequirementDetail(e){this.$router.push(`/requirement/${e}`)},logout(){q.logout(),this.$router.push("/login")}}};const ue=(0,l.A)(le,[["render",oe],["__scopeId","data-v-e013082a"]]);var de=ue;const ce={class:"page"},me={class:"page-content"},pe={class:"detail-header"},he={class:"detail-meta"},ge={class:"status-row"},ve={key:0,class:"application-count"},fe={class:"detail-content"},ke=["innerHTML"],ye={class:"agreement-section"},be={key:0,class:"agreement-preview"},qe=["innerHTML"],we={key:0,class:"agreement-actions"},Ee={key:1,class:"no-agreement"},Ae={class:"application-actions"},Re={class:"agreement-popup"},Ce={class:"popup-header"},Le={class:"popup-content"},Te={class:"bottom-action-bar"},Fe={class:"icon-circle"};function Ie(e,t,i,n,s,a){const o=(0,r.g2)("header-bar"),l=(0,r.g2)("van-loading"),u=(0,r.g2)("van-tag"),d=(0,r.g2)("van-cell-group"),c=(0,r.g2)("van-button"),m=(0,r.g2)("van-icon"),p=(0,r.g2)("van-cell"),h=(0,r.g2)("van-action-sheet"),g=(0,r.g2)("agreement-display"),v=(0,r.g2)("van-popup");return(0,r.uX)(),(0,r.CE)("div",ce,[(0,r.bF)(o,{title:"需求详情"}),(0,r.Lk)("div",me,[s.loading?((0,r.uX)(),(0,r.Wv)(l,{key:0,vertical:"",class:"loading-overlay"},{default:(0,r.k6)((()=>t[6]||(t[6]=[(0,r.eW)("加载中...")]))),_:1})):((0,r.uX)(),(0,r.CE)(r.FK,{key:1},[(0,r.Lk)("div",pe,[(0,r.Lk)("h2",null,(0,A.v_)(s.requirement.title),1),(0,r.Lk)("div",he,[(0,r.Lk)("div",ge,[(0,r.bF)(u,{type:a.getStatusType(s.requirement.status),class:"custom-tag",round:""},{default:(0,r.k6)((()=>[(0,r.eW)((0,A.v_)(a.getStatusText(s.requirement.status)),1)])),_:1},8,["type"]),s.pendingApplicationsCount>0?((0,r.uX)(),(0,r.CE)("span",ve,(0,A.v_)(s.pendingApplicationsCount)+"人申请 ",1)):(0,r.Q3)("",!0)]),(0,r.Lk)("span",null,"发布时间: "+(0,A.v_)(a.formatDate(s.requirement.createdAt)),1)])]),(0,r.bF)(d,{inset:"",title:"需求描述"},{default:(0,r.k6)((()=>[(0,r.Lk)("div",fe,[(0,r.Lk)("p",{innerHTML:s.requirement.description},null,8,ke)])])),_:1}),(0,r.bF)(d,{inset:"",title:"协议内容",style:{"margin-top":"16px"}},{default:(0,r.k6)((()=>[(0,r.Lk)("div",ye,[s.requirement.agreement?((0,r.uX)(),(0,r.CE)("div",be,[(0,r.Lk)("div",{innerHTML:a.previewAgreement,class:"agreement-content"},null,8,qe),a.hasPermission?((0,r.uX)(),(0,r.CE)("div",we,[(0,r.bF)(c,{type:"primary",size:"small",onClick:a.goToEditAgreement},{default:(0,r.k6)((()=>t[7]||(t[7]=[(0,r.eW)(" 编辑协议 ")]))),_:1},8,["onClick"])])):(0,r.Q3)("",!0),s.previewMode?(0,r.Q3)("",!0):((0,r.uX)(),(0,r.CE)("div",{key:1,class:"agreement-view-more",onClick:t[0]||(t[0]=(...e)=>a.showFullAgreement&&a.showFullAgreement(...e))},[t[8]||(t[8]=(0,r.Lk)("span",null,"查看完整协议",-1)),(0,r.bF)(m,{name:"arrow-down"})]))])):((0,r.uX)(),(0,r.CE)("div",Ee,[t[10]||(t[10]=(0,r.Lk)("p",null,"此需求暂无协议内容",-1)),a.hasPermission?((0,r.uX)(),(0,r.Wv)(c,{key:0,type:"primary",size:"small",onClick:a.goToEditAgreement},{default:(0,r.k6)((()=>t[9]||(t[9]=[(0,r.eW)(" 添加协议 ")]))),_:1},8,["onClick"])):(0,r.Q3)("",!0)]))])])),_:1}),a.hasPermission&&s.pendingApplicationsCount>0?((0,r.uX)(),(0,r.Wv)(d,{key:0,inset:"",title:"申请人列表",style:{"margin-top":"16px"}},{default:(0,r.k6)((()=>[s.applicationsLoading?((0,r.uX)(),(0,r.Wv)(l,{key:0,size:"24px"},{default:(0,r.k6)((()=>t[11]||(t[11]=[(0,r.eW)("加载中...")]))),_:1})):((0,r.uX)(!0),(0,r.CE)(r.FK,{key:1},(0,r.pI)(s.pendingApplications,(e=>((0,r.uX)(),(0,r.Wv)(p,{key:e.id,title:e.applicantName,label:a.formatDate(e.createdAt)},{"right-icon":(0,r.k6)((()=>[(0,r.Lk)("div",Ae,[(0,r.bF)(c,{size:"small",type:"success",onClick:t=>a.approveApplication(e.id),loading:s.approvingId===e.id},{default:(0,r.k6)((()=>t[12]||(t[12]=[(0,r.eW)(" 同意 ")]))),_:2},1032,["onClick","loading"]),(0,r.bF)(c,{size:"small",type:"danger",onClick:t=>a.rejectApplication(e.id),loading:s.rejectingId===e.id},{default:(0,r.k6)((()=>t[13]||(t[13]=[(0,r.eW)(" 拒绝 ")]))),_:2},1032,["onClick","loading"])])])),_:2},1032,["title","label"])))),128))])),_:1})):(0,r.Q3)("",!0),a.hasPermission?((0,r.uX)(),(0,r.Wv)(d,{key:1,inset:"",title:"操作",style:{"margin-top":"16px"}},{default:(0,r.k6)((()=>[(0,r.bF)(p,{title:"查看相关结果","is-link":"",onClick:a.goToResults},null,8,["onClick"]),(0,r.bF)(p,{title:"更改状态","is-link":"",onClick:t[1]||(t[1]=e=>s.showStatusActionSheet=!0)}),(0,r.bF)(p,{title:"删除需求","is-link":"",onClick:a.confirmDelete},null,8,["onClick"])])),_:1})):((0,r.uX)(),(0,r.Wv)(d,{key:2,inset:"",title:"操作",style:{"margin-top":"16px"}},{default:(0,r.k6)((()=>[(0,r.bF)(p,{title:"查看相关结果","is-link":"",onClick:a.goToResults},null,8,["onClick"])])),_:1}))],64))]),(0,r.bF)(h,{show:s.showStatusActionSheet,"onUpdate:show":t[2]||(t[2]=e=>s.showStatusActionSheet=e),actions:s.statusActions,"cancel-text":"取消",onSelect:a.onSelectStatus},null,8,["show","actions","onSelect"]),(0,r.bF)(v,{show:s.showAgreementPopup,"onUpdate:show":t[4]||(t[4]=e=>s.showAgreementPopup=e),position:"bottom",style:{height:"80%"},round:""},{default:(0,r.k6)((()=>[(0,r.Lk)("div",Re,[(0,r.Lk)("div",Ce,[t[14]||(t[14]=(0,r.Lk)("div",{class:"popup-title"},"协议详情",-1)),(0,r.bF)(m,{name:"cross",onClick:t[3]||(t[3]=e=>s.showAgreementPopup=!1)})]),(0,r.Lk)("div",Le,[(0,r.bF)(g,{content:s.requirement.agreement,title:"需求协议 - "+s.requirement.title,showActions:!1},null,8,["content","title"])])])])),_:1},8,["show"]),(0,r.Lk)("div",Te,[(0,r.Lk)("div",{onClick:t[5]||(t[5]=(...e)=>a.goToAgreement&&a.goToAgreement(...e))},[(0,r.Lk)("div",Fe,[(0,r.bF)(m,{name:"friends-o",size:"24"})])])])])}const xe={class:"agreement-display"},Se={class:"display-header"},_e={class:"display-content"},Pe=["innerHTML"],De={key:1,class:"no-agreement"},Be={key:0,class:"display-actions"};function We(e,t,i,n,s,a){const o=(0,r.g2)("van-button");return(0,r.uX)(),(0,r.CE)("div",xe,[(0,r.Lk)("div",Se,[(0,r.Lk)("h3",null,(0,A.v_)(i.title),1)]),(0,r.Lk)("div",_e,[i.content?((0,r.uX)(),(0,r.CE)("div",{key:0,innerHTML:i.content,class:"agreement-content"},null,8,Pe)):((0,r.uX)(),(0,r.CE)("div",De,"暂无协议内容"))]),i.showActions?((0,r.uX)(),(0,r.CE)("div",Be,[(0,r.bF)(o,{type:"primary",block:"",onClick:a.agree,loading:i.loading,disabled:i.loading},{default:(0,r.k6)((()=>[(0,r.eW)((0,A.v_)(i.buttonText),1)])),_:1},8,["onClick","loading","disabled"]),(0,r.bF)(o,{type:"default",block:"",onClick:a.goBack,class:"back-button"},{default:(0,r.k6)((()=>t[0]||(t[0]=[(0,r.eW)(" 返回 ")]))),_:1},8,["onClick"])])):(0,r.Q3)("",!0)])}var $e={name:"AgreementDisplay",props:{content:{type:String,default:""},title:{type:String,default:"协议内容"},showActions:{type:Boolean,default:!0},loading:{type:Boolean,default:!1},buttonText:{type:String,default:"我已阅读并同意此协议"}},methods:{agree(){this.$emit("agree")},goBack(){this.$emit("back")}}};const Xe=(0,l.A)($e,[["render",We],["__scopeId","data-v-db8532c4"]]);var Ne=Xe,Me=i(5749),Oe={name:"RequirementDetailPage",components:{HeaderBar:I,AgreementDisplay:Ne},props:{id:{type:[String,Number],required:!0}},data(){return{requirement:{id:"",title:"",description:"",status:"",agreement:"",createdBy:"",createdAt:"",updatedAt:""},loading:!0,pendingApplicationsCount:0,pendingApplications:[],applicationsLoading:!1,showStatusActionSheet:!1,showAgreementPopup:!1,previewMode:!1,statusActions:[{name:"已创建",value:"CREATED"},{name:"进行中",value:"IN_PROGRESS"},{name:"已完成",value:"COMPLETED"},{name:"已取消",value:"CANCELLED"}],approvingId:null,rejectingId:null}},computed:{hasPermission(){const e=q.state.user;return!!e&&("ADMIN"===e.role||e.id===this.requirement.createdBy)},previewAgreement(){if(!this.requirement.agreement)return"";if(!this.previewMode)return this.requirement.agreement;const e=document.createElement("div");e.innerHTML=this.requirement.agreement;const t=e.textContent||e.innerText;return t.length<=300?this.requirement.agreement:this.requirement.agreement.substring(0,300)+"..."}},created(){this.fetchRequirementDetail(),this.previewMode=!0},methods:{async fetchRequirementDetail(){this.loading=!0;try{const e=await v.requirements.getById(this.id);this.requirement=e.data,this.hasPermission&&this.fetchApplications()}catch(e){console.error("Error fetching requirement detail:",e),(0,D.xr)("获取需求详情失败")}finally{this.loading=!1}},async fetchApplications(){this.applicationsLoading=!0;try{const e=await v.requirements.getApplicationsByRequirement(this.id);this.pendingApplications=e.data.filter((e=>"PENDING"===e.status)),this.pendingApplicationsCount=this.pendingApplications.length}catch(e){console.error("Error fetching applications:",e)}finally{this.applicationsLoading=!1}},async approveApplication(e){this.approvingId=e;try{await v.requirements.approveApplication(this.id,e),(0,D.GF)("已同意申请"),this.fetchRequirementDetail()}catch(t){console.error("Error approving application:",t),(0,D.xr)("操作失败: "+(t.response?.data?.message||"未知错误"))}finally{this.approvingId=null}},async rejectApplication(e){this.rejectingId=e;try{await v.requirements.rejectApplication(this.id,e),(0,D.GF)("已拒绝申请"),this.fetchRequirementDetail()}catch(t){console.error("Error rejecting application:",t),(0,D.xr)("操作失败: "+(t.response?.data?.message||"未知错误"))}finally{this.rejectingId=null}},formatDate(e){if(!e)return"未知";const t=new Date(e);return t.toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})},getStatusText(e){const t={CREATED:"已创建",CONFIRMING:"确认中",IN_PROGRESS:"进行中",COMPLETED:"已完成",CANCELLED:"已取消"};return t[e]||"未知状态"},getStatusType(e){const t={CREATED:"primary",CONFIRMING:"warning",IN_PROGRESS:"success",COMPLETED:"success",CANCELLED:"danger"};return t[e]||"default"},async onSelectStatus(e){if(this.hasPermission)try{await v.requirements.update(this.id,{status:e.value}),this.requirement.status=e.value,(0,D.GF)("状态更新成功")}catch(t){console.error("Error updating status:",t),(0,D.xr)("状态更新失败")}else(0,D.xr)("您没有权限执行此操作")},confirmDelete(){this.hasPermission?(0,Me.M5)({title:"确认删除",message:"确定要删除这个需求吗？此操作不可撤销！"}).then((async()=>{try{await v.requirements.delete(this.id),(0,D.GF)("需求已删除"),this.$router.push("/requirements")}catch(e){console.error("Error deleting requirement:",e),(0,D.xr)("删除需求失败")}})).catch((()=>{})):(0,D.xr)("您没有权限执行此操作")},goToEditAgreement(){this.$router.push(`/requirement/${this.id}/agreement/edit`)},showFullAgreement(){this.showAgreementPopup=!0},goToAgreement(){this.$router.push({path:"/agreement",query:{requirementId:this.id,status:this.requirement.status}})},goToResults(){this.$router.push(`/results/requirement/${this.id}`)}}};const Ve=(0,l.A)(Oe,[["render",Ie],["__scopeId","data-v-28fd91d8"]]);var Ue=Ve;const je={class:"page"},ze={class:"page-content"},He={class:"detail-header"},Ge={class:"detail-meta"},Qe={class:"status-row"},Ke={class:"detail-content"},Je=["innerHTML"];function Ze(e,t,i,n,s,a){const o=(0,r.g2)("header-bar"),l=(0,r.g2)("van-loading"),u=(0,r.g2)("van-tag"),d=(0,r.g2)("van-cell-group"),c=(0,r.g2)("van-cell"),m=(0,r.g2)("van-action-sheet");return(0,r.uX)(),(0,r.CE)("div",je,[a.hasPermission?((0,r.uX)(),(0,r.Wv)(o,{key:0,title:s.result.title||"结果详情","right-text":"编辑",onRightClick:a.goToEdit},null,8,["title","onRightClick"])):((0,r.uX)(),(0,r.Wv)(o,{key:1,title:s.result.title||"结果详情"},null,8,["title"])),(0,r.Lk)("div",ze,[s.loading?((0,r.uX)(),(0,r.Wv)(l,{key:0,vertical:"",class:"loading-overlay"},{default:(0,r.k6)((()=>t[2]||(t[2]=[(0,r.eW)("加载中...")]))),_:1})):((0,r.uX)(),(0,r.CE)(r.FK,{key:1},[(0,r.Lk)("div",He,[(0,r.Lk)("h2",null,(0,A.v_)(s.result.title),1),(0,r.Lk)("div",Ge,[(0,r.Lk)("div",Qe,[(0,r.bF)(u,{type:a.getStatusType(s.result.status),class:"custom-tag",round:""},{default:(0,r.k6)((()=>[(0,r.eW)((0,A.v_)(a.getStatusText(s.result.status)),1)])),_:1},8,["type"])]),(0,r.Lk)("span",null,"创建时间: "+(0,A.v_)(a.formatDate(s.result.createdAt)),1),(0,r.Lk)("span",null,"更新时间: "+(0,A.v_)(a.formatDate(s.result.updatedAt)),1)])]),(0,r.bF)(d,{inset:"",title:"结果描述"},{default:(0,r.k6)((()=>[(0,r.Lk)("div",Ke,[(0,r.Lk)("p",{innerHTML:s.result.description},null,8,Je)])])),_:1}),s.result.relatedRequirementId?((0,r.uX)(),(0,r.Wv)(d,{key:0,inset:"",title:"关联需求"},{default:(0,r.k6)((()=>[(0,r.bF)(c,{title:s.relatedRequirementTitle||"查看关联需求","is-link":"",onClick:a.goToRelatedRequirement},null,8,["title","onClick"])])),_:1})):(0,r.Q3)("",!0),a.hasPermission?((0,r.uX)(),(0,r.Wv)(d,{key:1,inset:"",title:"操作",style:{"margin-top":"16px"}},{default:(0,r.k6)((()=>[(0,r.bF)(c,{title:"更改状态","is-link":"",onClick:t[0]||(t[0]=e=>s.showStatusActionSheet=!0)}),(0,r.bF)(c,{title:"删除结果","is-link":"",onClick:a.confirmDelete},null,8,["onClick"])])),_:1})):(0,r.Q3)("",!0)],64))]),(0,r.bF)(m,{show:s.showStatusActionSheet,"onUpdate:show":t[1]||(t[1]=e=>s.showStatusActionSheet=e),actions:s.statusActions,"cancel-text":"取消",onSelect:a.onSelectStatus},null,8,["show","actions","onSelect"])])}var Ye={name:"ResultDetailPage",components:{HeaderBar:I},props:{id:{type:String,required:!0}},data(){return{result:{id:"",title:"",description:"",status:"",relatedRequirementId:null,createdBy:"",createdAt:"",updatedAt:""},relatedRequirementTitle:"",loading:!0,showStatusActionSheet:!1,statusActions:[{name:"草稿",value:"DRAFT"},{name:"已完成",value:"COMPLETED"},{name:"已归档",value:"ARCHIVED"},{name:"已拒绝",value:"REJECTED"}]}},computed:{hasPermission(){const e=q.state.user;return!!e&&("ADMIN"===e.role||e.id===this.result.createdBy)}},created(){this.fetchResultDetail()},methods:{async fetchResultDetail(){this.loading=!0;try{const e=await v.results.getById(this.id);this.result=e.data,this.result.relatedRequirementId&&this.fetchRelatedRequirement(this.result.relatedRequirementId)}catch(e){console.error("Error fetching result detail:",e),(0,D.xr)("获取结果详情失败")}finally{this.loading=!1}},async fetchRelatedRequirement(e){try{const t=await v.requirements.getById(e);this.relatedRequirementTitle=t.data.title}catch(t){console.error("Error fetching related requirement:",t),this.relatedRequirementTitle="未能获取需求标题"}},formatDate(e){if(!e)return"未知";const t=new Date(e);return t.toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})},getStatusText(e){const t={DRAFT:"草稿",COMPLETED:"已完成",ARCHIVED:"已归档",REJECTED:"已拒绝"};return t[e]||"未知状态"},getStatusType(e){const t={DRAFT:"primary",COMPLETED:"success",ARCHIVED:"warning",REJECTED:"danger"};return t[e]||"default"},async onSelectStatus(e){if(this.hasPermission)try{await v.results.update(this.id,{status:e.value}),this.result.status=e.value,(0,D.GF)("状态更新成功")}catch(t){console.error("Error updating status:",t),(0,D.xr)("状态更新失败")}else(0,D.xr)("您没有权限执行此操作")},confirmDelete(){this.hasPermission?(0,Me.M5)({title:"确认删除",message:"确定要删除这个结果吗？此操作不可撤销！"}).then((async()=>{try{await v.results.delete(this.id),(0,D.GF)("结果已删除"),this.$router.push("/results")}catch(e){console.error("Error deleting result:",e),(0,D.xr)("删除结果失败")}})).catch((()=>{})):(0,D.xr)("您没有权限执行此操作")},goToEdit(){this.hasPermission?this.$router.push(`/result/edit/${this.id}`):(0,D.xr)("您没有权限执行此操作")},goToRelatedRequirement(){this.result.relatedRequirementId&&this.$router.push(`/requirement/${this.result.relatedRequirementId}`)}}};const et=(0,l.A)(Ye,[["render",Ze],["__scopeId","data-v-be9cfd0c"]]);var tt=et;const it={class:"page"},nt={class:"page-content"},rt={class:"applied-popup"};function st(e,t,i,n,s,a){const o=(0,r.g2)("header-bar"),l=(0,r.g2)("van-loading"),u=(0,r.g2)("agreement-display"),d=(0,r.g2)("van-icon"),c=(0,r.g2)("van-button"),m=(0,r.g2)("van-popup");return(0,r.uX)(),(0,r.CE)("div",it,[(0,r.bF)(o,{title:"协议"}),(0,r.Lk)("div",nt,[s.loading?((0,r.uX)(),(0,r.Wv)(l,{key:0,vertical:"",class:"loading-overlay"},{default:(0,r.k6)((()=>t[1]||(t[1]=[(0,r.eW)("加载中...")]))),_:1})):((0,r.uX)(),(0,r.CE)(r.FK,{key:1},[(0,r.bF)(u,{content:s.requirement.agreement,title:"需求协议 - "+s.requirement.title,showActions:!0,loading:s.applying,buttonText:a.getButtonText(),onAgree:a.acceptRequirement,onBack:a.goBack},null,8,["content","title","loading","buttonText","onAgree","onBack"]),(0,r.bF)(m,{show:s.showAlreadyAppliedPopup,"onUpdate:show":t[0]||(t[0]=e=>s.showAlreadyAppliedPopup=e),round:"",position:"bottom",style:{height:"30%"}},{default:(0,r.k6)((()=>[(0,r.Lk)("div",rt,[(0,r.bF)(d,{name:"info-o",size:"40",class:"applied-icon"}),t[3]||(t[3]=(0,r.Lk)("h3",null,"您已申请过此需求",-1)),t[4]||(t[4]=(0,r.Lk)("p",null,"请等待需求创建者审核您的申请。",-1)),(0,r.bF)(c,{type:"primary",block:"",onClick:a.goBack},{default:(0,r.k6)((()=>t[2]||(t[2]=[(0,r.eW)("返回")]))),_:1},8,["onClick"])])])),_:1},8,["show"])],64))])])}var at={name:"AgreementPage",components:{HeaderBar:I,AgreementDisplay:Ne},data(){return{requirementId:null,requirement:{id:"",title:"",agreement:"",agreementButtonText:null,status:""},loading:!0,applying:!1,alreadyApplied:!1,showAlreadyAppliedPopup:!1}},computed:{isCreator(){const e=q.state.user?.id;return this.requirement.createdBy===e}},created(){this.requirementId=this.$route.query.requirementId,this.requirementId?this.fetchRequirementDetails():this.$router.back()},methods:{async fetchRequirementDetails(){this.loading=!0;try{const e=await v.requirements.getById(this.requirementId);this.requirement=e.data,await this.checkUserApplication()}catch(e){console.error("Error fetching requirement details:",e),(0,D.xr)("获取需求详情失败"),this.$router.back()}finally{this.loading=!1}},getButtonText(){return this.requirement.agreementButtonText||"我已阅读并同意此协议"},async checkUserApplication(){try{const e=await v.requirements.getMyApplications(),t=e.data.some((e=>e.id===this.requirementId&&("PENDING"===e.applicationStatus||"APPROVED"===e.applicationStatus)));this.alreadyApplied=t,this.alreadyApplied&&(this.showAlreadyAppliedPopup=!0)}catch(e){console.error("Error checking user applications:",e)}},goBack(){this.$router.back()},async acceptRequirement(){if(this.isCreator)(0,D.xr)("不能申请自己的需求");else if("CREATED"===this.requirement.status||"IN_PROGRESS"===this.requirement.status)if(this.alreadyApplied)this.showAlreadyAppliedPopup=!0;else{this.applying=!0;try{await v.requirements.acceptRequirement(this.requirementId),(0,D.GF)("申请已提交，等待确认"),setTimeout((()=>{this.$router.push(`/requirement/${this.requirementId}`)}),1e3)}catch(e){console.error("Error accepting requirement:",e),(0,D.xr)("接受需求失败: "+(e.response?.data?.message||"未知错误"))}finally{this.applying=!1}}else(0,D.xr)("此需求当前状态不可接受")}}};const ot=(0,l.A)(at,[["render",st],["__scopeId","data-v-74ca1876"]]);var lt=ot;const ut={class:"page"},dt={class:"page-content"},ct={class:"rich-text-wrapper"},mt={ref:"editor",class:"rich-text-editor"},pt={key:0,class:"error-message"},ht={class:"agreement-section"},gt={class:"field-label"},vt={class:"label-with-tip"},ft={key:0},kt={key:1,class:"agreement-preview"},yt=["innerHTML"],bt={key:0,class:"agreement-button-preview"},qt={class:"agreement-actions"},wt={key:2,class:"agreement-add"},Et={style:{margin:"16px"}};function At(e,t,i,n,s,a){const o=(0,r.g2)("header-bar"),l=(0,r.g2)("van-field"),u=(0,r.g2)("van-tag"),d=(0,r.g2)("agreement-editor"),c=(0,r.g2)("van-button"),m=(0,r.g2)("van-cell-group"),p=(0,r.g2)("van-form");return(0,r.uX)(),(0,r.CE)("div",ut,[(0,r.bF)(o,{title:"新建需求"}),(0,r.Lk)("div",dt,[(0,r.bF)(p,{onSubmit:a.onSubmit},{default:(0,r.k6)((()=>[(0,r.bF)(m,{inset:""},{default:(0,r.k6)((()=>[(0,r.bF)(l,{modelValue:s.title,"onUpdate:modelValue":t[0]||(t[0]=e=>s.title=e),name:"title",label:"需求标题",placeholder:"请输入需求标题",rules:[{required:!0,message:"请填写需求标题"}]},null,8,["modelValue"]),(0,r.Lk)("div",ct,[t[1]||(t[1]=(0,r.Lk)("div",{class:"field-label"},"需求描述",-1)),(0,r.Lk)("div",mt,null,512),s.descriptionError?((0,r.uX)(),(0,r.CE)("div",pt,"请填写需求描述")):(0,r.Q3)("",!0)]),(0,r.Lk)("div",ht,[(0,r.Lk)("div",gt,[(0,r.Lk)("div",vt,[t[3]||(t[3]=(0,r.Lk)("span",null,"协议内容",-1)),(0,r.bF)(u,{type:"primary",size:"medium",style:{"margin-left":"8px"}},{default:(0,r.k6)((()=>t[2]||(t[2]=[(0,r.eW)("可选")]))),_:1})]),t[4]||(t[4]=(0,r.Lk)("span",{class:"field-tip"},"定义参与者需要同意的协议条款",-1))]),s.showAgreementEditor?((0,r.uX)(),(0,r.CE)("div",ft,[(0,r.bF)(d,{onSave:a.saveAgreement,onCancel:a.toggleAgreementEditor,ref:"agreementEditor",title:"添加协议"},null,8,["onSave","onCancel"])])):s.agreement?((0,r.uX)(),(0,r.CE)("div",kt,[(0,r.Lk)("div",{innerHTML:s.agreement,class:"agreement-content-preview"},null,8,yt),s.agreementButtonText?((0,r.uX)(),(0,r.CE)("div",bt,[t[5]||(t[5]=(0,r.Lk)("p",{class:"button-preview-label"},"确认按钮文本：",-1)),(0,r.bF)(u,{type:"primary",size:"medium"},{default:(0,r.k6)((()=>[(0,r.eW)((0,A.v_)(s.agreementButtonText),1)])),_:1})])):(0,r.Q3)("",!0),(0,r.Lk)("div",qt,[(0,r.bF)(c,{type:"primary",size:"small",onClick:a.toggleAgreementEditor},{default:(0,r.k6)((()=>t[6]||(t[6]=[(0,r.eW)(" 编辑协议 ")]))),_:1},8,["onClick"]),(0,r.bF)(c,{type:"danger",size:"small",onClick:a.clearAgreement},{default:(0,r.k6)((()=>t[7]||(t[7]=[(0,r.eW)(" 删除协议 ")]))),_:1},8,["onClick"])])])):((0,r.uX)(),(0,r.CE)("div",wt,[(0,r.bF)(c,{plain:"",type:"primary",size:"small",icon:"plus",onClick:a.toggleAgreementEditor},{default:(0,r.k6)((()=>t[8]||(t[8]=[(0,r.eW)(" 添加协议 ")]))),_:1},8,["onClick"]),t[9]||(t[9]=(0,r.Lk)("span",{class:"add-agreement-tip"},"添加协议可以规范参与者行为和责任",-1))]))])])),_:1}),(0,r.Lk)("div",Et,[(0,r.bF)(c,{round:"",block:"",type:"primary","native-type":"submit",loading:s.submitting,disabled:s.submitting},{default:(0,r.k6)((()=>t[10]||(t[10]=[(0,r.eW)(" 提交 ")]))),_:1},8,["loading","disabled"])])])),_:1},8,["onSubmit"])])])}const Rt={class:"agreement-editor"},Ct={class:"editor-header"},Lt={class:"rich-text-wrapper"},Tt={ref:"editor",class:"rich-text-editor"},Ft={key:0,class:"error-message"},It={class:"button-text-editor"},xt={class:"field-label"},St={class:"label-with-tip"},_t={key:0,class:"error-message"},Pt={class:"editor-actions"};function Dt(e,t,i,n,s,a){const o=(0,r.g2)("van-tag"),l=(0,r.g2)("van-field"),u=(0,r.g2)("van-button");return(0,r.uX)(),(0,r.CE)("div",Rt,[(0,r.Lk)("div",Ct,[(0,r.Lk)("h3",null,(0,A.v_)(i.title),1),t[1]||(t[1]=(0,r.Lk)("p",{class:"editor-tip"},"请编辑此需求的协议内容，参与者同意此协议后才能参与需求。",-1))]),(0,r.Lk)("div",Lt,[(0,r.Lk)("div",Tt,null,512),s.contentError?((0,r.uX)(),(0,r.CE)("div",Ft,(0,A.v_)(s.contentErrorMessage),1)):(0,r.Q3)("",!0)]),(0,r.Lk)("div",It,[(0,r.Lk)("div",xt,[(0,r.Lk)("div",St,[t[3]||(t[3]=(0,r.Lk)("span",null,"确认按钮文本",-1)),(0,r.bF)(o,{type:"primary",size:"mini",style:{"margin-left":"8px"}},{default:(0,r.k6)((()=>t[2]||(t[2]=[(0,r.eW)("可选")]))),_:1})]),t[4]||(t[4]=(0,r.Lk)("span",{class:"field-tip"},'自定义"同意协议"按钮文本，最长20个字符',-1))]),(0,r.bF)(l,{modelValue:s.buttonText,"onUpdate:modelValue":t[0]||(t[0]=e=>s.buttonText=e),placeholder:"请输入按钮文本，留空则使用默认文本",maxlength:20,"show-word-limit":""},null,8,["modelValue"]),s.buttonTextError?((0,r.uX)(),(0,r.CE)("div",_t,(0,A.v_)(s.buttonTextErrorMessage),1)):(0,r.Q3)("",!0)]),(0,r.Lk)("div",Pt,[(0,r.bF)(u,{type:"primary",onClick:a.saveAgreement,loading:s.saving,disabled:s.saving},{default:(0,r.k6)((()=>t[5]||(t[5]=[(0,r.eW)(" 保存协议 ")]))),_:1},8,["onClick","loading","disabled"]),(0,r.bF)(u,{type:"default",onClick:a.cancel,disabled:s.saving},{default:(0,r.k6)((()=>t[6]||(t[6]=[(0,r.eW)(" 取消 ")]))),_:1},8,["onClick","disabled"])])])}var Bt=i(2284),Wt=i.n(Bt),$t={name:"AgreementEditor",props:{initialContent:{type:String,default:""},initialButtonText:{type:String,default:""},title:{type:String,default:"编辑协议"}},data(){return{editor:null,content:"",buttonText:this.initialButtonText||"",saving:!1,contentError:!1,contentErrorMessage:"协议内容不能为空",buttonTextError:!1,buttonTextErrorMessage:"按钮文本最长为20个字符"}},mounted(){this.initEditor()},beforeUnmount(){this.editor&&(this.editor.destroy(),this.editor=null)},methods:{initEditor(){this.editor=new(Wt())(this.$refs.editor),this.editor.config.placeholder="请输入协议内容...",this.editor.config.zIndex=100,window.innerWidth<768?this.editor.config.menus=["bold","head","fontSize","list","justify","undo","redo"]:this.editor.config.menus=["bold","italic","underline","head","fontSize","fontName","strikeThrough","link","list","justify","quote","undo","redo"],this.editor.config.height=300,this.editor.create(),this.initialContent?this.editor.txt.html(this.initialContent):this.editor.txt.html(this.getDefaultAgreementTemplate())},validateContent(){const e=this.editor.txt.html();return e&&"<p><br></p>"!==e?(this.contentError=!1,this.content=e,!0):(this.contentError=!0,!1)},validateButtonText(){return this.buttonText&&this.buttonText.length>20?(this.buttonTextError=!0,!1):(this.buttonTextError=!1,!0)},saveAgreement(){const e=this.validateContent(),t=this.validateButtonText();e&&t?(this.saving=!0,this.$emit("save",this.content,this.buttonText)):e?(0,D.xr)(this.buttonTextErrorMessage):(0,D.xr)(this.contentErrorMessage)},saved(e,t){this.saving=!1,e?(0,D.GF)(t||"协议已保存"):(0,D.xr)(t||"保存失败")},cancel(){this.$emit("cancel")},getDefaultAgreementTemplate(){return"\n      <h3>参与协议</h3>\n      <p>欢迎参与本需求工作。在您申请参与之前，请仔细阅读以下协议内容：</p>\n      \n      <h4>1. 参与条件</h4>\n      <p>参与者同意按照需求描述完成相关工作，并遵守项目的时间节点和质量要求。</p>\n      \n      <h4>2. 权利与责任</h4>\n      <p>参与者有权获取与工作相关的必要信息和资源，同时有责任保持信息的保密性。</p>\n      \n      <h4>3. 成果交付</h4>\n      <p>参与者应当按时提交工作成果，并确保成果符合需求描述的要求。</p>\n      \n      <h4>4. 合作方式</h4>\n      <p>参与者需要与需求方保持良好的沟通，及时反馈工作进度和遇到的问题。</p>\n      \n      <p>申请参与即表示您已阅读并同意本协议的全部内容。</p>\n      "}}};const Xt=(0,l.A)($t,[["render",Dt],["__scopeId","data-v-3762c51c"]]);var Nt=Xt,Mt={name:"NewRequirementPage",components:{HeaderBar:I,AgreementEditor:Nt},data(){return{title:"",description:"",agreement:"",agreementButtonText:"",editor:null,submitting:!1,descriptionError:!1,showAgreementEditor:!1}},mounted(){this.initEditor()},beforeUnmount(){this.editor&&(this.editor.destroy(),this.editor=null)},methods:{initEditor(){this.editor=new(Wt())(this.$refs.editor),this.editor.config.placeholder="请输入需求详细描述",this.editor.config.zIndex=100,this.editor.config.menus=["bold","italic","underline","head","fontSize","fontName","strikeThrough","foreColor","backColor","link","list","justify","quote","emoticon","undo","redo"],window.innerWidth<768&&(this.editor.config.menus=["bold","head","fontSize","list","justify","emoticon","undo","redo"]),this.editor.config.height=250,this.editor.create()},validateDescription(){const e=this.editor.txt.html();return e&&"<p><br></p>"!==e?(this.descriptionError=!1,this.description=e,!0):(this.descriptionError=!0,!1)},toggleAgreementEditor(){this.showAgreementEditor=!this.showAgreementEditor},saveAgreement(e,t){this.agreement=e,this.agreementButtonText=t,this.showAgreementEditor=!1,this.$refs.agreementEditor&&this.$refs.agreementEditor.saved(!0)},clearAgreement(){this.agreement="",this.agreementButtonText=""},async onSubmit(){if(this.validateDescription()){this.submitting=!0;try{const e={title:this.title,description:this.description,agreement:this.agreement||null,agreementButtonText:this.agreementButtonText||null};await v.requirements.create(e),(0,D.GF)("需求创建成功"),setTimeout((()=>{this.$router.push("/requirements")}),1e3)}catch(e){console.error("Error creating requirement:",e),(0,D.xr)("创建需求失败: "+(e.response?.data?.error||"未知错误"))}finally{this.submitting=!1}}}}};const Ot=(0,l.A)(Mt,[["render",At],["__scopeId","data-v-5be66c11"]]);var Vt=Ot;const Ut={class:"page"},jt={class:"page-content"},zt={class:"rich-text-wrapper"},Ht={ref:"editor",class:"rich-text-editor"},Gt={key:0,class:"error-message"},Qt={class:"agreement-section"},Kt={class:"field-label"},Jt={class:"label-with-tip"},Zt={style:{margin:"16px"}};function Yt(e,t,i,n,s,a){const o=(0,r.g2)("header-bar"),l=(0,r.g2)("van-loading"),u=(0,r.g2)("van-field"),d=(0,r.g2)("van-dropdown-item"),c=(0,r.g2)("van-dropdown-menu"),m=(0,r.g2)("van-tag"),p=(0,r.g2)("van-cell"),h=(0,r.g2)("van-cell-group"),g=(0,r.g2)("van-button"),v=(0,r.g2)("van-form");return(0,r.uX)(),(0,r.CE)("div",Ut,[(0,r.bF)(o,{title:"编辑需求"}),(0,r.Lk)("div",jt,[s.loading?((0,r.uX)(),(0,r.Wv)(l,{key:0,vertical:"",class:"loading-overlay"},{default:(0,r.k6)((()=>t[2]||(t[2]=[(0,r.eW)("加载中...")]))),_:1})):((0,r.uX)(),(0,r.Wv)(v,{key:1,onSubmit:a.onSubmit},{default:(0,r.k6)((()=>[(0,r.bF)(h,{inset:""},{default:(0,r.k6)((()=>[(0,r.bF)(u,{modelValue:s.title,"onUpdate:modelValue":t[0]||(t[0]=e=>s.title=e),name:"title",label:"需求标题",placeholder:"请输入需求标题",rules:[{required:!0,message:"请填写需求标题"}]},null,8,["modelValue"]),(0,r.Lk)("div",zt,[t[3]||(t[3]=(0,r.Lk)("div",{class:"field-label"},"需求描述",-1)),(0,r.Lk)("div",Ht,null,512),s.descriptionError?((0,r.uX)(),(0,r.CE)("div",Gt,"请填写需求描述")):(0,r.Q3)("",!0)]),(0,r.bF)(u,{name:"status",label:"状态",readonly:""},{input:(0,r.k6)((()=>[(0,r.bF)(c,null,{default:(0,r.k6)((()=>[(0,r.bF)(d,{modelValue:s.status,"onUpdate:modelValue":t[1]||(t[1]=e=>s.status=e),options:s.statusOptions},null,8,["modelValue","options"])])),_:1})])),_:1}),(0,r.Lk)("div",Qt,[(0,r.Lk)("div",Kt,[(0,r.Lk)("div",Jt,[t[5]||(t[5]=(0,r.Lk)("span",null,"协议内容",-1)),(0,r.bF)(m,{type:"primary",size:"medium",style:{"margin-left":"8px"}},{default:(0,r.k6)((()=>t[4]||(t[4]=[(0,r.eW)("可选")]))),_:1})]),t[6]||(t[6]=(0,r.Lk)("span",{class:"field-tip"},"您可以选择编辑协议或在需求详情页中编辑",-1))]),(0,r.bF)(p,{title:"查看或编辑协议","is-link":"",onClick:a.goToEditAgreement},null,8,["onClick"])])])),_:1}),(0,r.Lk)("div",Zt,[(0,r.bF)(g,{round:"",block:"",type:"primary","native-type":"submit",loading:s.submitting,disabled:s.submitting},{default:(0,r.k6)((()=>t[7]||(t[7]=[(0,r.eW)(" 保存 ")]))),_:1},8,["loading","disabled"])])])),_:1},8,["onSubmit"]))])])}var ei={name:"EditRequirementPage",components:{HeaderBar:I},props:{id:{type:String,required:!0}},data(){return{title:"",description:"",status:"",loading:!0,submitting:!1,descriptionError:!1,editor:null,statusOptions:[{text:"已创建",value:"CREATED"},{text:"进行中",value:"IN_PROGRESS"},{text:"已完成",value:"COMPLETED"},{text:"已取消",value:"CANCELLED"}]}},mounted(){this.fetchRequirementDetail()},beforeUnmount(){this.editor&&(this.editor.destroy(),this.editor=null)},methods:{async fetchRequirementDetail(){try{const e=await v.requirements.getById(this.id),t=e.data;this.title=t.title,this.description=t.description,this.status=t.status,this.loading=!1,this.$nextTick((()=>{this.initEditor()}))}catch(e){console.error("Error fetching requirement:",e),(0,D.xr)("获取需求详情失败"),this.$router.push(`/requirement/${this.id}`)}},initEditor(){this.editor=new(Wt())(this.$refs.editor),this.editor.config.placeholder="请输入需求详细描述",this.editor.config.zIndex=100,this.editor.config.menus=["bold","italic","underline","head","fontSize","fontName","strikeThrough","foreColor","backColor","link","list","justify","quote","emoticon","undo","redo"],window.innerWidth<768&&(this.editor.config.menus=["bold","head","fontSize","list","justify","emoticon","undo","redo"]),this.editor.config.height=250,this.editor.create(),this.editor.txt.html(this.description)},validateDescription(){const e=this.editor.txt.html();return e&&"<p><br></p>"!==e?(this.descriptionError=!1,this.description=e,!0):(this.descriptionError=!0,!1)},goToEditAgreement(){this.$router.push(`/requirement/${this.id}/agreement/edit`)},async onSubmit(){if(this.validateDescription()){this.submitting=!0;try{const e={title:this.title,description:this.description,status:this.status};await v.requirements.update(this.id,e),(0,D.GF)("需求更新成功"),setTimeout((()=>{this.$router.push(`/requirement/${this.id}`)}),1e3)}catch(e){console.error("Error updating requirement:",e),(0,D.xr)("更新需求失败: "+(e.response?.data?.error||"未知错误"))}finally{this.submitting=!1}}}}};const ti=(0,l.A)(ei,[["render",Yt],["__scopeId","data-v-f5aebe8c"]]);var ii=ti;const ni={class:"page"},ri={class:"page-content"},si={class:"rich-text-wrapper"},ai={ref:"editor",class:"rich-text-editor"},oi={key:0,class:"error-message"},li={style:{margin:"16px"}};function ui(e,t,i,n,s,a){const o=(0,r.g2)("header-bar"),l=(0,r.g2)("van-field"),u=(0,r.g2)("van-cell-group"),d=(0,r.g2)("van-button"),c=(0,r.g2)("van-form"),m=(0,r.g2)("van-picker"),p=(0,r.g2)("van-popup"),h=(0,r.g2)("van-loading");return(0,r.uX)(),(0,r.CE)("div",ni,[(0,r.bF)(o,{title:"新建结果"}),(0,r.Lk)("div",ri,[(0,r.bF)(c,{onSubmit:a.onSubmit},{default:(0,r.k6)((()=>[(0,r.bF)(u,{inset:""},{default:(0,r.k6)((()=>[(0,r.bF)(l,{modelValue:s.title,"onUpdate:modelValue":t[0]||(t[0]=e=>s.title=e),name:"title",label:"结果标题",placeholder:"请输入结果标题",rules:[{required:!0,message:"请填写结果标题"}]},null,8,["modelValue"]),(0,r.Lk)("div",si,[t[4]||(t[4]=(0,r.Lk)("div",{class:"field-label"},"结果描述",-1)),(0,r.Lk)("div",ai,null,512),s.descriptionError?((0,r.uX)(),(0,r.CE)("div",oi,"请填写结果描述")):(0,r.Q3)("",!0)]),!s.relatedRequirementId&&a.requirementOptions.length>0?((0,r.uX)(),(0,r.Wv)(l,{key:0,readonly:"",name:"relatedRequirement",label:"关联需求",value:s.selectedRequirementTitle,"right-icon":"arrow-down",onClick:t[1]||(t[1]=e=>s.showRequirementPicker=!0)},null,8,["value"])):(0,r.Q3)("",!0),s.relatedRequirementId?((0,r.uX)(),(0,r.Wv)(l,{key:1,readonly:"",name:"relatedRequirementFixed",label:"关联需求",value:s.selectedRequirementTitle},null,8,["value"])):(0,r.Q3)("",!0)])),_:1}),(0,r.Lk)("div",li,[(0,r.bF)(d,{round:"",block:"",type:"primary","native-type":"submit",loading:s.submitting,disabled:s.submitting},{default:(0,r.k6)((()=>t[5]||(t[5]=[(0,r.eW)(" 提交 ")]))),_:1},8,["loading","disabled"])])])),_:1},8,["onSubmit"]),(0,r.bF)(p,{show:s.showRequirementPicker,"onUpdate:show":t[3]||(t[3]=e=>s.showRequirementPicker=e),position:"bottom",round:"",style:{height:"50%"}},{default:(0,r.k6)((()=>[(0,r.bF)(m,{title:"选择关联需求",columns:a.requirementOptions,onConfirm:a.onRequirementConfirm,onCancel:t[2]||(t[2]=e=>s.showRequirementPicker=!1),"show-toolbar":""},null,8,["columns","onConfirm"])])),_:1},8,["show"]),s.loading?((0,r.uX)(),(0,r.Wv)(h,{key:0,vertical:"",class:"loading-overlay"},{default:(0,r.k6)((()=>t[6]||(t[6]=[(0,r.eW)("加载中...")]))),_:1})):(0,r.Q3)("",!0)])])}i(1701);var di={name:"NewResultPage",components:{HeaderBar:I},data(){return{title:"",description:"",relatedRequirementId:this.$route.query.requirementId||"",submitting:!1,loading:!1,showRequirementPicker:!1,requirements:[],selectedRequirementId:"",selectedRequirementTitle:"无关联需求",editor:null,descriptionError:!1}},computed:{requirementOptions(){const e=[{text:"无关联需求",value:null}];return e.concat(this.requirements.map((e=>({text:e.title,value:e.id}))))}},mounted(){this.initEditor(),this.fetchRequirements(),this.relatedRequirementId&&this.fetchRequirementDetails(this.relatedRequirementId)},beforeUnmount(){this.editor&&(this.editor.destroy(),this.editor=null)},methods:{initEditor(){this.editor=new(Wt())(this.$refs.editor),this.editor.config.placeholder="请输入结果详细描述",this.editor.config.zIndex=100,this.editor.config.menus=["bold","italic","underline","head","fontSize","fontName","strikeThrough","foreColor","backColor","link","list","justify","quote","emoticon","undo","redo"],window.innerWidth<768&&(this.editor.config.menus=["bold","head","fontSize","list","justify","emoticon","undo","redo"]),this.editor.config.height=250,this.editor.create()},validateDescription(){const e=this.editor.txt.html();return e&&"<p><br></p>"!==e?(this.descriptionError=!1,this.description=e,!0):(this.descriptionError=!0,!1)},async fetchRequirementDetails(e){this.loading=!0;try{const t=await v.requirements.getById(e);this.selectedRequirementTitle=t.data.title,this.selectedRequirementId=e}catch(t){console.error("Error fetching requirement details:",t),(0,D.xr)("获取需求详情失败")}finally{this.loading=!1}},async fetchRequirements(){this.loading=!0;try{const e=await v.requirements.getAll();this.requirements=e.data}catch(e){console.error("Error fetching requirements:",e),(0,D.xr)("获取需求列表失败")}finally{this.loading=!1}},onRequirementConfirm(e){this.selectedRequirementId=e.value,this.selectedRequirementTitle=e.value?e.text:"无关联需求",this.showRequirementPicker=!1},async onSubmit(){if(this.validateDescription()){this.submitting=!0;try{const e={title:this.title,description:this.description,relatedRequirementId:this.relatedRequirementId||this.selectedRequirementId||null};await v.results.create(e),(0,D.GF)("结果创建成功"),this.relatedRequirementId?setTimeout((()=>{this.$router.push(`/results/requirement/${this.relatedRequirementId}`)}),1e3):setTimeout((()=>{this.$router.push("/results")}),1e3)}catch(e){console.error("Error creating result:",e),(0,D.xr)("创建结果失败: "+(e.response?.data?.error||"未知错误"))}finally{this.submitting=!1}}}}};const ci=(0,l.A)(di,[["render",ui],["__scopeId","data-v-3f0fc5c6"]]);var mi=ci;const pi={class:"page"},hi={class:"page-content"},gi={class:"rich-text-wrapper"},vi={ref:"editor",class:"rich-text-editor"},fi={key:0,class:"error-message"},ki={style:{margin:"16px"}};function yi(e,t,i,n,s,a){const o=(0,r.g2)("header-bar"),l=(0,r.g2)("van-loading"),u=(0,r.g2)("van-field"),d=(0,r.g2)("van-dropdown-item"),c=(0,r.g2)("van-dropdown-menu"),m=(0,r.g2)("van-cell-group"),p=(0,r.g2)("van-button"),h=(0,r.g2)("van-form"),g=(0,r.g2)("van-picker"),v=(0,r.g2)("van-popup");return(0,r.uX)(),(0,r.CE)("div",pi,[(0,r.bF)(o,{title:"编辑结果"}),(0,r.Lk)("div",hi,[s.loading?((0,r.uX)(),(0,r.Wv)(l,{key:0,vertical:"",class:"loading-overlay"},{default:(0,r.k6)((()=>t[5]||(t[5]=[(0,r.eW)("加载中...")]))),_:1})):((0,r.uX)(),(0,r.Wv)(h,{key:1,onSubmit:a.onSubmit},{default:(0,r.k6)((()=>[(0,r.bF)(m,{inset:""},{default:(0,r.k6)((()=>[(0,r.bF)(u,{modelValue:s.title,"onUpdate:modelValue":t[0]||(t[0]=e=>s.title=e),name:"title",label:"结果标题",placeholder:"请输入结果标题",rules:[{required:!0,message:"请填写结果标题"}]},null,8,["modelValue"]),(0,r.Lk)("div",gi,[t[6]||(t[6]=(0,r.Lk)("div",{class:"field-label"},"结果描述",-1)),(0,r.Lk)("div",vi,null,512),s.descriptionError?((0,r.uX)(),(0,r.CE)("div",fi,"请填写结果描述")):(0,r.Q3)("",!0)]),(0,r.bF)(u,{name:"status",label:"状态",readonly:""},{input:(0,r.k6)((()=>[(0,r.bF)(c,null,{default:(0,r.k6)((()=>[(0,r.bF)(d,{modelValue:s.status,"onUpdate:modelValue":t[1]||(t[1]=e=>s.status=e),options:s.statusOptions},null,8,["modelValue","options"])])),_:1})])),_:1}),a.requirementOptions.length>0?((0,r.uX)(),(0,r.Wv)(u,{key:0,readonly:"",name:"relatedRequirement",label:"关联需求",value:s.selectedRequirementTitle,"right-icon":"arrow-down",onClick:t[2]||(t[2]=e=>s.showRequirementPicker=!0)},null,8,["value"])):(0,r.Q3)("",!0)])),_:1}),(0,r.Lk)("div",ki,[(0,r.bF)(p,{round:"",block:"",type:"primary","native-type":"submit",loading:s.submitting,disabled:s.submitting},{default:(0,r.k6)((()=>t[7]||(t[7]=[(0,r.eW)(" 保存 ")]))),_:1},8,["loading","disabled"])])])),_:1},8,["onSubmit"])),(0,r.bF)(v,{show:s.showRequirementPicker,"onUpdate:show":t[4]||(t[4]=e=>s.showRequirementPicker=e),position:"bottom",round:"",style:{height:"50%"}},{default:(0,r.k6)((()=>[(0,r.bF)(g,{title:"选择关联需求",columns:a.requirementOptions,onConfirm:a.onRequirementConfirm,onCancel:t[3]||(t[3]=e=>s.showRequirementPicker=!1),"show-toolbar":""},null,8,["columns","onConfirm"])])),_:1},8,["show"])])])}var bi={name:"EditResultPage",components:{HeaderBar:I},props:{id:{type:String,required:!0}},data(){return{title:"",description:"",status:"",relatedRequirementId:null,loading:!0,submitting:!1,showRequirementPicker:!1,requirements:[],selectedRequirementTitle:"无关联需求",editor:null,descriptionError:!1,statusOptions:[{text:"草稿",value:"DRAFT"},{text:"已完成",value:"COMPLETED"},{text:"已归档",value:"ARCHIVED"},{text:"已拒绝",value:"REJECTED"}]}},computed:{requirementOptions(){const e=[{text:"无关联需求",value:null}];return e.concat(this.requirements.map((e=>({text:e.title,value:e.id}))))}},mounted(){this.fetchResultDetail(),this.fetchRequirements()},beforeUnmount(){this.editor&&(this.editor.destroy(),this.editor=null)},methods:{async fetchResultDetail(){try{const e=await v.results.getById(this.id),t=e.data;this.title=t.title,this.description=t.description,this.status=t.status,this.relatedRequirementId=t.relatedRequirementId,this.relatedRequirementId&&this.fetchRelatedRequirementTitle(),this.loading=!1,this.$nextTick((()=>{this.initEditor()}))}catch(e){console.error("Error fetching result:",e),(0,D.xr)("获取结果详情失败"),this.$router.push(`/result/${this.id}`)}},async fetchRelatedRequirementTitle(){if(this.relatedRequirementId)try{const e=await v.requirements.getById(this.relatedRequirementId);this.selectedRequirementTitle=e.data.title}catch(e){console.error("Error fetching related requirement title:",e),this.selectedRequirementTitle="未能获取需求标题"}},async fetchRequirements(){try{const e=await v.requirements.getAll();this.requirements=e.data}catch(e){console.error("Error fetching requirements:",e)}},initEditor(){this.editor=new(Wt())(this.$refs.editor),this.editor.config.placeholder="请输入结果详细描述",this.editor.config.zIndex=100,this.editor.config.menus=["bold","italic","underline","head","fontSize","fontName","strikeThrough","foreColor","backColor","link","list","justify","quote","emoticon","undo","redo"],window.innerWidth<768&&(this.editor.config.menus=["bold","head","fontSize","list","justify","emoticon","undo","redo"]),this.editor.config.height=250,this.editor.create(),this.editor.txt.html(this.description)},validateDescription(){const e=this.editor.txt.html();return e&&"<p><br></p>"!==e?(this.descriptionError=!1,this.description=e,!0):(this.descriptionError=!0,!1)},onRequirementConfirm(e){this.relatedRequirementId=e.value,this.selectedRequirementTitle=e.value?e.text:"无关联需求",this.showRequirementPicker=!1},async onSubmit(){if(this.validateDescription()){this.submitting=!0;try{const e={title:this.title,description:this.description,status:this.status,relatedRequirementId:this.relatedRequirementId};await v.results.update(this.id,e),(0,D.GF)("结果更新成功"),setTimeout((()=>{this.$router.push(`/result/${this.id}`)}),1e3)}catch(e){console.error("Error updating result:",e),(0,D.xr)("更新结果失败: "+(e.response?.data?.error||"未知错误"))}finally{this.submitting=!1}}}}};const qi=(0,l.A)(bi,[["render",yi],["__scopeId","data-v-62c42f32"]]);var wi=qi;const Ei={class:"page"},Ai={class:"page-content"},Ri={class:"requirement-info"};function Ci(e,t,i,n,s,a){const o=(0,r.g2)("header-bar"),l=(0,r.g2)("van-loading"),u=(0,r.g2)("van-empty"),d=(0,r.g2)("van-tag"),c=(0,r.g2)("van-cell"),m=(0,r.g2)("van-cell-group");return(0,r.uX)(),(0,r.CE)("div",Ei,[(0,r.bF)(o,{title:"相关结果","right-text":"添加结果",onRightClick:a.goToNewResult},null,8,["onRightClick"]),(0,r.Lk)("div",Ai,[s.loading?((0,r.uX)(),(0,r.Wv)(l,{key:0,vertical:"",class:"loading-overlay"},{default:(0,r.k6)((()=>t[0]||(t[0]=[(0,r.eW)("加载中...")]))),_:1})):((0,r.uX)(),(0,r.CE)(r.FK,{key:1},[(0,r.Lk)("div",Ri,[(0,r.Lk)("h3",null,"需求: "+(0,A.v_)(s.requirementTitle),1)]),0===s.resultsList.length?((0,r.uX)(),(0,r.Wv)(u,{key:0,description:"暂无相关结果数据"})):((0,r.uX)(),(0,r.Wv)(m,{key:1,class:"list-container"},{default:(0,r.k6)((()=>[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(s.resultsList,(e=>((0,r.uX)(),(0,r.Wv)(c,{key:e.id,title:e.title,"is-link":"",onClick:t=>a.goToResultDetail(e.id),class:"list-item"},{"right-icon":(0,r.k6)((()=>[(0,r.bF)(d,{type:a.getStatusType(e.status),class:"custom-tag",round:""},{default:(0,r.k6)((()=>[(0,r.eW)((0,A.v_)(a.getStatusText(e.status)),1)])),_:2},1032,["type"])])),_:2},1032,["title","onClick"])))),128))])),_:1}))],64))])])}var Li={name:"ResultsByRequirementPage",components:{HeaderBar:I},props:{requirementId:{type:String,required:!0}},data(){return{resultsList:[],requirementTitle:"",loading:!0}},created(){this.fetchRequirementData(),this.fetchResultsData()},methods:{async fetchRequirementData(){try{const e=await v.requirements.getById(this.requirementId);this.requirementTitle=e.data.title}catch(e){console.error("Error fetching requirement data:",e),this.requirementTitle="未知需求"}},async fetchResultsData(){try{const e=await v.results.getByRequirement(this.requirementId);this.resultsList=e.data}catch(e){console.error("Error fetching results data:",e),(0,D.xr)("获取结果数据失败")}finally{this.loading=!1}},goToResultDetail(e){this.$router.push(`/result/${e}`)},goToNewResult(){this.$router.push(`/result/new?requirementId=${this.requirementId}`)},getStatusText(e){const t={DRAFT:"草稿",COMPLETED:"已完成",ARCHIVED:"已归档",REJECTED:"已拒绝"};return t[e]||"未知状态"},getStatusType(e){const t={DRAFT:"primary",COMPLETED:"success",ARCHIVED:"warning",REJECTED:"danger"};return t[e]||"default"}}};const Ti=(0,l.A)(Li,[["render",Ci],["__scopeId","data-v-71bcea11"]]);var Fi=Ti;const Ii={class:"page"},xi={class:"page-content"};function Si(e,t,i,n,s,a){const o=(0,r.g2)("header-bar"),l=(0,r.g2)("van-loading"),u=(0,r.g2)("agreement-editor");return(0,r.uX)(),(0,r.CE)("div",Ii,[(0,r.bF)(o,{title:"编辑协议"}),(0,r.Lk)("div",xi,[s.loading?((0,r.uX)(),(0,r.Wv)(l,{key:0,vertical:"",class:"loading-overlay"},{default:(0,r.k6)((()=>t[0]||(t[0]=[(0,r.eW)("加载中...")]))),_:1})):((0,r.uX)(),(0,r.Wv)(u,{key:1,initialContent:s.agreement,initialButtonText:s.agreementButtonText,onSave:a.saveAgreement,onCancel:a.goBack,ref:"agreementEditor"},null,8,["initialContent","initialButtonText","onSave","onCancel"]))])])}var _i={name:"EditAgreementPage",components:{HeaderBar:I,AgreementEditor:Nt},props:{id:{type:String,required:!0}},data(){return{requirement:null,agreement:"",agreementButtonText:"",loading:!0}},created(){this.fetchRequirementDetail()},methods:{async fetchRequirementDetail(){this.loading=!0;try{const e=await v.requirements.getById(this.id);this.requirement=e.data,this.agreement=this.requirement.agreement||"",this.agreementButtonText=this.requirement.agreementButtonText||""}catch(e){console.error("Error fetching requirement detail:",e),(0,D.xr)("获取需求详情失败"),this.$router.push(`/requirement/${this.id}`)}finally{this.loading=!1}},async saveAgreement(e,t){try{await v.requirements.updateAgreement(this.id,e,t||null),this.$refs.agreementEditor.saved(!0,"协议保存成功"),setTimeout((()=>{this.goBack()}),1e3)}catch(i){console.error("Error updating agreement:",i),this.$refs.agreementEditor.saved(!1,"保存协议失败: "+(i.response?.data?.message||"未知错误"))}},goBack(){this.$router.push(`/requirement/${this.id}`)}}};const Pi=(0,l.A)(_i,[["render",Si],["__scopeId","data-v-168ad367"]]);var Di=Pi;const Bi={class:"page"},Wi={class:"page-content"},$i={style:{margin:"16px"}},Xi={key:0,class:"biometric-login"},Ni={class:"form-footer"};function Mi(e,t,i,n,s,a){const o=(0,r.g2)("header-bar"),l=(0,r.g2)("van-field"),u=(0,r.g2)("van-cell-group"),d=(0,r.g2)("van-button"),c=(0,r.g2)("van-form"),m=(0,r.g2)("van-icon"),p=(0,r.g2)("router-link");return(0,r.uX)(),(0,r.CE)("div",Bi,[(0,r.bF)(o,{title:"登录","show-back":!1}),(0,r.Lk)("div",Wi,[t[6]||(t[6]=(0,r.Lk)("div",{class:"logo-container"},[(0,r.Lk)("h2",{class:"small-seal-font"},"生命树")],-1)),(0,r.bF)(c,{onSubmit:n.onSubmit},{default:(0,r.k6)((()=>[(0,r.bF)(u,{inset:""},{default:(0,r.k6)((()=>[(0,r.bF)(l,{modelValue:n.email,"onUpdate:modelValue":t[0]||(t[0]=e=>n.email=e),name:"email",label:"邮箱",placeholder:"请输入邮箱",rules:[{required:!0,message:"请填写邮箱"},{pattern:n.emailPattern,message:"请输入有效的邮箱地址"}]},null,8,["modelValue","rules"]),(0,r.bF)(l,{modelValue:n.password,"onUpdate:modelValue":t[1]||(t[1]=e=>n.password=e),type:"password",name:"password",label:"密码",placeholder:"请输入密码",rules:[{required:!0,message:"请填写密码"}]},null,8,["modelValue"])])),_:1}),(0,r.Lk)("div",$i,[(0,r.bF)(d,{round:"",block:"",type:"primary","native-type":"submit",loading:n.loading,disabled:n.loading},{default:(0,r.k6)((()=>t[2]||(t[2]=[(0,r.eW)(" 登录 ")]))),_:1},8,["loading","disabled"])])])),_:1},8,["onSubmit"]),n.biometricsAvailable?((0,r.uX)(),(0,r.CE)("div",Xi,[(0,r.bF)(d,{round:"",block:"",type:"default",onClick:n.loginWithBiometrics,disabled:n.loading},{icon:(0,r.k6)((()=>[(0,r.bF)(m,{name:"scan",size:"20"})])),default:(0,r.k6)((()=>[t[3]||(t[3]=(0,r.eW)(" 使用生物识别登录 "))])),_:1},8,["onClick","disabled"])])):(0,r.Q3)("",!0),(0,r.Lk)("div",Ni,[(0,r.Lk)("p",null,[t[5]||(t[5]=(0,r.eW)("还没有账号？ ")),(0,r.bF)(p,{to:"/register"},{default:(0,r.k6)((()=>t[4]||(t[4]=[(0,r.eW)("立即注册")]))),_:1})])])])])}var Oi={name:"LoginPage",components:{HeaderBar:I},setup(){const e=(0,c.rd)(),t=(0,m.KR)(""),n=(0,m.KR)(""),s=(0,m.KR)(!1),a=(0,m.KR)(!1),o=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,l=()=>"undefined"!==typeof window&&window.Capacitor&&window.Capacitor.isNativePlatform(),u=async()=>{try{if(!l())return console.log("非原生环境，生物识别不可用"),!1;const{NativeBiometric:t}=await i.e(926).then(i.bind(i,4926)),n=await t.isAvailable();if(console.log("生物识别可用性检查结果:",n),!n.isAvailable)return console.log("设备不支持生物识别"),!1;try{const e=await t.getCredentials({server:"lifetree-app"});return console.log("生物识别凭据检查:",e?"找到凭据":"未找到凭据"),Boolean(e&&e.username&&e.password)}catch(e){return console.error("获取生物识别凭据失败:",e),!1}}catch(t){return console.error("检查生物识别可用性失败:",t),!1}},d=async()=>{s.value=!0;try{if(!l())throw new Error("非原生环境，无法使用生物识别");const{NativeBiometric:t}=await i.e(926).then(i.bind(i,4926)),n=await t.isAvailable();if(console.log("生物识别可用性检查:",n),!n.isAvailable)throw new Error("设备不支持生物识别");console.log("开始生物识别验证..."),await t.verifyIdentity({reason:"登录到生命树应用",title:"生物识别验证",subtitle:"请使用Face ID进行验证",description:"这将允许您快速安全地登录"}),console.log("生物识别验证成功"),console.log("尝试获取存储的凭据...");const r=await t.getCredentials({server:"lifetree-app"});if(console.log("获取到凭据:",r?"成功":"失败"),!r||!r.username||!r.password)throw new Error("未找到有效的生物识别凭据");console.log("使用凭据尝试登录...");const s=await v.auth.login({email:r.username,password:r.password});if(!s||!s.data)throw new Error("登录响应无效");{const{user:t,token:i}=s.data;localStorage.setItem("user",JSON.stringify(t)),localStorage.setItem("token",i),q.state.user=t,q.state.token=i,q.state.isAuthenticated=!0,(0,D.P0)({message:"生物识别登录成功",type:"success"});const n=sessionStorage.getItem("redirectPath")||"/";sessionStorage.removeItem("redirectPath"),setTimeout((()=>{e.push(n)}),1e3)}}catch(t){console.error("生物识别登录详细错误:",t),(0,D.xr)("生物识别登录失败: "+(t.message||"请使用账号密码登录")),n.value=""}finally{s.value=!1}},p=async t=>{s.value=!0;try{console.log("开始常规登录...");const r=await v.auth.login({email:t.email,password:t.password});if(console.log("登录响应:",r?"成功":"失败"),!r||!r.data)throw new Error("登录响应无效");const{user:s,token:o}=r.data;localStorage.setItem("user",JSON.stringify(s)),localStorage.setItem("token",o),q.state.user=s,q.state.token=o,q.state.isAuthenticated=!0;try{if(l()){const{NativeBiometric:e}=await i.e(926).then(i.bind(i,4926));console.log("尝试保存生物识别凭据..."),await e.setCredentials({username:t.email,password:t.password,server:"lifetree-app"}),console.log("生物识别凭据保存成功"),a.value=!0}}catch(n){console.error("保存生物识别凭据失败:",n)}(0,D.P0)({message:"登录成功",type:"success"});const u=sessionStorage.getItem("redirectPath")||"/";sessionStorage.removeItem("redirectPath"),setTimeout((()=>{e.push(u)}),1e3)}catch(n){console.error("登录失败详细错误:",n);const e=n.response?.data?.error||"登录失败，请检查您的凭据";(0,D.xr)(e)}finally{s.value=!1}},h=async()=>{try{const e=await fetch(v.baseURL+"/health");console.log("API连接测试结果:",e.status),e.ok?console.log("API连接成功"):console.log("API连接失败")}catch(e){console.error("API连接测试错误:",e)}};return(0,r.sV)((async()=>{console.log("Login组件已挂载"),console.log("检查平台:",l()?"原生平台":"浏览器"),await h();const e=await u();console.log("生物识别可用性:",e),a.value=e})),{email:t,password:n,loading:s,emailPattern:o,biometricsAvailable:a,onSubmit:p,loginWithBiometrics:d}}};const Vi=(0,l.A)(Oi,[["render",Mi],["__scopeId","data-v-0e5dc4d4"]]);var Ui=Vi;const ji={class:"page"},zi={class:"page-content"},Hi={style:{margin:"16px"}},Gi={class:"form-footer"};function Qi(e,t,i,n,s,a){const o=(0,r.g2)("header-bar"),l=(0,r.g2)("van-field"),u=(0,r.g2)("van-cell-group"),d=(0,r.g2)("van-button"),c=(0,r.g2)("van-form"),m=(0,r.g2)("router-link");return(0,r.uX)(),(0,r.CE)("div",ji,[(0,r.bF)(o,{title:"注册"}),(0,r.Lk)("div",zi,[t[7]||(t[7]=(0,r.Lk)("div",{class:"logo-container"},[(0,r.Lk)("h2",{class:"small-seal-font"},"生命树")],-1)),(0,r.bF)(c,{onSubmit:n.onSubmit},{default:(0,r.k6)((()=>[(0,r.bF)(u,{inset:""},{default:(0,r.k6)((()=>[(0,r.bF)(l,{modelValue:n.email,"onUpdate:modelValue":t[0]||(t[0]=e=>n.email=e),name:"email",label:"邮箱",placeholder:"请输入邮箱",rules:[{required:!0,message:"请填写邮箱"},{pattern:n.emailPattern,message:"请输入有效的邮箱地址"}]},null,8,["modelValue","rules"]),(0,r.bF)(l,{modelValue:n.name,"onUpdate:modelValue":t[1]||(t[1]=e=>n.name=e),name:"name",label:"用户名",placeholder:"请输入用户名",rules:[{required:!0,message:"请填写用户名"}]},null,8,["modelValue"]),(0,r.bF)(l,{modelValue:n.password,"onUpdate:modelValue":t[2]||(t[2]=e=>n.password=e),type:"password",name:"password",label:"密码",placeholder:"请输入密码",rules:[{required:!0,message:"请填写密码"},{pattern:n.passwordPattern,message:"密码至少6位，包含字母和数字"}]},null,8,["modelValue","rules"]),(0,r.bF)(l,{modelValue:n.confirmPassword,"onUpdate:modelValue":t[3]||(t[3]=e=>n.confirmPassword=e),type:"password",name:"confirmPassword",label:"确认密码",placeholder:"请再次输入密码",rules:[{required:!0,message:"请再次输入密码"},{validator:n.validatePasswordConfirmation,message:"两次输入的密码不一致"}]},null,8,["modelValue","rules"])])),_:1}),(0,r.Lk)("div",Hi,[(0,r.bF)(d,{round:"",block:"",type:"primary","native-type":"submit",loading:n.loading,disabled:n.loading},{default:(0,r.k6)((()=>t[4]||(t[4]=[(0,r.eW)(" 注册 ")]))),_:1},8,["loading","disabled"])])])),_:1},8,["onSubmit"]),(0,r.Lk)("div",Gi,[(0,r.Lk)("p",null,[t[6]||(t[6]=(0,r.eW)("已有账号？ ")),(0,r.bF)(m,{to:"/login"},{default:(0,r.k6)((()=>t[5]||(t[5]=[(0,r.eW)("立即登录")]))),_:1})])])])])}var Ki={name:"RegisterPage",components:{HeaderBar:I},setup(){const e=(0,c.rd)(),t=(0,m.KR)(""),i=(0,m.KR)(""),n=(0,m.KR)(""),r=(0,m.KR)(""),s=(0,m.KR)(!1),a=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,o=/^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]{6,}$/,l=e=>e===n.value,u=async t=>{s.value=!0;try{await q.register({email:t.email,name:t.name,password:t.password}),(0,D.P0)({message:"注册成功，请登录",type:"success"}),setTimeout((()=>{e.push("/login")}),1e3)}catch(i){const e=i.response?.data?.error||"注册失败，请重试";(0,D.xr)(e)}finally{s.value=!1}};return{email:t,name:i,password:n,confirmPassword:r,loading:s,emailPattern:a,passwordPattern:o,validatePasswordConfirmation:l,onSubmit:u}}};const Ji=(0,l.A)(Ki,[["render",Qi],["__scopeId","data-v-5c542bcc"]]);var Zi=Ji;const Yi="/lifetree/",en=[{path:"/",name:"Home",component:M},{path:"/requirements",name:"Requirements",component:H,meta:{requiresAuth:!0}},{path:"/results",name:"Results",component:Y,meta:{requiresAuth:!0}},{path:"/profile",name:"Profile",component:de,meta:{requiresAuth:!0}},{path:"/requirement/:id",name:"RequirementDetail",component:Ue,props:!0,meta:{requiresAuth:!0}},{path:"/requirement/edit/:id",name:"EditRequirement",component:ii,props:!0,meta:{requiresAuth:!0}},{path:"/requirement/:id/agreement/edit",name:"EditAgreement",component:Di,props:!0,meta:{requiresAuth:!0}},{path:"/result/:id",name:"ResultDetail",component:tt,props:!0,meta:{requiresAuth:!0}},{path:"/result/edit/:id",name:"EditResult",component:wi,props:!0,meta:{requiresAuth:!0}},{path:"/results/requirement/:requirementId",name:"ResultsByRequirement",component:Fi,props:!0,meta:{requiresAuth:!0}},{path:"/agreement",name:"Agreement",component:lt},{path:"/requirement/new",name:"NewRequirement",component:Vt,meta:{requiresAuth:!0}},{path:"/result/new",name:"NewResult",component:mi,meta:{requiresAuth:!0}},{path:"/login",name:"Login",component:Ui,meta:{guest:!0}},{path:"/register",name:"Register",component:Zi,meta:{guest:!0}},{path:"/:pathMatch(.*)*",redirect:"/"}],tn=(0,c.aE)({history:(0,c.Bt)(Yi),routes:en});tn.beforeEach(((e,t,i)=>{e.matched.some((e=>e.meta.requiresAuth))?q.state.isAuthenticated?i():(sessionStorage.setItem("redirectPath",e.fullPath),i({path:"/login"})):e.matched.some((e=>e.meta.guest))&&q.state.isAuthenticated?i({path:"/"}):i()}));var nn=tn,rn=i(4296),sn=i(8728),an=i(7648),on=i(828),ln=i(55),un=i(786),dn=i(7363),cn=i(9472),mn=i(3623),pn=i(7515),hn=i(2352),gn=i(9056),vn=i(5802),fn=i(4025),kn=i(3429),yn=i(4743),bn=i(1824),qn=i(5746),wn=i(5116),En=i(6767),An=i(8427),Rn=i(5399);i(2241);const Cn=(0,n.Ef)(d);Cn.use(nn),Cn.use(rn.$n),Cn.use(sn.HF),Cn.use(an.gq),Cn.use(on.fh),Cn.use(ln.Qh),Cn.use(un.jq),Cn.use(dn.In),Cn.use(cn.lV),Cn.use(mn.D0),Cn.use(pn.y8),Cn.use(hn.lG),Cn.use(gn.M9),Cn.use(vn.vw),Cn.use(fn.Rh),Cn.use(kn.Ee),Cn.use(yn.j5),Cn.use(bn.B8),Cn.use(qn.Sv),Cn.use(wn.zD),Cn.use(En.LC),Cn.use(An.rI),Cn.use(Rn.tJ),Cn.config.globalProperties.$axios=p.A,Cn.mount("#app")}},t={};function i(n){var r=t[n];if(void 0!==r)return r.exports;var s=t[n]={exports:{}};return e[n].call(s.exports,s,s.exports,i),s.exports}i.m=e,function(){var e=[];i.O=function(t,n,r,s){if(!n){var a=1/0;for(d=0;d<e.length;d++){n=e[d][0],r=e[d][1],s=e[d][2];for(var o=!0,l=0;l<n.length;l++)(!1&s||a>=s)&&Object.keys(i.O).every((function(e){return i.O[e](n[l])}))?n.splice(l--,1):(o=!1,s<a&&(a=s));if(o){e.splice(d--,1);var u=r();void 0!==u&&(t=u)}}return t}s=s||0;for(var d=e.length;d>0&&e[d-1][2]>s;d--)e[d]=e[d-1];e[d]=[n,r,s]}}(),function(){i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,{a:t}),t}}(),function(){i.d=function(e,t){for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}}(),function(){i.f={},i.e=function(e){return Promise.all(Object.keys(i.f).reduce((function(t,n){return i.f[n](e,t),t}),[]))}}(),function(){i.u=function(e){return"js/"+e+"."+{542:"d1a1cfef",926:"6f28a985"}[e]+".js"}}(),function(){i.miniCssF=function(e){}}(),function(){i.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={},t="mobile-app:";i.l=function(n,r,s,a){if(e[n])e[n].push(r);else{var o,l;if(void 0!==s)for(var u=document.getElementsByTagName("script"),d=0;d<u.length;d++){var c=u[d];if(c.getAttribute("src")==n||c.getAttribute("data-webpack")==t+s){o=c;break}}o||(l=!0,o=document.createElement("script"),o.charset="utf-8",o.timeout=120,i.nc&&o.setAttribute("nonce",i.nc),o.setAttribute("data-webpack",t+s),o.src=n),e[n]=[r];var m=function(t,i){o.onerror=o.onload=null,clearTimeout(p);var r=e[n];if(delete e[n],o.parentNode&&o.parentNode.removeChild(o),r&&r.forEach((function(e){return e(i)})),t)return t(i)},p=setTimeout(m.bind(null,void 0,{type:"timeout",target:o}),12e4);o.onerror=m.bind(null,o.onerror),o.onload=m.bind(null,o.onload),l&&document.head.appendChild(o)}}}(),function(){i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){i.p="/lifetree/"}(),function(){var e={524:0};i.f.j=function(t,n){var r=i.o(e,t)?e[t]:void 0;if(0!==r)if(r)n.push(r[2]);else{var s=new Promise((function(i,n){r=e[t]=[i,n]}));n.push(r[2]=s);var a=i.p+i.u(t),o=new Error,l=function(n){if(i.o(e,t)&&(r=e[t],0!==r&&(e[t]=void 0),r)){var s=n&&("load"===n.type?"missing":n.type),a=n&&n.target&&n.target.src;o.message="Loading chunk "+t+" failed.\n("+s+": "+a+")",o.name="ChunkLoadError",o.type=s,o.request=a,r[1](o)}};i.l(a,l,"chunk-"+t,t)}},i.O.j=function(t){return 0===e[t]};var t=function(t,n){var r,s,a=n[0],o=n[1],l=n[2],u=0;if(a.some((function(t){return 0!==e[t]}))){for(r in o)i.o(o,r)&&(i.m[r]=o[r]);if(l)var d=l(i)}for(t&&t(n);u<a.length;u++)s=a[u],i.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return i.O(d)},n=self["webpackChunkmobile_app"]=self["webpackChunkmobile_app"]||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))}();var n=i.O(void 0,[504],(function(){return i(2105)}));n=i.O(n)})();